<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SMS Collage Varanasi</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <!-- Added for PDF Download Functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --primary-color: #16a085;
            --primary-light: #1abc9c;
            --primary-gradient: linear-gradient(45deg, #16a085, #1abc9c);
            --secondary-color: #34495e;
            --background-color: #2c3e50;
            --sidebar-bg: #34495e;
            --text-color: #ecf0f1;
            --text-muted: #bdc3c7;
            --border-color: #46627f;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --font-family: 'Roboto', 'Segoe UI', sans-serif;
            --sidebar-width: 260px;
            --glow-color: rgba(26, 188, 156, 0.4); 
            --glow-color-hover: rgba(26, 188, 156, 0.6);
        }

        body.light-theme {
            --secondary-color: #f0f2f5;
            --background-color: #ffffff;
            --sidebar-bg: #ffffff;
            --text-color: #2c3e50;
            --text-muted: #5a6a7a;
            --border-color: #e0e0e0;
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            font-size: 16px;
            transition: background-color 0.3s, color 0.3s;
        }

        body.font-weight-light { font-weight: 300; }
        body.font-weight-normal { font-weight: 400; }
        body.font-weight-bold { font-weight: 500; }
        body.font-weight-bold h1, body.font-weight-bold h2, body.font-weight-bold h3 { font-weight: 700; }

        .app-container { display: flex; width: 100%; height: 100vh; }
        #sidebar {
            width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100%;
            display: flex; flex-direction: column; transition: margin-left 0.3s ease, background-color 0.3s;
            z-index: 200; border-right: 1px solid var(--border-color); flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px; text-align: center; border-bottom: 1px solid var(--border-color);
            display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .sidebar-header .admin-photo {
            width: 80px; height: 80px; border-radius: 50%; object-fit: cover;
            border: 3px solid var(--primary-light); box-shadow: 0 0 15px var(--glow-color);
        }
        
        .sidebar-logo {
            width: 180px;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 0 10px var(--glow-color));
        }
        .sidebar-logo:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 15px var(--glow-color-hover));
        }

        @keyframes glow {
            from { box-shadow: 0 0 10px -5px var(--glow-color), 0 0 20px -10px var(--glow-color); }
            to { box-shadow: 0 0 20px 0px var(--glow-color), 0 0 40px -5px var(--glow-color); }
        }

        .sidebar-header h2 { font-size: 22px; font-weight: 700; color: var(--text-color); }
        .sidebar-nav { flex-grow: 1; list-style: none; padding: 20px 0; overflow-y: auto; }

        .sidebar-nav-item a {
            display: flex; justify-content: space-between; align-items: center;
            padding: 14px 25px; color: var(--text-muted); text-decoration: none;
            font-weight: 500; border-left: 4px solid transparent; transition: all 0.2s ease; cursor: pointer;
        }
        .sidebar-nav-item>a:hover { background-color: var(--background-color); color: var(--primary-light); }
        .sidebar-nav-item>a.active {
            background-color: var(--background-color); color: var(--primary-light);
            border-left-color: var(--primary-light); font-weight: 700;
            box-shadow: inset 5px 0 15px -10px var(--glow-color);
        }
        .sidebar-nav-item .nav-link-content { display: flex; align-items: center; }
        .sidebar-nav-item i { margin-right: 18px; width: 22px; text-align: center; font-size: 1.1rem; }
        .sidebar-nav-item .arrow { transition: transform 0.3s; }
        .sidebar-nav-item.open>a .arrow { transform: rotate(90deg); }
        .sidebar-submenu { list-style: none; padding-left: 0; background-color: rgba(0, 0, 0, 0.1); max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
        .sidebar-nav-item.open .sidebar-submenu { max-height: 500px; }
        .sidebar-submenu a { padding-left: 55px !important; font-size: 0.95rem; }

        .sidebar-footer { padding: 15px; border-top: 1px solid var(--border-color); }
        .logout-button {
            width: 100%; background: var(--error-color); color: white; border: none; padding: 12px;
            border-radius: 8px; font-weight: 500; cursor: pointer; transition: opacity 0.2s, box-shadow 0.3s;
        }
        .logout-button:hover { opacity: 0.9; box-shadow: 0 0 15px var(--error-color); }
        .social-media-links { text-align: center; padding-top: 15px; display: flex; justify-content: center; gap: 20px; }
        .social-media-links a { color: var(--text-muted); font-size: 1.2rem; text-decoration: none; transition: color 0.3s, transform 0.3s; }
        .social-media-links a:hover { color: var(--primary-light); transform: translateY(-3px) scale(1.1); }
        .app-container.sidebar-collapsed #sidebar { margin-left: calc(-1 * var(--sidebar-width)); }

        .main-wrapper { flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; }
        #main-content { flex-grow: 1; padding: 25px; transition: margin-left 0.3s ease; }
        #main-footer { flex-shrink: 0; background-color: var(--sidebar-bg); padding: 20px; border-top: 1px solid var(--border-color); transition: background-color 0.3s, color 0.3s; }
        .footer-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; max-width: 1200px; margin: 0 auto; }
        .footer-contact p { margin: 0 0 5px 0; }
        .footer-contact i { margin-right: 10px; color: var(--primary-light); }
        .footer-map iframe { border-radius: 8px; border: 1px solid var(--border-color); }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center;
            z-index: 10001; backdrop-filter: blur(5px);
        }
        .loader {
            border: 8px solid var(--secondary-color); border-top: 8px solid var(--primary-light);
            border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .header-left { display: flex; align-items: center; gap: 15px; overflow: hidden; flex-grow: 1;}
        .header-actions { display: flex; align-items: center; gap: 15px; flex-shrink: 0;}
        .header-left .menu-toggle { background: none; border: none; color: var(--text-color); font-size: 24px; cursor: pointer; flex-shrink: 0; }
        .header-title-container { overflow: hidden; white-space: nowrap; flex-grow: 1;}
        .moving-title { font-size: 24px; font-weight: 700; display: inline-block; animation: marquee 20s linear infinite; padding-left: 100%; color: var(--primary-light); text-shadow: 0 0 10px var(--glow-color); text-transform: uppercase; }
        #real-time-clock { font-size: 1rem; font-weight: 500; color: var(--primary-light); background: transparent; border: 1px solid var(--border-color); padding: 8px 15px; border-radius: 6px; text-shadow: 0 0 5px var(--glow-color); }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .card {
            background-color: var(--sidebar-bg); padding: 25px; border-radius: 12px;
            margin-bottom: 25px; transition: all 0.3s ease; border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2), 0 0 15px -5px var(--glow-color);
        }
        .card:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.3), 0 0 25px var(--glow-color-hover); transform: translateY(-2px); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        .card-header h3 { font-size: 20px; font-weight: 600; }
        
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card {
            background-color: var(--sidebar-bg); padding: 20px; border-radius: 12px; text-align: center;
            border: 1px solid var(--border-color); transition: all 0.3s; box-shadow: 0 0 10px -4px var(--glow-color);
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 0 15px var(--glow-color-hover); }
        .stat-card h3 { font-size: 2.5rem; color: var(--primary-light); margin: 10px 0; }
        .stat-card p { font-size: 1rem; color: var(--text-muted); }
        .stat-card i { font-size: 2rem; color: var(--text-muted); }
        
        .quick-actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .quick-action-btn {
            background: var(--secondary-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        .quick-action-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--glow-color);
        }
        .quick-action-btn i { font-size: 1.8rem; display: block; margin-bottom: 10px; }


        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px); z-index: 1000; display: flex; justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--sidebar-bg); padding: 30px; border-radius: 12px; width: 90%; max-width: 600px;
            border: 1px solid var(--primary-light); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 0 25px var(--glow-color);
        }
        .modal-content .modal-body { max-height: 80vh; overflow-y: auto; padding-right: 15px; margin-right: -15px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .close-btn { background: none; border: none; color: var(--text-muted); font-size: 28px; cursor: pointer; }

        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-muted); }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; background: var(--background-color); border: 1px solid var(--border-color);
            color: var(--text-color); padding: 12px; border-radius: 6px; font-size: 1rem;
            transition: box-shadow 0.3s, border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: var(--primary-light); box-shadow: 0 0 8px var(--glow-color);
        }
        
        .form-feedback { margin-bottom: 15px; padding: 10px; border-radius: 6px; font-weight: 500; display: none; text-align: center;}
        .form-feedback.success { background-color: var(--success-color); color: white; display: block; }
        .form-feedback.error { background-color: var(--error-color); color: white; display: block; }

        .action-button {
            background-image: var(--primary-gradient); color: white; border: none; padding: 12px 25px;
            border-radius: 8px; cursor: pointer; transition: all 0.3s; font-weight: 500;
            text-decoration: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .action-button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3), 0 0 15px var(--glow-color-hover); }
        .action-button.inline { width: auto; }
        .action-button.secondary {
            background-image: none;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            box-shadow: none;
        }
        .action-button.secondary:hover {
            background-color: var(--primary-light);
            color: white;
            box-shadow: 0 0 15px var(--glow-color-hover);
        }
        .action-button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
            background-image: none;
            background-color: var(--secondary-color);
        }

        .auth-link { color: var(--primary-light); text-decoration: none; font-size: 0.9rem; margin-top: 15px; display: inline-block; }
        .auth-link:hover { text-decoration: underline; }
        
        .search-box-container { position: relative; width: 100%; margin-bottom: 20px; }
        .search-box-container .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 1rem; transition: color 0.3s; }
        .search-box-container .search-input { width: 100%; padding: 14px 20px 14px 50px; border-radius: 30px; background-color: var(--secondary-color); border: 1px solid var(--border-color); color: var(--text-color); font-size: 1rem; transition: all 0.3s ease; }
        .search-box-container .search-input:focus { outline: none; border-color: var(--primary-light); box-shadow: 0 0 10px var(--glow-color); background-color: var(--background-color); }
        .search-box-container:focus-within .search-icon { color: var(--primary-light); }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle;}
        thead { background-color: var(--secondary-color); }
        .table-photo { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color); }

        .action-buttons button, .action-buttons a { background: none; border: none; color: var(--text-muted); font-size: 18px; cursor: pointer; margin: 0 8px; transition: color 0.2s, text-shadow 0.3s; text-decoration: none; }
        .action-buttons .view-btn:hover { color: var(--info-color); text-shadow: 0 0 10px var(--info-color);}
        .action-buttons .edit-btn:hover { color: var(--warning-color); text-shadow: 0 0 10px var(--warning-color); }
        .action-buttons .delete-btn:hover { color: var(--error-color); text-shadow: 0 0 10px var(--error-color); }
        .action-buttons .download-btn:hover, .action-buttons .link-btn:hover, .action-buttons .certificate-btn:hover { color: var(--success-color); text-shadow: 0 0 10px var(--success-color); }
        .action-buttons .schedule-btn:hover { color: var(--purple-light, #9b59b6); text-shadow: 0 0 10px var(--purple-light, #9b59b6); }

        .profile-grid { display: grid; grid-template-columns: 300px 1fr; gap: 30px; }
        .profile-card .profile-photo { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin: 0 auto 20px; display: block; border: 4px solid var(--primary-light); box-shadow: 0 0 20px var(--glow-color); }
        .profile-details li { display: flex; align-items: center; margin-bottom: 15px; font-size: 0.95rem; list-style: none; }
        .profile-details i { color: var(--primary-light); margin-right: 15px; width: 20px; text-align: center; }

        .detail-list { list-style: none; padding: 0; }
        .detail-list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .detail-list li.clickable { cursor: pointer; transition: background-color 0.2s; }
        .detail-list li.clickable:hover { background-color: var(--background-color); }


        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 10002; }
        .toast {
            padding: 15px 25px; border-radius: 8px; color: white; font-weight: 500;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); margin-top: 10px; width: 350px;
            opacity: 0; transform: translateX(100%); animation: slideInToast 0.5s forwards, fadeOutToast 0.5s 4.5s forwards;
            border-left: 5px solid rgba(0,0,0,0.2);
        }
        @keyframes slideInToast { to { opacity: 1; transform: translateX(0); } }
        @keyframes fadeOutToast { to { opacity: 0; transform: translateX(100%); } }
        .toast.success { background-color: var(--success-color); box-shadow: 0 0 12px var(--success-color); }
        .toast.error { background-color: var(--error-color); box-shadow: 0 0 12px var(--error-color); }
        .toast.info { background-color: var(--info-color); box-shadow: 0 0 12px var(--info-color); }
        
        .gallery-grid, .videos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .gallery-item, .video-item { border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; text-align: center; background: var(--secondary-color); }
        .gallery-item img, .video-item iframe { width: 100%; height: 200px; object-fit: cover; display: block; border: none; }
        .gallery-item-footer, .video-item-footer { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        .view-switcher .action-button { background: var(--secondary-color); box-shadow: none; }
        .view-switcher .action-button.active { background-image: var(--primary-gradient); box-shadow: 0 4px 15px rgba(0,0,0,0.2), 0 0 15px var(--glow-color-hover); }

        .attendance-report-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .attendance-card { padding: 20px; text-align: center; }
        .attendance-card .profile-photo-small { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-light); box-shadow: 0 0 15px var(--glow-color); margin-bottom: 10px; }
        .attendance-card h4 { font-size: 1.1rem; font-weight: 600; margin-bottom: 5px; }
        .attendance-card .admission-no { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px; }
        .attendance-stats { display: flex; justify-content: space-around; margin-bottom: 15px; }
        .home-attendance-summary .attendance-stats { justify-content: center; gap: 30px; }
        .attendance-stats .stat-item { display: flex; flex-direction: column; align-items: center; }
        .attendance-stats .stat-item .count { font-size: 2rem; font-weight: 700; }
        .attendance-stats .stat-item.present .count { color: var(--success-color); }
        .attendance-stats .stat-item.absent .count { color: var(--error-color); }
        .attendance-bar-container { width: 100%; height: 10px; background-color: var(--secondary-color); border-radius: 5px; overflow: hidden; margin-bottom: 8px; }
        .attendance-bar { height: 100%; background-color: var(--success-color); border-radius: 5px; transition: width 0.5s ease-in-out; }
        
        .notice-board { max-height: 300px; overflow-y: auto; }
        .notice-item { padding: 15px; border-bottom: 1px solid var(--border-color); }
        .notice-item:last-child { border-bottom: none; }
        .notice-item h4 { font-size: 1.1rem; margin-bottom: 5px; color: var(--primary-light); }
        .notice-item p { font-size: 0.95rem; color: var(--text-muted); margin-bottom: 8px; }
        .notice-item .notice-date { font-size: 0.8rem; color: var(--text-muted); opacity: 0.7; }

        .attendance-card .percentage { font-weight: 500; color: var(--primary-light); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .receipt-container { background-color: var(--background-color); color: var(--text-color); padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; }
        .receipt-header { text-align: center; border-bottom: 2px solid var(--primary-light); padding-bottom: 15px; margin-bottom: 20px; }
        .receipt-header h2 { margin-bottom: 5px; color: var(--primary-light); }
        .receipt-student-photo { width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 3px solid var(--primary-light); }
        .receipt-details-grid { display: grid; grid-template-columns: auto 1fr; gap: 10px 20px; }
        .receipt-details-grid dt { font-weight: bold; color: var(--text-muted); }
        .receipt-footer { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center; font-size: 0.9rem; color: var(--text-muted); }
        .receipt-signature { margin-top: 50px; text-align: right; padding-right: 20px; }
        .receipt-signature-line { width: 200px; border-bottom: 1px solid var(--text-color); display: inline-block; margin-bottom: 5px; }

        #qr-scanner-container { width: 100%; max-width: 500px; margin: 20px auto; border: 1px solid var(--border-color); border-radius: 8px; }
        #qr-scan-result { text-align: center; margin-top: 20px; padding: 15px; border-radius: 8px; }
        #qr-scan-result.success { background-color: var(--success-color); color: white; }
        #qr-scan-result.error { background-color: var(--error-color); color: white; }
        #student-qr-code { padding: 20px; background: white; display: inline-block; border-radius: 8px; margin-top: 15px; }
        
        .id-card {
            width: 320px; border: 1px solid var(--border-color); border-radius: 15px;
            padding: 20px; font-family: sans-serif; margin: auto;
            background: var(--sidebar-bg);
        }
        .id-card-header { text-align: center; border-bottom: 2px solid var(--primary-light); padding-bottom: 10px; margin-bottom: 15px; }
        .id-card-header h3 { color: var(--primary-light); margin: 0; }
        .id-card-photo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 0 auto; display: block; border: 3px solid var(--primary-light); }
        .id-card-body { text-align: center; }
        .id-card-body h4 { margin-top: 15px; margin-bottom: 5px; font-size: 1.2rem; color: var(--text-color); }
        .id-card-body p { margin: 4px 0; color: var(--text-muted); font-size: 0.9rem; }
        .id-card-qr { margin-top: 15px; }
        .id-card-qr canvas, .id-card-qr img { margin: auto; }
        
        #fingerprint-status, #fingerprint-scan-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
            text-align: center;
        }
        
        .certificate-container {
            width: 800px;
            padding: 40px;
            border: 10px solid var(--primary-color);
            background: var(--background-color);
            position: relative;
            font-family: 'Times New Roman', serif;
        }
        .certificate-container::before {
            content: ''; position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border: 2px solid var(--primary-light);
            box-shadow: 0 0 15px var(--glow-color) inset;
        }
        .certificate-header { text-align: center; margin-bottom: 20px; }
        .certificate-header h1 { font-size: 2.8rem; color: var(--primary-light); font-weight: bold; }
        .certificate-header h2 { font-size: 1.5rem; color: var(--text-color); font-weight: normal; margin-top: -10px;}
        .certificate-student-photo {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            border: 4px solid var(--primary-light);
            margin: 0 auto 25px auto;
            display: block;
            box-shadow: 0 0 15px var(--glow-color);
        }
        .certificate-body { text-align: center; }
        .certificate-body p { font-size: 1.2rem; margin: 20px 0; color: var(--text-muted); }
        .certificate-body .student-name { font-size: 2.2rem; font-weight: bold; color: var(--text-color); border-bottom: 2px solid var(--border-color); display: inline-block; padding-bottom: 5px; margin-bottom: 15px; }
        .certificate-body .class-name { font-weight: bold; color: var(--primary-light); }
        .certificate-footer { display: flex; justify-content: space-between; margin-top: 60px; }
        .signature-block { text-align: center; }
        .signature-block .signature-line { border-top: 1px solid var(--text-color); width: 200px; margin-top: 40px; margin-bottom: 5px;}
        
        #student-lookup-results, #topper-lookup-results { max-height: 250px; overflow-y: auto; margin-top: 15px; }
        .lookup-result-item { display: flex; align-items: center; padding: 10px; border-radius: 8px; margin-bottom: 10px; background: var(--secondary-color); border: 1px solid var(--border-color); }
        .lookup-result-item:hover { background: var(--background-color); }
        .lookup-result-item img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 15px; }
        
        .recent-students-scroller {
            height: 300px;
            overflow: hidden;
            position: relative;
        }
        .recent-students-scroller .scroller-inner {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 0;
            width: 100%;
            animation: scroll-up 20s linear infinite;
        }
        .recent-students-scroller:hover .scroller-inner {
            animation-play-state: paused;
        }
        @keyframes scroll-up {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(-50%);
            }
        }
        .recent-students-scroller .lookup-result-item {
            cursor: pointer;
        }


        .monthly-attendance-table th, .monthly-attendance-table td {
            min-width: 40px;
            text-align: center;
            padding: 8px;
        }
        .monthly-attendance-table .sticky-col {
            position: sticky;
            left: 0;
            background-color: var(--sidebar-bg);
            z-index: 10;
            text-align: left;
            min-width: 150px;
        }
        .monthly-attendance-table .present-cell { color: var(--success-color); font-weight: bold; }
        .monthly-attendance-table .absent-cell { color: var(--error-color); font-weight: bold; }
        .monthly-attendance-table .weekend-cell { background-color: rgba(0,0,0,0.2); }
        
        /* UPDATED Grade Sheet Styles */
        .grade-sheet-container {
            width: 210mm; 
            min-height: 297mm;
            border: 1px solid #000;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #fff;
            color: #000;
            margin: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .grade-sheet-header { text-align: center; position: relative; padding-bottom: 10px; }
        .grade-sheet-header .logo { display: block; margin: 0 auto 10px auto; width: 130px; }
        .grade-sheet-header h1 { font-size: 24px; font-weight: bold; margin: 0; text-transform: uppercase; }
        .grade-sheet-header p { margin: 2px 0; font-size: 14px; }
        .grade-sheet-header h2 { font-size: 18px; font-weight: bold; margin: 8px 0;}
        .grade-sheet-header h4 { font-size: 18px; font-weight: bold; margin-top: 5px; border: 1px solid #000; display: inline-block; padding: 3px 10px;}
        
        .grade-sheet-details-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 10px 0;
            margin-bottom: 15px;
        }

        .grade-sheet-student-details { width: 100%; border-collapse: collapse; font-size: 14px; flex-grow: 1; }
        .grade-sheet-student-details td { padding: 4px 8px; }
        .grade-sheet-student-details strong { display: inline-block; width: 120px; font-weight: normal;}

        .grade-sheet-photo-qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
            margin-left: 20px;
            text-align: center;
        }
        .grade-sheet-student-photo-container {
             width: 100px; height: auto; border: 1px solid #000; padding: 2px; text-align: center;
        }
        .grade-sheet-student-photo-container img { width: 100%; height: 120px; object-fit: cover; }
        .grade-sheet-student-photo-container p { font-size: 12px; margin: 5px 0; font-weight: bold; }
        

        .grade-sheet-marks-table { width: 100%; margin-top: 15px; border-collapse: collapse; font-size: 14px; }
        .grade-sheet-marks-table th, .grade-sheet-marks-table td { border: 1px solid #000; padding: 6px; text-align: center; }
        .grade-sheet-marks-table td:nth-child(2) { text-align: left; }
        .grade-sheet-marks-table .total-row td { font-weight: bold; }

        .grade-sheet-co-curricular-section { margin-top: 15px; }
        .grade-sheet-co-curricular-section h5 { font-size: 16px; font-weight: bold; margin-bottom: 5px; text-align: left; }
        .grade-sheet-co-curricular-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .grade-sheet-co-curricular-table th, .grade-sheet-co-curricular-table td { border: 1px solid #000; padding: 6px; text-align: center; }
        .grade-sheet-co-curricular-table td:nth-child(1) { text-align: left; }

        .grade-sheet-summary { font-weight: bold; text-align: center; padding: 8px; border: 1px solid black; border-top: none; font-size: 15px; }

        .grade-sheet-footer-container { margin-top: 20px; padding-top: 10px; font-size: 14px; }
        .grade-sheet-footer-container .result-line { margin-bottom: 25px; }
        .grade-sheet-footer-container .result-line p { margin: 0; }
        .grade-sheet-footer-container .signatures { display: flex; justify-content: space-between; width: 100%; }
        .grade-sheet-footer-container .sig-block { text-align: center; width: 24%;}

        .grade-sheet-grading-scale-container { 
            width: 210mm; 
            min-height: 297mm;
            padding: 20px; 
            font-family: Arial, sans-serif; 
            color: #000;
            background: #fff;
            page-break-before: always; 
        }
        .grade-sheet-grading-scale-container h3 { text-align:center; font-weight: bold; margin-bottom: 20px;}
        .grade-sheet-grading-scale-table { width: 100%; max-width: 700px; margin: 20px auto; border-collapse: collapse; font-size: 12px;}
        .grade-sheet-grading-scale-table th, .grade-sheet-grading-scale-table td { border: 1px solid #000; padding: 5px; text-align: center;}
        .grade-sheet-grading-scale-table td:first-child, .grade-sheet-grading-scale-table td:last-child { text-align: left; padding-left: 10px;}
        .grade-sheet-grading-scale-formulas { width: 100%; max-width: 700px; margin: 20px auto; font-size: 12px;}
        .grade-sheet-grading-scale-formulas p { margin: 5px 0; }

        .payment-gateway-card {
            text-align: center;
        }
        .payment-gateway-card .upi-info {
            background: var(--background-color);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin: 20px 0;
        }
         .payment-gateway-card .upi-info p {
            margin: 5px 0;
         }
        .payment-gateway-card .upi-id {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-light);
            user-select: all;
        }

        .payment-gateway-card .upi-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
         .payment-gateway-card .upi-button {
            background: var(--secondary-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            text-decoration: none;
            transition: all 0.2s ease;
         }
         .payment-gateway-card .upi-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
         }
         .payment-gateway-card .upi-button img {
            width: 24px;
            height: 24px;
         }

        .school-photos-container, .placements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .school-photo-item, .placement-item {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        .school-photo-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }
         .placement-item a {
             text-decoration: none;
             color: inherit;
         }
         .placement-item img {
            width: 100%;
            height: 120px;
            object-fit: contain;
            padding: 10px;
            display: block;
            background: white;
        }
        .school-photo-item .photo-title, .placement-item .item-footer {
            padding: 15px;
            font-weight: 500;
        }
        .placement-item .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .scrolling-wrapper {
            overflow: hidden;
            padding: 20px 0;
            position: relative;
            width: 100%;
        }
        .scrolling-wrapper::before, .scrolling-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            width: 100px;
            height: 100%;
            z-index: 2;
        }
        .scrolling-wrapper::before {
            left: 0;
            background: linear-gradient(to right, var(--sidebar-bg) 0%, transparent 100%);
        }
        .scrolling-wrapper::after {
            right: 0;
            background: linear-gradient(to left, var(--sidebar-bg) 0%, transparent 100%);
        }

        .scroller {
            display: flex;
            width: max-content;
            animation: scroll-left 40s linear infinite;
        }
        .scroller:hover {
            animation-play-state: paused;
        }
        .scroller .placement-logo-item {
            display: block;
            height: 80px;
            margin: 0 30px;
            filter: grayscale(1);
            transition: filter 0.3s;
        }
        .scroller .placement-logo-item:hover {
            filter: grayscale(0);
        }
        .scroller .placement-logo-item img {
            height: 100%;
            width: auto;
        }
        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        #result-upload-marks-table input, #result-upload-marks-table select {
            width: 80px;
            text-align: center;
            padding: 8px;
            background: var(--background-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 4px;
        }
        #result-upload-summary {
            margin-top: 20px;
            padding: 15px;
            background: var(--secondary-color);
            border-radius: 8px;
            text-align: center;
        }
        
        .home-action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        .home-action-card {
            padding: 30px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            text-decoration: none;
        }
        .home-action-card i {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        .home-action-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px var(--glow-color-hover);
        }
        
        .home-action-card.home-action-card-admission {
            background: #c0392b; /* Red */
            color: #ffffff;
        }
        body.light-theme .home-action-card.home-action-card-admission {
             background: #e74c3c;
        }
        
        .home-action-card.home-action-card-enquiry {
            background: #2980b9; /* Blue */
            color: #ffffff;
        }
         body.light-theme .home-action-card.home-action-card-enquiry {
            background: #3498db;
        }

        .home-action-card.home-action-card-admission:hover,
        .home-action-card.home-action-card-enquiry:hover {
            opacity: 0.9;
        }
        
        /* UPDATED SLIDER STYLES */
        .slider-container {
            width: 100%;
            height: 450px;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        .slides {
            display: flex;
            width: 1000%; /* 100% * 10 images */
            height: 100%;
            transition: transform 0.5s ease-in-out;
        }
        .slide {
            width: 10%; /* 100% / 10 images */
            height: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .slide-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        .slide-overlay h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
        }
        .slide-overlay p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        .slide-overlay .action-button {
            padding: 15px 30px;
            font-size: 1.2rem;
        }

        .slider-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            padding: 0 20px;
        }
        .slider-nav button {
            background: rgba(0,0,0,0.5);
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            transition: background 0.3s;
        }
        .slider-nav button:hover {
            background: rgba(0,0,0,0.8);
        }

        .slider-dots {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: background 0.3s;
        }
        .dot.active {
            background: white;
        }
        
        .scrolling-courses-container {
            width: 100%;
            overflow: hidden;
            background: rgba(0,0,0,0.4);
            padding: 10px 0;
            margin-top: 20px;
        }
        .scrolling-courses {
            display: inline-block;
            white-space: nowrap;
            animation: scroll-courses 30s linear infinite;
            padding-left: 100%;
            font-weight: 500;
        }
        @keyframes scroll-courses {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        .important-links-grid {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
             gap: 15px;
        }
        .important-link-item {
            display: block;
            padding: 15px;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .important-link-item:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 10px var(--glow-color);
        }


         @media (max-width: 992px) {
            .profile-grid { grid-template-columns: 1fr; }
            #main-content { padding: 15px; }
            .footer-content { flex-direction: column; text-align: center; }
            .slider-container { height: 350px; }
            .slide-overlay h2 { font-size: 2rem; }
         }
        @media (max-width: 768px) {
             #sidebar { position: fixed; height: 100%; left: calc(-1 * var(--sidebar-width)); transition: left 0.3s ease; box-shadow: 5px 0 15px rgba(0,0,0,0.2); }
             .app-container.sidebar-collapsed #sidebar { margin-left: 0; }
             body:not(.sidebar-open) .app-container.sidebar-collapsed #sidebar { left: calc(-1 * var(--sidebar-width)); }
             body.sidebar-open #sidebar { left: 0; }
             .header-title-container { display: none; }
             .form-grid { grid-template-columns: 1fr; }
             .slider-container { height: 300px; }
             .slide-overlay h2 { font-size: 1.5rem; }
             .slide-overlay p { font-size: 1rem; }
             .slide-overlay .action-button { padding: 10px 20px; font-size: 1rem; }
             .slider-nav button { width: 40px; height: 40px; font-size: 1.5rem; }
        }
        
        body.printing {
            padding: 0;
            margin: 0;
            background: #fff !important;
        }
        body.printing #printable-content-area {
            display: block;
        }
        body.printing > *:not(#printable-content-area) {
            display: none !important;
        }

        @media print {
            body, .printable-area {
                background: #ffffff !important;
                color: #000000 !important;
            }
            body > *:not(#printable-content-area) {
                display: none !important;
            }
            #printable-content-area {
                display: block !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: auto;
            }
            .printable-area {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                box-shadow: none !important;
                border: none !important;
                page-break-inside: avoid !important;
            }
            .printable-area *, .printable-area {
                background: #ffffff !important;
                color: #000000 !important;
                box-shadow: none !important;
                text-shadow: none !important;
            }
             .no-print { display: none !important; }

            .grade-sheet-container {
                border: 1px solid #000 !important;
                width: 100%;
                height: 100%;
            }
            .grade-sheet-marks-table th, .grade-sheet-marks-table td,
            .grade-sheet-co-curricular-table th, .grade-sheet-co-curricular-table td {
                 border: 1px solid #000 !important;
            }
            .grade-sheet-student-photo-container {
                border: 1px solid #000 !important;
            }
             .grade-sheet-grading-scale-container {
                page-break-before: always !important;
             }
             .grade-sheet-grading-scale-table th, .grade-sheet-grading-scale-table td {
                border: 1px solid #000 !important;
             }
             .grade-sheet-header .qr-code canvas { display: none !important; }
             .grade-sheet-header .qr-code img { display: block !important; margin: auto !important; }

            @page {
                size: A4; 
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div id="app-wrapper">
        <div id="loading-overlay" style="display: none;"><div class="loader"></div></div>

        <div class="app-container" id="app-container">
            <aside id="sidebar"></aside>
            <div class="main-wrapper" id="main-wrapper">
                <main id="main-content"></main>
                <footer id="main-footer" class="no-print"></footer>
            </div>
        </div>

        <div id="modal-container"></div>
        <div id="toast-container"></div>
    </div>
    <div id="printable-content-area" style="display: none;"></div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const getEl = (id) => document.getElementById(id);
            const { jsPDF } = window.jspdf;
            let html5QrCode = null;
            let feePaymentTimer = null;

            const sliderImages = [
                
            "https://images.shiksha.com/mediadata/images/1537423767phpX9qQyx.jpeg",
            "https://smsvaranasi.com/uploads/page_images/79055Green-Initiative.png",
            "data:image/jpeg;base64,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",
             "https://image-static.collegedunia.com/public/college_data/images/campusimage/1745395512Screenshot%202025-04-23%20133354.png",
             
              "data:image/jpeg;base64,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",
              "data:image/jpeg;base64,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",
              "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSeUW0nlz6IdPHl9fY7mpXYJClxvPpj_RSCXQ&s",
              "https://media.collegedekho.com/media/img/institute/crawled_images/14182890591.jpg",
              "https://smsvaranasi.com/uploads/news/951/main-qimg-89905d1678219545de532d19d3b40317-c.jpg",
              "data:image/jpeg;base64,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",
              ];
            let state = {
                loggedInUser: null,
                data: {},
                currentPage: 'home',
                currentView: 'list',
                currentItemId: null,
                studentListFilter: null,
            };

            const courseOptionsList = ['MBA', 'MCA', 'M.Com', 'BBA', 'BCA', 'B.Com', 'B.Com (Hons)', 'BA (Hons) Mass Communication'];
            const examCategoriesList = ['Odd Semester', 'Even Semester', 'Sessional Test 1', 'Sessional Test 2'];
            
            const config = {
                pages: {
                    home: { title: 'Admin Dashboard', icon: 'fa-home', renderer: renderHomePage, roles: ['admin', 'guest'] },
                    
                    publicProfile: { title: 'Find Profile', icon: 'fa-search', renderer: renderPublicProfileSearchPage, roles: ['guest'] },

                    studentDashboard: { title: 'Dashboard', icon: 'fa-home', renderer: renderStudentDashboardPage, roles: ['student', 'parent'] },
                    studentProfile: { title: 'My Profile', icon: 'fa-user-circle', renderer: renderStudentProfileView, roles: ['student', 'parent'] },
                    studentAttendance: { title: 'My Attendance', icon: 'fa-calendar-check', renderer: renderStudentAttendanceView, roles: ['student', 'parent'] },
                    studentHomework: { title: 'Homework', icon: 'fa-book-open', renderer: renderStudentHomeworkView, roles: ['student', 'parent'] },
                    studentFeePayment: { title: 'Fee Payment', icon: 'fa-rupee-sign', renderer: renderFeePaymentPortalPage, roles: ['student', 'parent'] },

                    teacherDashboard: { title: 'Dashboard', icon: 'fa-home', renderer: renderTeacherDashboardPage, roles: ['teacher'] },

                    admission: { title: 'Admission', icon: 'fa-user-plus', renderer: renderAdmissionPage, roles: ['admin', 'guest'] },
                    students: { title: 'Students', icon: 'fa-user-graduate', renderer: renderStudentPage, roles: ['admin'], subPages: {
                        studentList: { title: 'Student List', icon: 'fa-users', renderer: renderStudentPage, roles: ['admin'] },
                        promoteStudents: { title: 'Promote Students', icon: 'fa-arrow-up', renderer: renderPromoteStudentsPage, roles: ['admin'] },
                    }},
                    teachers: { title: 'Teachers', icon: 'fa-chalkboard-teacher', roles: ['admin'], subPages: {
                        teacherList: { title: 'Teacher List', icon: 'fa-users-cog', renderer: renderTeacherPage, roles: ['admin'] },
                        teacherAttendance: { title: 'Teacher Attendance', icon: 'fa-user-check', renderer: renderTeacherAttendancePage, roles: ['admin'] },
                    }},
                    staff: { title: 'Staff', icon: 'fa-user-friends', roles: ['admin'], subPages: {
                        staffList: { title: 'Staff List', icon: 'fa-users', renderer: renderStaffPage, roles: ['admin'] },
                        staffAttendance: { title: 'Staff Attendance', icon: 'fa-user-check', renderer: renderStaffAttendancePage, roles: ['admin'] },
                    }},
                    academics: { title: 'Academics', icon: 'fa-university', roles: ['admin'], subPages: {
                        homework: { title: 'Homework', icon: 'fa-book-open', renderer: renderHomeworkPage, roles: ['admin'] },
                        timetable: { title: 'Timetable', icon: 'fa-calendar-alt', renderer: renderTimetablePage, roles: ['admin'] },
                        exams: { title: 'Exams', icon: 'fa-file-signature', renderer: renderExamsPage, roles: ['admin'] },
                        marksheetManager: { title: 'Grade Sheet Manager', icon: 'fa-marker', renderer: renderMarksheetManagerPage, roles: ['admin'] },
                    }},
                    adminStudentAttendance: { title: 'Student Attendance', icon: 'fa-calendar-check', renderer: setupAttendancePage, roles: ['admin', 'teacher'] },
                    financials: { title: 'Financials', icon: 'fa-wallet', roles: ['admin'], subPages: {
                        income: { title: 'Income', icon: 'fa-dollar-sign', renderer: renderFinancialsPage, roles: ['admin']},
                        expenses: { title: 'Expenses', icon: 'fa-file-invoice-dollar', renderer: renderExpensesPage, roles: ['admin']},
                    }},
                    feePaymentPortal: { title: 'Fee Payment', icon: 'fa-rupee-sign', renderer: renderFeePaymentPortalPage, roles: ['guest'] },
                    events: { title: 'Events', icon: 'fa-calendar-star', renderer: renderEventsPage, roles: ['admin', 'guest'] },
                    library: { title: 'Library', icon: 'fa-book', roles: ['admin', 'guest'], subPages: {
                        bookList: { title: 'Book List', icon: 'fa-book-bookmark', renderer: renderBookListPage, roles: ['admin', 'guest'] },
                        issueReturn: { title: 'Issue / Return', icon: 'fa-right-left', renderer: renderIssueReturnPage, roles: ['admin'] }
                    }},
                    facility: { 
                        title: 'Facility', 
                        icon: 'fa-building', 
                        roles: ['guest', 'admin', 'student', 'parent', 'teacher'], 
                        subPages: {
                            placeholder1: { title: 'Our Campus', icon: 'fa-school', renderer: () => renderPlaceholderPage("Our Campus"), roles: ['guest', 'admin', 'student', 'parent', 'teacher'] },
                            placeholder2: { title: 'Library Info', icon: 'fa-book', renderer: () => renderPlaceholderPage("Library Info"), roles: ['guest', 'admin', 'student', 'parent', 'teacher'] }
                        } 
                    },
                    noticeBoard: { title: 'Notice Board', icon: 'fa-bullhorn', renderer: renderNoticeBoardPage, roles: ['admin', 'guest', 'student', 'parent', 'teacher'] },
                    admitCardPortal: { title: 'Admit Card', icon: 'fa-id-card', renderer: renderAdmitCardPortalPage, roles: ['admin', 'guest', 'student', 'parent', 'teacher'] },
                    resultPortal: { title: 'Result Portal', icon: 'fa-award', renderer: renderResultPortalPage, roles: ['admin', 'guest', 'student', 'parent', 'teacher'] },
                    certificates: { title: 'Certificates', icon: 'fa-certificate', renderer: renderCertificatePage, roles: ['admin'] },
                    media: { title: 'Media', icon: 'fa-photo-video', roles: ['admin', 'guest'], subPages: {
                        gallery: { title: 'Photo Gallery', icon: 'fa-images', renderer: renderGalleryPage, roles: ['admin', 'guest'] },
                        videos: { title: 'Video Gallery', icon: 'fa-video', renderer: renderVideosPage, roles: ['admin', 'guest'] },
                    }},
                    inquiries: { title: 'Inquiries', icon: 'fa-question-circle', renderer: renderInquiriesPage, roles: ['admin', 'guest'] },
                    adminNotes: { title: 'Admin Notes', icon: 'fa-sticky-note', renderer: renderNotesPage, roles: ['admin'] },
                    settings: {
                        title: 'Settings',
                        icon: 'fa-cog',
                        roles: ['admin'],
                        subPages: {
                            account: { title: 'User Account', icon: 'fa-user-circle', renderer: renderAccountSettingsPage, roles: ['admin'] },
                            appearance: { title: 'Appearance', icon: 'fa-paint-brush', renderer: renderAppearanceSettingsPage, roles: ['admin'] },
                            schoolInfo: { title: 'School Info', icon: 'fa-school', renderer: renderSchoolInfoSettingsPage, roles: ['admin'] },
                            content: { title: 'Site Content', icon: 'fa-file-alt', renderer: renderContentSettingsPage, roles: ['admin'] },
                            schoolPhotos: { title: 'School Photos', icon: 'fa-image', renderer: renderSchoolPhotosSettingsPage, roles: ['admin'] },
                            placements: { title: 'Manage Placements', icon: 'fa-handshake', renderer: renderPlacementSettingsPage, roles: ['admin']},
                            uploadResult: { title: 'Upload Result', icon: 'fa-file-upload', renderer: renderUploadResultPage, roles: ['admin'] }, 
                            setTopper: { title: 'Set Toppers', icon: 'fa-crown', renderer: renderSetTopperPage, roles: ['admin'] }, 
                            manageLinks: { title: 'Manage Links', icon: 'fa-link', renderer: renderManageLinksPage, roles: ['admin'] },
                            data: { title: 'Data Management', icon: 'fa-database', renderer: renderDataSettingsPage, roles: ['admin'] },
                        }
                    },
                },
                 accentColors: {
                    teal: { primary: '#16a085', light: '#1abc9c' },
                    blue: { primary: '#2980b9', light: '#3498db' },
                    purple: { primary: '#8e44ad', light: '#9b59b6' },
                    green: { primary: '#27ae60', light: '#2ecc71' },
                    orange: { primary: '#d35400', light: '#e67e22' },
                    red: { primary: '#c0392b', light: '#e74c3c' },
                }
            };
            
            const indianStatesData = { "Andaman and Nicobar Islands": ["Nicobar", "North and Middle Andaman", "South Andaman"], "Andhra Pradesh": ["Anantapur", "Chittoor", "East Godavari", "Guntur", "Krishna", "Kurnool", "Prakasam", "Srikakulam", "Sri Potti Sriramulu Nellore", "Visakhapatnam", "Vizianagaram", "West Godavari", "Y.S.R. Kadapa"], "Arunachal Pradesh": ["Anjaw", "Changlang", "Dibang Valley", "East Kameng", "East Siang", "Kamle", "Kra Daadi", "Kurung Kumey", "Lepa Rada", "Lohit", "Longding", "Lower Dibang Valley", "Lower Siang", "Lower Subansiri", "Namsai", "Pakke Kessang", "Papum Pare", "Shi Yomi", "Siang", "Tawang", "Tirap", "Upper Siang", "Upper Subansiri", "West Kameng", "West Siang"], "Assam": ["Baksa", "Barpeta", "Biswanath", "Bongaigaon", "Cachar", "Charaideo", "Chirang", "Darrang", "Dhemaji", "Dhubri", "Dibrugarh", "Dima Hasao", "Goalpara", "Golaghat", "Hailakandi", "Hojai", "Jorhat", "Kamrup", "Kamrup Metropolitan", "Karbi Anglong", "Karimganj", "Kokrajhar", "Lakhimpur", "Majuli", "Morigaon", "Nagaon", "Nalbari", "Sivasagar", "Sonitpur", "South Salmara-Mankachar", "Tinsukia", "Udalguri", "West Karbi Anglong"], "Bihar": ["Araria", "Arwal", "Aurangabad", "Banka", "Begusarai", "Bhagalpur", "Bhojpur", "Buxar", "Darbhanga", "East Champaran", "Gaya", "Gopalganj", "Jamui", "Jehanabad", "Kaimur", "Katihar", "Khagaria", "Kishanganj", "Lakhisarai", "Madhepura", "Madhubani", "Munger", "Muzaffarpur", "Nalanda", "Nawada", "Patna", "Purnia", "Rohtas", "Saharsa", "Samastipur", "Saran", "Sheikhpura", "Sheohar", "Sitamarhi", "Siwan", "Supaul", "Vaishali", "West Champaran"], "Chandigarh": ["Chandigarh"], "Chhattisgarh": ["Balod", "Baloda Bazar", "Balrampur", "Bastar", "Bemetara", "Bijapur", "Bilaspur", "Dantewada", "Dhamtari", "Durg", "Gariaband", "Gaurela Pendra Marwahi", "Janjgir-Champa", "Jashpur", "Kabirdham", "Kanker", "Kondagaon", "Korba", "Koriya", "Mahasamund", "Mungeli", "Narayanpur", "Raigarh", "Raipur", "Rajnandgaon", "Sukma", "Surajpur", "Surguja"], "Dadra and Nagar Haveli and Daman and Diu": ["Daman", "Diu", "Dadra and Nagar Haveli"], "Delhi": ["Central Delhi", "East Delhi", "New Delhi", "North Delhi", "North East Delhi", "North West Delhi", "Shahdara", "South Delhi", "South East Delhi", "South West Delhi", "West Delhi"], "Goa": ["North Goa", "South Goa"], "Gujarat": ["Ahmedabad", "Amreli", "Anand", "Aravalli", "Banaskantha", "Bharuch", "Bhavnagar", "Botad", "Chhota Udaipur", "Dahod", "Dang", "Devbhoomi Dwarka", "Gandhinagar", "Gir Somnath", "Jamnagar", "Junagadh", "Kheda", "Kutch", "Mahisagar", "Mehsana", "Morbi", "Narmada", "Navsari", "Panchmahal", "Patan", "Porbandar", "Rajkot", "Sabarkantha", "Surat", "Surendranagar", "Tapi", "Vadodara", "Valsad"], "Haryana": ["Ambala", "Bhiwani", "Charkhi Dadri", "Faridabad", "Fatehabad", "Gurugram", "Hisar", "Jhajjar", "Jind", "Kaithal", "Karnal", "Kurukshetra", "Mahendragarh", "Nuh", "Palwal", "Panchkula", "Panipat", "Rewari", "Rohtak", "Sirsa", "Sonipat", "Yamunanagar"], "Himachal Pradesh": ["Bilaspur", "Chamba", "Hamirpur", "Kangra", "Kinnaur", "Kullu", "Lahaul and Spiti", "Mandi", "Shimla", "Sirmaur", "Solan", "Una"], "Jammu and Kashmir": ["Anantnag", "Bandipora", "Baramulla", "Budgam", "Doda", "Ganderbal", "Jammu", "Kathua", "Kishtwar", "Kulgam", "Kupwara", "Poonch", "Pulwama", "Rajouri", "Ramban", "Reasi", "Samba", "Shopian", "Srinagar", "Udhampur"], "Jharkhand": ["Bokaro", "Chatra", "Deoghar", "Dhanbad", "Dumka", "East Singhbhum", "Garhwa", "Giridih", "Godda", "Gumla", "Hazaribagh", "Jamtara", "Khunti", "Koderma", "Latehar", "Lohardaga", "Pakur", "Palamu", "Ramgarh", "Ranchi", "Sahebganj", "Seraikela Kharsawan", "Simdega", "West Singhbhum"], "Karnataka": ["Bagalkot", "Ballari", "Belagavi", "Bengaluru Rural", "Bengaluru Urban", "Bidar", "Chamarajanagar", "Chikkaballapur", "Chikkamagaluru", "Chitradurga", "Dakshina Kannada", "Davanagere", "Dharwad", "Gadag", "Hassan", "Haveri", "Kalaburagi", "Kodagu", "Kolar", "Koppal", "Mandya", "Mysuru", "Raichur", "Ramanagara", "Shivamogga", "Tumakuru", "Udupi", "Uttara Kannada", "Vijayapura", "Yadgir"], "Kerala": ["Alappuzha", "Ernakulam", "Idukki", "Kannur", "Kasaragod", "Kollam", "Kottayam", "Kozhikode", "Malappurham", "Palakkad", "Pathanamthitta", "Thiruvananthapuram", "Thrissur", "Wayanad"], "Ladakh": ["Kargil", "Leh"], "Lakshadweep": ["Lakshadweep"], "Madhya Pradesh": ["Agar Malwa", "Alirajpur", "Anuppur", "Ashoknagar", "Balaghat", "Barwani", "Betul", "Bhind", "Bhopal", "Burhanpur", "Chhatarpur", "Chhindwara", "Damoh", "Datia", "Dewas", "Dhar", "Dindori", "Guna", "Gwalior", "Harda", "Hoshangabad", "Indore", "Jabalpur", "Jhabua", "Katni", "Khandwa", "Khargone", "Mandla", "Mandsaur", "Morena", "Narsinghpur", "Neemuch", "Panna", "Raisen", "Rajgarh", "Ratlam", "Rewa", "Sagar", "Satna", "Sehore", "Seoni", "Shahdol", "Shajapur", "Sheopur", "Shivpuri", "Sidhi", "Singrauli", "Tikamgarh", "Ujjain", "Umaria", "Vidisha"], "Maharashtra": ["Ahmednagar", "Akola", "Amravati", "Aurangabad", "Beed", "Bhandara", "Buldhana", "Chandrapur", "Dhule", "Gadchiroli", "Gondia", "Hingoli", "Jalgaon", "Jalna", "Kolhapur", "Latur", "Mumbai City", "Mumbai Suburban", "Nagpur", "Nanded", "Nandurbar", "Nashik", "Osmanabad", "Palghar", "Parbhani", "Pune", "Raigad", "Ratnagiri", "Sangli", "Satara", "Sindhudurg", "Solapur", "Thane", "Wardha", "Washim", "Yavatmal"], "Manipur": ["Bishnupur", "Chandel", "Churachandpur", "Imphal East", "Imphal West", "Jiribam", "Kakching", "Kamjong", "Kangpokpi", "Noney", "Pherzawl", "Senapati", "Tamenglong", "Tengnoupal", "Thoubal", "Ukhrul"], "Meghalaya": ["East Garo Hills", "East Jaintia Hills", "East Khasi Hills", "North Garo Hills", "Ri Bhoi", "South Garo Hills", "South West Garo Hills", "South West Khasi Hills", "West Garo Hills", "West Jaintia Hills", "West Khasi Hills"], "Mizoram": ["Aizawl", "Champhai", "Hnahthial", "Khawzawl", "Kolasib", "Lawngtlai", "Lunglei", "Mamit", "Saiha", "Saitual", "Serchhip"], "Nagaland": ["Dimapur", "Kiphire", "Kohima", "Longleng", "Mokokchung", "Mon", "Peren", "Phek", "Tuensang", "Wokha", "Zunheboto"], "Odisha": ["Angul", "Balangir", "Balasore", "Bargarh", "Bhadrak", "Boudh", "Cuttack", "Deogarh", "Dhenkanal", "Gajapati", "Ganjam", "Jagatsinghpur", "Jajpur", "Jharsuguda", "Kalahandi", "Kandhamal", "Kendrapara", "Kendujhar", "Khordha", "Koraput", "Malkangiri", "Mayurbhanj", "Nabarangpur", "Nayagarh", "Nuapada", "Puri", "Rayagada", "Sambalpur", "Subarnapur", "Sundargarh"], "Puducherry": ["Karaikal", "Mahe", "Puducherry", "Yanam"], "Punjab": ["Amritsar", "Barnala", "Bathinda", "Faridkot", "Fatehgarh Sahib", "Fazilka", "Ferozepur", "Gurdaspur", "Hoshiarpur", "Jalandhar", "Kapurthala", "Ludhiana", "Mansa", "Moga", "Pathankot", "Patiala", "Rupnagar", "Sahibzada Ajit Singh Nagar", "Sangrur", "Shahid Bhagat Singh Nagar", "Sri Muktsar Sahib", "Tarn Taran"], "Rajasthan": ["Ajmer", "Alwar", "Banswara", "Baran", "Barmer", "Bharatpur", "Bhilwara", "Bikaner", "Bundi", "Chittorgarh", "Churu", "Dausa", "Dholpur", "Dungarpur", "Hanumangarh", "Jaipur", "Jaisalmer", "Jalore", "Jhalawar", "Jhunjhunu", "Jodhpur", "Karauli", "Kota", "Nagaur", "Pali", "Pratapgarh", "Rajsamand", "Sawai Madhopur", "Sikar", "Sirohi", "Sri Ganganagar", "Tonk", "Udaipur"], "Sikkim": ["East Sikkim", "North Sikkim", "South Sikkim", "West Sikkim"], "Tamil Nadu": ["Ariyalur", "Chengalpattu", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri", "Dindigul", "Erode", "Kallakurichi", "Kanchipuram", "Kanyakumari", "Karur", "Krishnagiri", "Madurai", "Mayiladuthurai", "Nagapattinam", "Namakkal", "Nilgiris", "Perambalur", "Pudukkottai", "Ramanathapuram", "Ranipet", "Salem", "Sivaganga", "Tenkasi", "Thanjavur", "Theni", "Thoothukudi", "Tiruchirappalli", "Tirunelveli", "Tirupathur", "Tiruppur", "Tiruvallur", "Tiruvannamalai", "Tiruvarur", "Vellore", "Viluppuram", "Virudhunagar"], "Telangana": ["Adilabad", "Bhadradri Kothagudem", "Hyderabad", "Jagtial", "Jangaon", "Jayashankar Bhupalpally", "Jogulamba Gadwal", "Kamareddy", "Karimnagar", "Khammam", "Komaram Bheem", "Mahabubabad", "Mahabubnagar", "Mancherial", "Medak", "Medchal-Malkajgiri", "Mulugu", "Nagarkurnool", "Nalgonda", "Narayanpet", "Nirmal", "Nizamabad", "Peddapalli", "Rajanna Sircilla", "Ranga Reddy", "Sangareddy", "Siddipet", "Suryapet", "Vikarabad", "Wanaparthy", "Warangal Rural", "Warangal Urban", "Yadadri Bhuvanagiri"], "Tripura": ["Dhalai", "Gomati", "Khowai", "North Tripura", "Sepahijala", "South Tripura", "Unakoti", "West Tripura"], "Uttar Pradesh": ["Agra", "Aligarh", "Ambedkar Nagar", "Amethi", "Amroha", "Auraiya", "Ayodhya", "Azamgarh", "Baghpat", "Bahraich", "Ballia", "Balrampur", "Banda", "Barabanki", "Bareilly", "Basti", "Bhadohi", "Bijnor", "Budaun", "Bulandshahr", "Chandauli", "Chitrakoot", "Deoria", "Etah", "Etawah", "Farrukhabad", "Fatehpur", "Firozabad", "Gautam Buddha Nagar", "Ghaziabad", "Ghazipur", "Gonda", "Gorakhpur", "Hamirpur", "Hapur", "Hardoi", "Hathras", "Jalaun", "Jaunpur", "Jhansi", "Kannauj", "Kanpur Dehat", "Kanpur Nagar", "Kasganj", "Kaushambi", "Kheri", "Kushinagar", "Lalitpur", "Lucknow", "Maharajganj", "Mahoba", "Mainpuri", "Mathura", "Mau", "Meerut", "Mirzapur", "Moradabad", "Muzaffarnagar", "Pilibhit", "Pratapgarh", "Prayagraj", "Raebareli", "Rampur", "Saharanpur", "Sambhal", "Sant Kabir Nagar", "Shahjahanpur", "Shamli", "Shravasti", "Siddharthnagar", "Sitapur", "Sonbhadra", "Sultanpur", "Unnao", "Varanasi"], "Uttarakhand": ["Almora", "Bageshwar", "Chamoli", "Champawat", "Dehradun", "Haridwar", "Nainital", "Pauri Garhwal", "Pithoragarh", "Rudraprayag", "Tehri Garhwal", "Udham Singh Nagar", "Uttarkashi"], "West Bengal": ["Alipurduar", "Bankura", "Birbhum", "Cooch Behar", "Dakshin Dinajpur", "Darjeeling", "Hooghly", "Howrah", "Jalpaiguri", "Jhargram", "Kalimpong", "Kolkata", "Malda", "Murshidabad", "Nadia", "North 24 Parganas", "Paschim Bardhaman", "Paschim Medinipur", "Purba Bardhaman", "Purba Medinipur", "Purulia", "South 24 Parganas", "Uttar Dinajpur"] };

            function findPageConfig(pageKey) {
                if (config.pages[pageKey]) return config.pages[pageKey];
                for (const key in config.pages) {
                    if (config.pages[key].subPages && config.pages[key].subPages[pageKey]) {
                        return config.pages[key].subPages[pageKey];
                    }
                }
                return null;
            }

            const saveData = () => {
                try {
                    localStorage.setItem('schoolData', JSON.stringify(state.data));
                } catch (e) {
                    console.error("Error saving data:", e);
                    showToast("Error saving data. Storage might be full.", "error");
                }
            };

            const loadData = () => {
                const savedData = localStorage.getItem('schoolData');
                state.data = savedData ? JSON.parse(savedData) : {};
                
                ['students', 'transactions', 'adminNotes', 'gallery', 'videos', 'inquiries', 'expenses', 'notices', 'teachers', 'timetables', 'staff', 'examMasters', 'examSchedules', 'homework', 'events', 'books', 'issuedBooks', 'schoolPhotos', 'externalLinks', 'placements'].forEach(key => {
                    if (!state.data[key]) state.data[key] = [];
                });
                
                if(!state.data.studentAttendance) state.data.studentAttendance = {};
                if(!state.data.teacherAttendance) state.data.teacherAttendance = {};
                if(!state.data.staffAttendance) state.data.staffAttendance = {};
                if(!state.data.marks) state.data.marks = {};
                
                if (!state.data.siteContent) {
                    state.data.siteContent = {};
                }
                
                if (!state.data.coCurricular) {
                    state.data.coCurricular = [];
                }

                if (!state.data.placements || state.data.placements.length === 0) {
                    state.data.placements = [
                        {id: "pl1", name: "TCS", logo: "https://upload.wikimedia.org/wikipedia/commons/b/b1/TCS_Logo.svg", url: "https://www.tcs.com"},
                        {id: "pl2", name: "Infosys", logo: "https://upload.wikimedia.org/wikipedia/commons/9/95/Infosys_logo.svg", url: "https://www.infosys.com"},
                        {id: "pl3", name: "Wipro", logo: "https://upload.wikimedia.org/wikipedia/commons/a/a0/Wipro_Primary_Logo_Color_RGB.svg", url: "https://www.wipro.com"},
                        {id: "pl4", name: "HCL", logo: "https://upload.wikimedia.org/wikipedia/commons/4/4c/HCL_Technologies_logo.svg", url: "https://www.hcltech.com"},
                        {id: "pl5", name: "ICICI Bank", logo: "https://upload.wikimedia.org/wikipedia/commons/1/12/ICICI_Bank_Logo.svg", url: "https://www.icicibank.com"},
                        {id: "pl6", name: "Genpact", logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/Genpact_logo.svg/2560px-Genpact_logo.svg.png", url: "https://www.genpact.com"},
                        {id: "pl7", name: "Aditya Birla Group", logo: "https://upload.wikimedia.org/wikipedia/en/thumb/5/5b/Aditya_Birla_Group_Logo.svg/1200px-Aditya_Birla_Group_Logo.svg.png", url: "https://www.adityabirla.com"}
                    ];
                }

                if (!state.data.externalLinks || state.data.externalLinks.length === 0) {
                    state.data.externalLinks = [
                        { id: 'el1', title: 'CONTACT US', url: 'https://smsvaranasi.com/contact-us.php', specialAction: null },
                        { id: 'el2', title: 'APPLY ONLINE', url: 'https://smsvaranasi.com/admission/online-admission.php', specialAction: 'admission' },
                        { id: 'el3', title: 'ONLINE FEE DEPOSIT', url: 'https://smsvaranasi.com/fee-deposit.php', specialAction: 'feePaymentPortal' },
                        { id: 'el4', title: 'JOBS@SMS', url: 'https://smsvaranasi.com/jobs-at-sms.php', specialAction: null },
                        { id: 'el5', title: 'BLOG', url: 'https://smsvaranasi.com/blog/', specialAction: null },
                        { id: 'el6', title: 'IQAC', url: 'https://smsvaranasi.com/iqac.php', specialAction: null },
                        { id: 'el7', title: 'NIRF', url: 'https://www.nirfindia.org/Home', specialAction: null },
                        { id: 'el9', title: 'CUET(UG)', url: 'https://exams.nta.ac.in/CUET-UG/', specialAction: null },
                        { id: 'el10', title: 'CUET(PG)', url: 'https://pgcuet.samarth.ac.in/', specialAction: null },
                        { id: 'el11', title: 'Sarkari Result', url: 'https://www.sarkariresult.com/', specialAction: null },
                    ];
                }
                
                state.data.siteContent.schoolName = "School of Management Sciences";
                state.data.siteContent.schoolAddress = "Khushipur, P.O-Bachhaon, Varanasi-221011, Uttar Pradesh (India)";
                state.data.siteContent.schoolContact = "07052055555";
                state.data.siteContent.schoolEmail = "info@smsvaranasi.com";
                state.data.siteContent.schoolFounded = "1995";
                state.data.siteContent.schoolUpiId = "9455597760-2@ybl";
                state.data.siteContent.schoolState = "Uttar Pradesh";
                state.data.siteContent.schoolDistrict = "Varanasi";

                 if (typeof state.data.siteContent.manualTopperStudentId !== 'undefined') {
                    if(state.data.siteContent.manualTopperStudentId) {
                       state.data.siteContent.manualTopperStudentIds = [state.data.siteContent.manualTopperStudentId];
                    }
                    delete state.data.siteContent.manualTopperStudentId;
                }
                 if (!state.data.siteContent.manualTopperStudentIds) {
                     state.data.siteContent.manualTopperStudentIds = [];
                 }
            };

            const navigate = (page, view = 'list', id = null, filter = null) => {
                closeModal();
                if (window.innerWidth <= 768 && document.body.classList.contains('sidebar-open')) {
                     document.body.classList.remove('sidebar-open');
                }

                const userRole = state.loggedInUser?.role || 'guest';
                const pageConfig = findPageConfig(page);
                
                let fallbackPage = 'home';
                if(userRole === 'student' || userRole === 'parent') fallbackPage = 'studentDashboard';
                if(userRole === 'teacher') fallbackPage = 'teacherDashboard';

                if (!pageConfig || !pageConfig.roles.includes(userRole)) {
                    showToast("Access Denied.", "error");
                    if (state.currentPage !== fallbackPage) {
                        page = fallbackPage;
                    } else {
                        return;
                    }
                }
                
                const historyState = { page, view, id, filter };
                let hash = page;
                if(view !== 'list') hash += `/${view}`;
                if(id) hash += `/${id}`;

                if (window.location.hash !== `#${hash}`) {
                     history.pushState(historyState, '', `#${hash}`);
                }
                
                applyState(historyState);
            };
            
            const applyState = (newState) => {
                state.currentPage = newState.page;
                state.currentView = newState.view || 'list';
                state.currentItemId = newState.id || null;
                state.studentListFilter = (newState.page === 'students' && newState.view === 'list') ? (newState.filter || null) : null;
                
                renderUI();
                getEl('main-wrapper').scrollTop = 0;
            }

            const renderUI = () => {
                const userRole = state.loggedInUser?.role || 'guest';
                const pageConfig = findPageConfig(state.currentPage);
                
                if (!pageConfig || !pageConfig.roles.includes(userRole)) {
                    let fallbackPage = 'home';
                    if(userRole === 'student' || userRole === 'parent') fallbackPage = 'studentDashboard';
                    if(userRole === 'teacher') fallbackPage = 'teacherDashboard';
                    navigate(fallbackPage);
                    return;
                }

                getEl('app-container').style.display = 'flex';
                
                renderSidebar();
                renderMainFooter();

                if (pageConfig && typeof pageConfig.renderer === 'function') {
                    getEl('main-content').innerHTML = '';
                    pageConfig.renderer();
                    
                    const menuToggle = document.querySelector('.menu-toggle');
                    if (menuToggle) menuToggle.onclick = toggleSidebar;
                    
                    const themeCycleBtn = getEl('theme-cycle-btn');
                    if(themeCycleBtn) themeCycleBtn.onclick = cycleAccentColor;
                    
                    const themeModeBtn = getEl('theme-mode-btn');
                    if(themeModeBtn) {
                       themeModeBtn.onclick = toggleThemeMode;
                       themeModeBtn.innerHTML = `<i class="fas ${document.body.classList.contains('light-theme') ? 'fa-moon' : 'fa-sun'}"></i>`;
                    }

                } else {
                    let fallbackPage = 'home';
                    if(userRole === 'student' || userRole === 'parent') fallbackPage = 'studentDashboard';
                    if(userRole === 'teacher') fallbackPage = 'teacherDashboard';
                    navigate(fallbackPage);
                }
            };
            
            const checkAuth = () => {
                initTheme();
                initAccentColor();
                initFontWeight(); 
                initSidebarState();
                
                const loggedInUserData = localStorage.getItem('loggedInUser');
                state.loggedInUser = loggedInUserData ? JSON.parse(loggedInUserData) : null;
                
                loadData();
                
                handleRouteChange();
                startClock();
            };

            const handleRouteChange = () => {
                let path = window.location.hash.substring(1);
                let page, view, id, filter;
                let newState = {};

                if (path) {
                    const parts = path.split('/');
                    page = parts[0] || 'home';
                    view = parts[1] || 'list';
                    id = parts[2] || null;
                } else {
                    page = 'home';
                    view = 'list';
                    id = null;
                }
                
                const urlParams = new URLSearchParams(window.location.search);
                filter = urlParams.get('filter');

                const userRole = state.loggedInUser?.role || 'guest';
                const pageConfig = findPageConfig(page);
                
                let fallbackPage = 'home';
                if(userRole === 'student' || userRole === 'parent') fallbackPage = 'studentDashboard';
                if(userRole === 'teacher') fallbackPage = 'teacherDashboard';
                
                if(!pageConfig || !pageConfig.roles.includes(userRole)){
                    newState = { page: fallbackPage, view: 'list', id: null, filter: null };
                } else {
                    newState = { page, view, id, filter: filter };
                }
                
                applyState(newState);
            }

            window.onpopstate = (event) => {
                 if (event.state) {
                    applyState(event.state);
                } else {
                    handleRouteChange();
                }
            };

            const showRegisterModal = () => {
                if (localStorage.getItem('adminAccount')) {
                    showToast("An admin account already exists.", "info");
                    showLoginModal('admin');
                    return;
                }
                const formContent = `
                    <form id="register-form">
                        <div class="form-feedback" id="register-feedback"></div>
                        <div class="form-group"><label for="admin-name">Full Name</label><input type="text" id="admin-name" required></div>
                        <div class="form-group"><label for="admin-email">Email</label><input type="email" id="admin-email" required></div>
                        <div class="form-group"><label for="admin-mobile">Mobile Number</label><input type="tel" id="admin-mobile" required></div>
                        <div class="form-group"><label for="admin-photo">Your Photo</label><input type="file" id="admin-photo" accept="image/*" required></div>
                        <div class="form-group"><label for="new-password">Password (min. 4 characters)</label><input type="password" id="new-password" required minlength="4"></div>
                        <div class="form-group"><label for="confirm-password">Confirm Password</label><input type="password" id="confirm-password" required></div>
                        <button type="submit" class="action-button" style="width: 100%;">Register</button>
                         <p style="text-align: center; margin-top: 15px;">Already have an account? <a href="#" class="auth-link" onclick="event.preventDefault(); showLoginModal('admin');">Login here</a></p>
                    </form>
                `;
                showModal('Admin Registration', formContent, '500px');
                getEl('register-form').onsubmit = handleRegistration;
            }

            async function handleRegistration(e) {
                e.preventDefault();
                getEl('loading-overlay').style.display = 'flex';
                const feedbackEl = getEl('register-feedback');

                const newPass = getEl('new-password').value;
                const confirmPass = getEl('confirm-password').value;
                const adminPhotoFile = getEl('admin-photo').files[0];

                if (newPass !== confirmPass) {
                    getEl('loading-overlay').style.display = 'none';
                    feedbackEl.textContent = 'Passwords do not match.';
                    feedbackEl.className = 'form-feedback error';
                    return;
                }
                if (newPass.length < 4 || !getEl('admin-name').value || !getEl('admin-email').value || !getEl('admin-mobile').value || !adminPhotoFile) {
                    getEl('loading-overlay').style.display = 'none';
                    feedbackEl.textContent = 'Please fill all required fields.';
                    feedbackEl.className = 'form-feedback error';
                    return;
                }
                
                try {
                    const photo = await fileToBase64(adminPhotoFile);
                    const adminAccount = {
                        name: getEl('admin-name').value,
                        email: getEl('admin-email').value,
                        mobile: getEl('admin-mobile').value,
                        photo: photo,
                        password: btoa(newPass)
                    };
                    localStorage.setItem('adminAccount', JSON.stringify(adminAccount));
                    
                    getEl('loading-overlay').style.display = 'none';
                    showToast('Registration successful! Please login.', 'success');
                    setTimeout(() => showLoginModal('admin'), 1500);
                } catch(err) {
                     getEl('loading-overlay').style.display = 'none';
                     feedbackEl.textContent = 'Failed to process photo.';
                     feedbackEl.className = 'form-feedback error';
                }
            };

            const showLoginModal = (role) => {
                 let modalTitle = 'Login';
                 let usernameLabel = "ID (Email, Mobile, Admission/Employee No.)";

                 if(role === 'admin') {
                     modalTitle = 'Admin Login';
                     usernameLabel = "Email or Mobile Number";
                 } else if (role === 'teacher') {
                     modalTitle = 'Teacher Login';
                     usernameLabel = "Employee ID, Email, or Mobile";
                 } else if (role === 'student_parent') {
                     modalTitle = 'Student / Parent Login';
                      usernameLabel = "Admission No, Email, or Mobile";
                 }

                const formContent = `
                    <form id="login-form">
                        <div class="form-feedback" id="login-feedback"></div>
                        <div class="form-group">
                            <label for="username">${usernameLabel}</label>
                            <input type="text" id="username" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" required>
                        </div>
                        <button type="submit" class="action-button" style="width: 100%;">Login</button>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <a href="#" class="auth-link" onclick="event.preventDefault(); showForgotPasswordModal();">Forgot Password?</a>
                            ${role === 'admin' ? `<a href="#" class="auth-link" onclick="event.preventDefault(); showRegisterModal();">Register Admin</a>` : ''}
                        </div>
                    </form>
                `;
                showModal(modalTitle, formContent, '500px');
                getEl('login-form').onsubmit = (e) => handleLogin(e, role);
            };

            const handleLogin = (e, role) => {
                e.preventDefault();
                const feedbackEl = getEl('login-feedback');
                const enteredUsername = getEl('username').value.trim();
                const enteredPassword = getEl('password').value;
                const selectedRole = role;

                if (selectedRole === 'admin') {
                    const adminAccount = JSON.parse(localStorage.getItem('adminAccount'));
                    if(adminAccount && (enteredUsername === adminAccount.email || enteredUsername === adminAccount.mobile) && btoa(enteredPassword) === adminAccount.password) {
                        loginSuccess({role: 'admin', ...adminAccount});
                        return;
                    }
                }

                if (selectedRole === 'teacher') {
                    const teacher = (state.data.teachers || []).find(t => 
                        (t.email && t.email === enteredUsername) || 
                        (t.contact && t.contact === enteredUsername) ||
                        (t.employeeId && t.employeeId === enteredUsername)
                    );
                     if(teacher && teacher.password && btoa(enteredPassword) === teacher.password){
                        loginSuccess({role: 'teacher', ...teacher});
                        return;
                    }
                }
                
                if (selectedRole === 'student_parent') {
                    const student = (state.data.students || []).find(s => 
                        (s.email && s.email === enteredUsername) || 
                        (s.contact && s.contact === enteredUsername) ||
                        (s.admissionNumber && s.admissionNumber === enteredUsername)
                    );
                    if(student && student.password && btoa(enteredPassword) === student.password){
                        loginSuccess({role: 'student', ...student});
                        return;
                    }

                    const parentStudent = (state.data.students || []).find(s => 
                        (s.guardianContact && s.guardianContact === enteredUsername)
                    );
                    if(parentStudent && parentStudent.password && btoa(enteredPassword) === parentStudent.password){
                        loginSuccess({
                            role: 'parent', 
                            name: `Parent of ${parentStudent.name}`, 
                            photo: parentStudent.photo,
                            studentId: parentStudent.id
                        });
                        return;
                    }
                }

                feedbackEl.textContent = 'Incorrect username or password.';
                feedbackEl.className = 'form-feedback error';
            };

            function showForgotPasswordModal() {
                const formContent = `
                    <form id="forgot-password-form">
                        <p>Please enter your username (Email, Mobile, or Admission No.) to start the recovery process.</p>
                        <div class="form-feedback" id="forgot-password-feedback"></div>
                        <div class="form-group">
                            <label for="recovery-username">Username</label>
                            <input type="text" id="recovery-username" required>
                        </div>
                        <button type="submit" class="action-button" style="width: 100%;">Find Account</button>
                    </form>
                `;
                showModal('Forgot Password', formContent);
                getEl('forgot-password-form').onsubmit = handleFindAccount;
            }

            function handleFindAccount(e) {
                e.preventDefault();
                const feedbackEl = getEl('forgot-password-feedback');
                const username = getEl('recovery-username').value.trim();

                const adminAccount = JSON.parse(localStorage.getItem('adminAccount'));
                if (adminAccount && (username === adminAccount.email || username === adminAccount.mobile)) {
                    showAdminPasswordResetVerification(adminAccount);
                    return;
                }

                const teacher = (state.data.teachers || []).find(t => 
                    (t.email && t.email === username) || 
                    (t.contact && t.contact === username) ||
                    (t.employeeId && t.employeeId === username)
                );
                 if (teacher) {
                    showTeacherPasswordResetVerification(teacher);
                    return;
                }

                const student = (state.data.students || []).find(s => 
                    (s.email && s.email === username) || 
                    (s.contact && s.contact === username) ||
                    (s.admissionNumber && s.admissionNumber === username) ||
                    (s.guardianContact && s.guardianContact === username)
                );

                if (student) {
                    showStudentPasswordResetVerification(student);
                    return;
                }

                feedbackEl.textContent = 'No account found with that username.';
                feedbackEl.className = 'form-feedback error';
            }

            function showAdminPasswordResetVerification(adminAccount) {
                const formContent = `
                    <form id="admin-verify-form">
                        <p>For security, please verify your identity.</p>
                        <div class="form-feedback" id="admin-verify-feedback"></div>
                        <div class="form-group">
                            <label for="admin-recovery-email">Your Registered Email</label>
                            <input type="email" id="admin-recovery-email" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-recovery-mobile">Your Registered Mobile</label>
                            <input type="tel" id="admin-recovery-mobile" required>
                        </div>
                        <button type="submit" class="action-button" style="width: 100%;">Verify & Reset</button>
                    </form>
                `;
                showModal('Verify Admin Account', formContent);
                getEl('admin-verify-form').onsubmit = (e) => {
                    e.preventDefault();
                    const email = getEl('admin-recovery-email').value;
                    const mobile = getEl('admin-recovery-mobile').value;
                    if (email === adminAccount.email && mobile === adminAccount.mobile) {
                        showNewPasswordForm('admin', adminAccount);
                    } else {
                        getEl('admin-verify-feedback').textContent = 'Verification failed. Information does not match.';
                        getEl('admin-verify-feedback').className = 'form-feedback error';
                    }
                };
            }
            
            function showTeacherPasswordResetVerification(teacher) {
                const formContent = `
                     <form id="teacher-verify-form">
                        <p>For security, please verify your identity, <strong>${teacher.name}</strong>.</p>
                        <div class="form-feedback" id="teacher-verify-feedback"></div>
                         <div class="form-group">
                            <label for="teacher-recovery-dob">Date of Birth</label>
                            <input type="text" id="teacher-recovery-dob" placeholder="YYYY-MM-DD" required>
                        </div>
                        <button type="submit" class="action-button" style="width: 100%;">Verify & Reset</button>
                    </form>
                `;
                showModal('Verify Teacher Account', formContent);
                getEl('teacher-verify-form').onsubmit = (e) => {
                    e.preventDefault();
                    const dob = getEl('teacher-recovery-dob').value;
                    if (dob === teacher.dob) {
                        showNewPasswordForm('teacher', teacher);
                    } else {
                        getEl('teacher-verify-feedback').textContent = "Verification failed. Information does not match.";
                        getEl('teacher-verify-feedback').className = 'form-feedback error';
                    }
                };
            }

            function showStudentPasswordResetVerification(student) {
                const formContent = `
                     <form id="student-verify-form">
                        <p>For security, please verify your identity, <strong>${student.name}</strong>.</p>
                        <div class="form-feedback" id="student-verify-feedback"></div>
                        <div class="form-group">
                            <label for="student-recovery-father">Father's Name</label>
                            <input type="text" id="student-recovery-father" required>
                        </div>
                         <div class="form-group">
                            <label for="student-recovery-dob">Date of Birth</label>
                            <input type="text" id="student-recovery-dob" placeholder="YYYY-MM-DD" required>
                        </div>
                        <button type="submit" class="action-button" style="width: 100%;">Verify & Reset</button>
                    </form>
                `;
                showModal('Verify Student Account', formContent);
                getEl('student-verify-form').onsubmit = (e) => {
                    e.preventDefault();
                    const fatherName = getEl('student-recovery-father').value.trim();
                    const dob = getEl('student-recovery-dob').value;
                    if (fatherName.toLowerCase() === student.fatherName.toLowerCase() && dob === student.dob) {
                        showNewPasswordForm('student', student);
                    } else {
                        getEl('student-verify-feedback').textContent = "Verification failed. Information does not match.";
                        getEl('student-verify-feedback').className = 'form-feedback error';
                    }
                };
            }
            
            function showNewPasswordForm(userType, userData) {
                const formContent = `
                    <form id="new-password-form">
                        <p>Create a new password for ${userData.name}.</p>
                        <div class="form-feedback" id="new-password-feedback"></div>
                        <div class="form-group"><label for="reset-new-password">New Password (min. 4 characters)</label><input type="password" id="reset-new-password" required minlength="4"></div>
                        <div class="form-group"><label for="reset-confirm-password">Confirm New Password</label><input type="password" id="reset-confirm-password" required></div>
                        <button type="submit" class="action-button" style="width: 100%;">Set New Password</button>
                    </form>
                `;
                showModal('Set New Password', formContent);
                getEl('new-password-form').onsubmit = (e) => {
                    e.preventDefault();
                    const newPass = getEl('reset-new-password').value;
                    const confirmPass = getEl('reset-confirm-password').value;
                    const feedbackEl = getEl('new-password-feedback');

                    if (newPass !== confirmPass) {
                        feedbackEl.textContent = 'Passwords do not match.';
                        feedbackEl.className = 'form-feedback error';
                        return;
                    }
                    if (newPass.length < 4) {
                        feedbackEl.textContent = 'Password must be at least 4 characters long.';
                        feedbackEl.className = 'form-feedback error';
                        return;
                    }

                    userData.password = btoa(newPass);

                    if (userType === 'admin') {
                        localStorage.setItem('adminAccount', JSON.stringify(userData));
                    } else if (userType === 'student') {
                        updateOrAddItem('students', userData);
                    } else if (userType === 'teacher') {
                        updateOrAddItem('teachers', userData);
                    }

                    showToast('Password has been reset successfully!', 'success');
                    setTimeout(() => showLoginModal(userType === 'student' ? 'student_parent' : userType), 1500);
                };
            }
            
            const loginSuccess = (userData) => {
                state.loggedInUser = userData;
                localStorage.setItem('loggedInUser', JSON.stringify(userData));
                closeModal();
                getEl('loading-overlay').style.display = 'none';
                let landingPage = 'home';
                if(userData.role === 'student' || userData.role === 'parent') landingPage = 'studentDashboard';
                if(userData.role === 'teacher') landingPage = 'teacherDashboard';
                navigate(landingPage);
                showToast(`Welcome, ${userData.name}!`, "success");
            };

            const logout = () => {
                if(html5QrCode && html5QrCode.isScanning){
                     html5QrCode.stop().catch(err => console.error("QR scanner stop error", err));
                }
                state.loggedInUser = null;
                localStorage.removeItem('loggedInUser');
                navigate('home');
                showToast("You have been logged out.", "info");
            };

            const renderSidebar = () => {
                let headerHtml = '';
                let navHtml = '';
                const userRole = state.loggedInUser?.role || 'guest';

                if (state.loggedInUser) {
                    const userProfile = state.loggedInUser;
                    headerHtml = `
                        <div class="sidebar-header">
                            <img src="${userProfile.photo || `https://i.pravatar.cc/80?u=${userProfile.id}`}" alt="User Photo" class="admin-photo">
                            <h2>${userProfile.name || 'User Panel'}</h2>
                            <span style="font-size: 0.9em; color: var(--text-muted); text-transform: capitalize;">(${userProfile.role})</span>
                        </div>`;
                } else {
                    headerHtml = `
                         <div class="sidebar-header">
                            <img src="https://smsvaranasi.com/img/logo.png" alt="SMS Varanasi Logo" class="sidebar-logo">
                            <h2 style="margin-top:10px;">Welcome</h2>
                            <div style="width:100%; margin: 15px 0; display:flex; flex-direction: column; gap: 10px;">
                                <button class="action-button" onclick="showInquiryForm()" style="width:100%;">
                                    <i class="fas fa-question-circle"></i> Enquiry
                                </button>
                                <button class="action-button secondary" onclick="navigate('feePaymentPortal')" style="width:100%;">
                                    <i class="fas fa-rupee-sign"></i> Fee Payment
                                </button>
                                <button class="action-button secondary" onclick="showUnifiedScanner()" style="width:100%;">
                                    <i class="fas fa-qrcode"></i> Scan for Attendance
                                </button>
                            </div>
                            <p style="color: var(--text-muted);">Please login to continue:</p>
                            <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px; width:100%;">
                                <button class="action-button secondary" onclick="showLoginModal('admin')"><i class="fas fa-user-shield"></i> Admin Login</button>
                                <button class="action-button secondary" onclick="showLoginModal('teacher')"><i class="fas fa-chalkboard-teacher"></i> Teacher Login</button>
                                <button class="action-button secondary" onclick="showLoginModal('student_parent')"><i class="fas fa-user-graduate"></i> Student/Parent Login</button>
                            </div>
                        </div>`;
                }

                for (const [key, page] of Object.entries(config.pages)) {
                     if (!page.roles.includes(userRole)) continue;

                    if (page.subPages) {
                        const subPageKeys = Object.keys(page.subPages);
                        const hasVisibleSubpages = subPageKeys.some(subKey => page.subPages[subKey].roles.includes(userRole));
                        if (!hasVisibleSubpages) continue;

                        const isOpen = subPageKeys.includes(state.currentPage);
                        const subMenuHtml = subPageKeys.map(subKey => {
                            if (!page.subPages[subKey].roles.includes(userRole)) return '';
                            return `<li><a class="nav-link ${state.currentPage === subKey ? 'active' : ''}" data-page="${subKey}">
                                <span class="nav-link-content"><i class="fas ${page.subPages[subKey].icon}"></i><span>${page.subPages[subKey].title}</span></span>
                            </a></li>`
                        }).join('');

                        navHtml += `<div class="sidebar-nav-item ${isOpen ? 'open' : ''}"><a class="submenu-toggle">
                                    <span class="nav-link-content"><i class="fas ${page.icon}"></i><span>${page.title}</span></span>
                                    <i class="fas fa-chevron-right arrow"></i></a><ul class="sidebar-submenu">${subMenuHtml}</ul></div>`;
                    } else {
                        navHtml += `<div class="sidebar-nav-item"><a class="nav-link ${state.currentPage === key ? 'active' : ''}" data-page="${key}">
                                    <span class="nav-link-content"><i class="fas ${page.icon}"></i><span>${page.title}</span></span></a></div>`;
                    }
                }
                
                const externalLinksHtml = (state.data.externalLinks || []).map(link => {
                    let actionAttr = '';
                    if (link.specialAction) {
                        actionAttr = `data-page="${link.specialAction}"`;
                    } else {
                        actionAttr = `href="${link.url}" target="_blank"`;
                    }
                    return `<div class="sidebar-nav-item"><a class="nav-link" ${actionAttr}>
                                <span class="nav-link-content"><i class="fas fa-external-link-alt"></i><span>${link.title}</span></span></a></div>`;
                }).join('');


                const footerHtml = `
                    <div class="sidebar-footer">
                        ${state.loggedInUser ? '<button id="logout-btn" class="logout-button"><i class="fas fa-sign-out-alt"></i> Logout</button>' : ''}
                        <div class="social-media-links">
                            <a href="https://wa.me/917052055555" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                            <a href="https://www.instagram.com/smsvaranasi/" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
                            <a href="https://www.facebook.com/smsvns/" target="_blank" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                            <a href="https://www.youtube.com/user/smsvaranasi" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
                        </div>
                    </div>`;

                getEl('sidebar').innerHTML = headerHtml + `<nav class="sidebar-nav">${navHtml}${externalLinksHtml ? `<hr style="border-color: var(--border-color); margin: 15px 20px;"><div style="padding: 0 25px; color: var(--text-muted); font-weight: 500; margin-bottom: 10px;">Important Links</div>` + externalLinksHtml : ''}</nav>` + footerHtml;

                getEl('sidebar').querySelectorAll('.nav-link').forEach(link => { 
                    if(link.hasAttribute('data-page')) {
                        link.onclick = (e) => {
                            e.preventDefault();
                            if(link.dataset.page === 'admission') {
                                showAdmissionForm();
                            } else {
                                navigate(link.dataset.page);
                            }
                        };
                    }
                });

                getEl('sidebar').querySelectorAll('.submenu-toggle').forEach(link => { link.onclick = () => link.parentElement.classList.toggle('open'); });
                if (state.loggedInUser) {
                    getEl('sidebar').querySelector('#logout-btn').onclick = logout;
                }
            };
            
            const renderHeader = (title, actionsHtml = '') => {
                const schoolName = (state.data.siteContent.schoolName || 'SMS Varanasi').toUpperCase();
                const themeCyclerBtn = `<button id="theme-cycle-btn" class="action-button inline no-print" title="Change Theme Color" style="padding: 12px 15px;"><i class="fas fa-palette"></i></button>`;
                const themeModeBtn = `<button id="theme-mode-btn" class="action-button inline no-print" title="Toggle Dark/Light Mode" style="padding: 12px 15px;"><i class="fas fa-moon"></i></button>`;
                return `<div class="header no-print"><div class="header-left"><button class="menu-toggle"><i class="fas fa-bars"></i></button>
                        <div class="header-title-container"><span class="moving-title">${schoolName} - VARANASI</span></div></div>
                        <div class="header-actions"><div id="real-time-clock"></div> ${themeCyclerBtn} ${themeModeBtn} ${actionsHtml}</div></div>`;
            };
            
            const renderMainFooter = () => {
                const schoolInfo = state.data.siteContent;
                getEl('main-footer').innerHTML = `<div class="footer-content"><div class="footer-contact">
                        <p><i class="fas fa-map-marker-alt"></i> ${schoolInfo.schoolAddress}</p>
                        <p><i class="fas fa-phone-alt"></i> <a href="tel:${schoolInfo.schoolContact}" style="color: var(--text-color); text-decoration: none;">${schoolInfo.schoolContact}</a></p>
                         <p><i class="fas fa-envelope"></i> <a href="mailto:${schoolInfo.schoolEmail}" style="color: var(--text-color); text-decoration: none;">${schoolInfo.schoolEmail}</a></p>
                        </div><div class="footer-map"><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3608.238319694765!2d82.9159958753832!3d25.26252977766867!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x398e2149b5a15037%3A0x68551e69cfad4eac!2sSchool%20of%20Management%20Sciences%20(SMS)%2C%20Varanasi!5e0!3m2!1sen!2sin!4v1722955938531!5m2!1sen!2sin" 
                        width="300" height="120" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div></div>`;
            };

            const showModal = (title, content, maxWidth = '600px') => {
                const modalHTML = `<div class="modal-overlay no-print"><div class="modal-content" style="max-width: ${maxWidth};"><div class="modal-header no-print"><h2>${title}</h2>
                        <button class="close-btn" onclick="closeModal()">×</button></div><div class="modal-body">${content}</div></div></div>`;
                getEl('modal-container').innerHTML = modalHTML;
            };

            function getFeeDefaulters() {
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const studentsWithPaymentsThisMonth = new Set();

                (state.data.transactions || []).forEach(t => {
                    const transactionDate = new Date(t.date);
                    if (transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear) {
                        studentsWithPaymentsThisMonth.add(t.studentId);
                    }
                });

                return (state.data.students || []).filter(s => !studentsWithPaymentsThisMonth.has(s.id));
            }

            function getTopStudents() {
                const { marks, examMasters, students, siteContent } = state.data;
                const gradePointMap = { 'O': 10, 'A+': 9, 'A': 8, 'B+': 7, 'B': 6, 'C': 5, 'P': 4, 'F': 0, 'Ab': 0 };

                if (siteContent && siteContent.manualTopperStudentIds && siteContent.manualTopperStudentIds.length > 0) {
                    return siteContent.manualTopperStudentIds.map(topperId => {
                        const manualTopper = findById('students', topperId);
                        if (manualTopper) {
                            return {
                                student: manualTopper,
                                sgpa: null,
                                examName: "Honorary Topper",
                                isManual: true
                            };
                        }
                        return null;
                    }).filter(t => t !== null);
                }

                if (!marks || !examMasters || !students || examMasters.length === 0) return [];

                const latestDeclaredExam = examMasters
                    .filter(em => em.declarationDate && new Date(em.declarationDate) <= new Date())
                    .sort((a, b) => new Date(b.declarationDate) - new Date(a.declarationDate))[0];

                if (!latestDeclaredExam) return [];

                const examMarks = marks[latestDeclaredExam.id];
                if (!examMarks) return [];

                let allStudentScores = [];

                for (const studentId in examMarks) {
                    const studentResult = examMarks[studentId];
                    const studentData = findById('students', studentId);

                    if (studentData) {
                        let totalGradePoints = 0;
                        let totalCredits = 0;

                        studentResult.forEach(m => {
                            const gradePoint = gradePointMap[m.grade] || 0;
                            const credits = m.credits || 0;
                            totalGradePoints += gradePoint * credits;
                            totalCredits += credits;
                        });

                        const sgpa = totalCredits > 0 ? (totalGradePoints / totalCredits).toFixed(2) : 0;
                        allStudentScores.push({ student: studentData, sgpa: sgpa, examName: latestDeclaredExam.name, isManual: false });
                    }
                }

                return allStudentScores.sort((a, b) => b.sgpa - a.sgpa).slice(0, 3);
            }
            
            function renderImageSlider() {
                const schoolInfo = state.data.siteContent;
                const coursesHtml = courseOptionsList.map(c => `<span>${c}</span>`).join(' &nbsp; • &nbsp; ');
                
                return `
                    <div class="slider-container">
                        <div class="slides">
                            ${sliderImages.map(imgUrl => `
                                <div class="slide" style="background-image: url('${imgUrl}');">
                                    <div class="slide-overlay">
                                        <h2>${schoolInfo.schoolName}</h2>
                                        <p>${schoolInfo.schoolAddress}</p>
                                        <button class="action-button" onclick="navigate('admission')">ADMISSION OPEN - 2025-26</button>
                                        <div class="scrolling-courses-container">
                                            <div class="scrolling-courses">${coursesHtml} ${coursesHtml}</div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="slider-nav">
                            <button class="prev-slide">&lt;</button>
                            <button class="next-slide">&gt;</button>
                        </div>
                        <div class="slider-dots"></div>
                    </div>`;
            }

            function initSlider() {
                const slides = document.querySelector('.slides');
                if (!slides) return;

                const slideCount = sliderImages.length;
                let currentIndex = 0;
                let slideInterval;

                const prevButton = document.querySelector('.prev-slide');
                const nextButton = document.querySelector('.next-slide');
                const dotsContainer = document.querySelector('.slider-dots');

                for (let i = 0; i < slideCount; i++) {
                    const dot = document.createElement('div');
                    dot.classList.add('dot');
                    dot.addEventListener('click', () => goToSlide(i));
                    dotsContainer.appendChild(dot);
                }
                const dots = document.querySelectorAll('.dot');

                function updateDots() {
                    dots.forEach((dot, index) => {
                        dot.classList.toggle('active', index === currentIndex);
                    });
                }

                function goToSlide(index) {
                    currentIndex = (index + slideCount) % slideCount;
                    slides.style.transform = `translateX(-${currentIndex * (100 / slideCount)}%)`;
                    updateDots();
                }

                function nextSlide() {
                    goToSlide(currentIndex + 1);
                }

                function prevSlide() {
                    goToSlide(currentIndex - 1);
                }
                
                function startSlider() {
                    slideInterval = setInterval(nextSlide, 5000); 
                }

                function stopSlider() {
                    clearInterval(slideInterval);
                }

                prevButton.addEventListener('click', () => {
                    prevSlide();
                    stopSlider();
                    startSlider();
                });
                nextButton.addEventListener('click', () => {
                    nextSlide();
                    stopSlider();
                    startSlider();
                });
                
                document.querySelector('.slider-container').addEventListener('mouseenter', stopSlider);
                document.querySelector('.slider-container').addEventListener('mouseleave', startSlider);

                goToSlide(0);
                startSlider();
            }
            
            function renderPlaceholderPage(title) {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader(title);
                mainContent.innerHTML += `
                    <div class="page active">
                        <div class="card" style="text-align: center;">
                            <h2>${title}</h2>
                            <p style="margin-top: 20px; font-size: 1.2rem; color: var(--text-muted);">This page is under construction.</p>
                        </div>
                    </div>`;
            }


            function renderHomePage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Dashboard');
                const userProfile = state.loggedInUser;
                const userRole = userProfile?.role || 'guest';
                const { students, notices, teachers, examSchedules, staff, events, siteContent, schoolPhotos, externalLinks, videos, books, inquiries, placements } = state.data;
                
                const recentNoticesHtml = (notices || []).sort((a, b) => b.id - a.id).slice(0, 3).map(n => `
                    <div class="notice-item">
                        <h4>${n.title}</h4>
                        <p>${n.content.substring(0, 80)}...</p>
                        <div class="notice-date">${new Date(n.id).toLocaleString()}</div>
                    </div>`).join('') || '<div class="notice-item"><p>No recent notices.</p></div>';
                
                const latestNewsHtml = (siteContent.latestNews || []).sort((a, b) => b.id - a.id).slice(0, 3).map(n => `
                    <div class="notice-item">
                        <h4>${n.title}</h4>
                        <p>${n.content.substring(0, 80)}...</p>
                        <div class="notice-date">${new Date(n.id).toLocaleString()}</div>
                    </div>`).join('') || '<div class="notice-item"><p>No latest news.</p></div>';

                const upcomingEventsHtml = (events || [])
                    .filter(ev => new Date(ev.date) >= new Date())
                    .sort((a, b) => new Date(a.date) - new Date(b.date))
                    .slice(0, 3)
                    .map(ev => `
                    <div class="notice-item">
                        <h4>${ev.title}</h4>
                        <p>${ev.description.substring(0, 80)}...</p>
                        <div class="notice-date">On: ${new Date(ev.date).toLocaleDateString()}</div>
                    </div>`).join('') || '<div class="notice-item"><p>No upcoming events.</p></div>';
                
                const recentInquiriesHtml = (inquiries || []).sort((a, b) => b.id - a.id).slice(0, 3).map(i => `
                    <div class="notice-item">
                        <h4>${i.name} for ${i.className}</h4>
                        <p>Contact: ${i.contact}</p>
                        <div class="notice-date">Status: ${i.status}</div>
                    </div>`).join('') || '<div class="notice-item"><p>No new inquiries.</p></div>';

                const newBooksHtml = (books || []).sort((a, b) => b.id - a.id).slice(0, 3).map(b => `
                    <div class="notice-item">
                        <h4>${b.title}</h4>
                        <p>By ${b.author}</p>
                    </div>`).join('') || '<div class="notice-item"><p>No new books added recently.</p></div>';

                const upcomingExamsHtml = (examSchedules || [])
                    .filter(ex => new Date(ex.date) >= new Date())
                    .sort((a, b) => new Date(a.date) - new Date(b.date))
                    .slice(0, 5)
                    .map(ex => {
                        const examMaster = findById('examMasters', ex.examMasterId);
                        return `<li class="detail-list-item">
                            <span><i class="fas fa-file-signature" style="color:var(--primary-light); margin-right:10px;"></i><strong>${ex.subject}</strong> (${ex.className})<br><small style="color:var(--text-muted)">${examMaster ? examMaster.name : 'Unknown Exam'}</small></span>
                            <span>${new Date(ex.date).toLocaleDateString()}</span>
                        </li>`;
                    }).join('') || '<li>No upcoming exams scheduled.</li>';
                
                const studentAttendance = getTodaysAttendanceSummary('students');
                
                const studentAttendancePercentage = (students || []).length > 0 ? ((studentAttendance.present / (students || []).length) * 100).toFixed(0) : 0;

                const studentCountsByCourse = (students || []).reduce((acc, student) => {
                    const courseName = student.className;
                    if(courseName) {
                       acc[courseName] = (acc[courseName] || 0) + 1;
                    }
                    return acc;
                }, {});

                const courseStrengthHtml = courseOptionsList.map(courseName => {
                    const count = studentCountsByCourse[courseName] || 0;
                    return `<li class="detail-list-item clickable" onclick="navigate('students', 'list', null, '${courseName}')">
                        <span><i class="fas fa-users" style="color:var(--primary-light); margin-right:10px;"></i>${courseName}</strong></span>
                        <span style="font-weight: bold; font-size: 1.2em;">${count}</span>
                    </li>`;
                }).join('') || '<li>No students enrolled in any course yet.</li>';

                const recentlyAddedStudents = (students || []).sort((a, b) => b.id - a.id).slice(0, 10);
                let recentStudentsHtml = recentlyAddedStudents.length > 0 ? recentlyAddedStudents.map(s => `
                    <div class="lookup-result-item" onclick="navigate('students', 'profile', '${s.id}')">
                        <img src="${s.photo || `https://i.pravatar.cc/50?u=${s.id}`}" alt="Photo">
                        <div style="flex-grow: 1;">
                            <strong>${s.name}</strong>
                            <p style="font-size: 0.9em; color: var(--text-muted);">Course: ${s.className || 'N/A'}</p>
                        </div>
                        <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                    </div>
                `).join('') : '<p style="text-align:center; color: var(--text-muted); padding: 20px 0;">No new admissions yet.</p>';

                if(recentlyAddedStudents.length > 0) {
                    recentStudentsHtml += recentStudentsHtml;
                }
                
                const ourFacultyHtml = (teachers || []).length > 0 ? teachers.map(teacher => `
                    <div class="card" style="text-align: center; cursor: pointer;" onclick="navigate('teachers', 'profile', '${teacher.id}')">
                        <img src="${teacher.photo || `https://i.pravatar.cc/100?u=${teacher.id}`}" alt="Teacher Photo" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-light);">
                        <h4 style="margin-top: 15px; font-size: 1.1rem;">${teacher.name}</h4>
                        <p style="color: var(--text-muted);">${teacher.role}</p>
                    </div>
                `).join('') : '<p style="text-align:center; color: var(--text-muted);">No teachers have been added yet.</p>';
                 
                const topStudents = getTopStudents();
                let topperCardsHtml = '';
                const topperPhoto = siteContent.topperPhoto || '';

                if (topStudents.length > 0) {
                    topperCardsHtml = topStudents.map(topStudentInfo => {
                        const displayPhoto = topperPhoto || topStudentInfo.student.photo || `https://i.pravatar.cc/120?u=${topStudentInfo.student.id}`;
                        
                        return `
                        <div class="card" style="border-left: 5px solid var(--warning-color); text-align: center;">
                            <h3 style="color: var(--warning-color); font-size: 1.5rem; margin-bottom: 15px;"><i class="fas fa-crown"></i> College Topper</h3>
                            <img src="${displayPhoto}" alt="Topper Photo" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--warning-color);">
                            <h4 style="margin-top: 15px; font-size: 1.4rem;">${topStudentInfo.student.name}</h4>
                            <p style="color: var(--text-muted); font-size: 1.1rem;">${topStudentInfo.student.className}</p>
                            ${topStudentInfo.isManual ? 
                                `<p style="color: var(--text-muted); font-size: 0.9rem;">(${topStudentInfo.examName})</p>` :
                                `<p style="font-size: 1.5rem; font-weight: bold; color: var(--success-color); margin-top: 10px;">SGPA: ${topStudentInfo.sgpa}</p>
                                 <p style="color: var(--text-muted); font-size: 0.9rem;">(${topStudentInfo.examName})</p>`
                            }
                        </div>`;
                    }).join('');
                } else {
                    topperCardsHtml = `
                     <div class="card" style="border-left: 5px solid var(--info-color); text-align: center;">
                         <h3 style="color: var(--info-color); font-size: 1.5rem; margin-bottom: 15px;"><i class="fas fa-crown"></i> College Topper</h3>
                         <p style="color: var(--text-muted); padding: 20px 0;">Topper information is not available.</p>
                     </div>`;
                }
                
                const homeVideoGalleryHtml = (videos && videos.length > 0) ? `
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-video"></i> Video Gallery</h3>
                            <button class="action-button inline" onclick="navigate('media', 'list', 'videos')">View All</button>
                        </div>
                         <div class="videos-grid">
                            ${videos.slice(0, 3).map(item => `
                                <div class="video-item">
                                    <iframe src="${getYoutubeEmbedUrl(item.url)}" title="${item.title}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                                    <div class="video-item-footer">
                                        <span>${item.title}</span>
                                    </div>
                                </div>`).join('')}
                        </div>
                    </div>` : '';


                const schoolPhotosHtml = (schoolPhotos && schoolPhotos.length > 0) ? `
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-school"></i> Photo Gallery</h3>
                            ${ userRole === 'admin' ? `<button class="action-button inline" onclick="navigate('settings', 'list', 'schoolPhotos')">Manage</button>` : `<button class="action-button inline" onclick="navigate('media', 'list', 'gallery')">View All</button>`}
                        </div>
                        <div class="school-photos-container">
                            ${schoolPhotos.map(photo => `
                                <div class="school-photo-item">
                                    <img src="${photo.image}" alt="${photo.title}">
                                    <div class="photo-title">${photo.title}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : '';
                
                 const placementsHtml = (placements && placements.length > 0) ? `
                     <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-handshake"></i> Our Recruiters</h3>
                             ${ userRole === 'admin' ? `<button class="action-button inline" onclick="navigate('settings', 'list', 'placements')">Manage</button>` : ''}
                        </div>
                        <div class="scrolling-wrapper">
                            <div class="scroller">
                                ${placements.map(p => `<a href="${p.url}" target="_blank" class="placement-logo-item" title="${p.name}"><img src="${p.logo}" alt="${p.name}"></a>`).join('')}
                                ${placements.map(p => `<a href="${p.url}" target="_blank" class="placement-logo-item" title="${p.name}"><img src="${p.logo}" alt="${p.name}"></a>`).join('')}
                            </div>
                        </div>
                     </div>
                ` : '';

                const importantLinksHtml = (externalLinks && externalLinks.length > 0) ? `
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-link"></i> Important Links</h3>
                        </div>
                        <div class="important-links-grid">
                            ${externalLinks.map(link => {
                                let actionAttr = `href="${link.url}" target="_blank"`;
                                if (link.specialAction) {
                                    actionAttr = `href="#" onclick="event.preventDefault(); navigate('${link.specialAction}')"`;
                                }
                                return `<a ${actionAttr} class="important-link-item">${link.title}</a>`;
                            }).join('')}
                        </div>
                    </div>
                ` : '';
                
                 const directorDeskHtml = siteContent.principalDesk ? `
                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-user-tie"></i> From the Director's Desk</h3></div>
                        <p style="white-space: pre-wrap;">${siteContent.principalDesk}</p>
                    </div>` : '';
                
                const aboutSchoolHtml = siteContent.aboutSchool ? `
                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-school"></i> About Our College</h3></div>
                        <p style="white-space: pre-wrap;">${siteContent.aboutSchool}</p>
                    </div>` : '';

                const welcomeBoxHtml = userProfile ? `
                    <div class="card" style="margin-bottom: 25px; background: var(--primary-gradient); color: white; text-align: center;">
                        <h2 style="font-size: 1.8rem; margin-bottom: 5px;">Welcome back, ${userProfile.name}!</h2>
                        <p>Here's a quick overview of ${siteContent.schoolName}.</p>
                    </div>
                ` : '';

                mainContent.innerHTML += `<div class="page active">
                    ${welcomeBoxHtml}
                    
                    ${renderImageSlider()}

                    <div class="home-action-grid">
                        <a href="#" onclick="event.preventDefault(); navigate('admission');" class="home-action-card home-action-card-admission">
                            <i class="fas fa-rocket"></i>
                            <span>ADMISSION OPEN<br>2025-26</span>
                        </a>
                        <a href="#" onclick="event.preventDefault(); showInquiryForm();" class="home-action-card home-action-card-enquiry">
                            <i class="fas fa-question-circle"></i>
                            <span>ENQUIRY</span>
                        </a>
                    </div>
                    
                    ${ userRole === 'admin' ? `
                    <div class="card">
                        <div class="card-header" style="border:none; padding-bottom: 0;"><h3><i class="fas fa-bolt"></i> Quick Actions</h3></div>
                        <div class="quick-actions-grid" style="margin-top: 15px;">
                            <button class="quick-action-btn" onclick="navigate('admission')"><i class="fas fa-user-plus"></i> Add Student</button>
                            <button class="quick-action-btn" onclick="navigate('adminStudentAttendance')"><i class="fas fa-calendar-check"></i> Student Attendance</button>
                            <button class="quick-action-btn" onclick="showUnifiedScanner()"><i class="fas fa-qrcode"></i> Scan QR</button>
                            <button class="quick-action-btn" onclick="navigate('financials', 'list', 'expenses')"><i class="fas fa-file-invoice-dollar"></i> Add Expense</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-search"></i> Quick Student Lookup</h3></div>
                        <div class="search-box-container">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="student-lookup-input" oninput="lookupStudent(this.value)" placeholder="Search by Name, Roll No, Admission No..." class="search-input">
                        </div>
                        <div id="student-lookup-results"></div>
                    </div>
                    ` : ''}

                    ${placementsHtml}

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px;">
                        ${topperCardsHtml}
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="stat-card"><i class="fas fa-user-graduate"></i><h3>${(students || []).length}</h3><p>Total Students</p></div>
                        <div class="stat-card"><i class="fas fa-chalkboard-teacher"></i><h3>${(teachers || []).length}</h3><p>Total Teachers</p></div>
                        <div class="stat-card"><i class="fas fa-user-friends"></i><h3>${(staff || []).length}</h3><p>Total Staff</p></div>
                        <div class="stat-card"><i class="fas fa-dollar-sign"></i><h3>₹${getMonthlyFinancialData().currentMonthIncome}</h3><p>This Month's Income</p></div>
                    </div>
                    
                     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px;">
                         <div class="card home-attendance-summary">
                             <div class="card-header" style="border:none; padding-bottom: 0;"><h3><i class="fas fa-user-check"></i> Today's Student Attendance</h3></div>
                             <div class="attendance-stats">
                                <div class="stat-item present"><span class="count">${studentAttendance.present}</span><span>Present</span></div>
                                <div class="stat-item absent"><span class="count">${studentAttendance.absent}</span><span>Absent</span></div>
                            </div>
                            <div class="attendance-bar-container"><div class="attendance-bar" style="width: ${studentAttendancePercentage}%;"></div></div>
                            <p class="percentage">${studentAttendancePercentage}% of total students are present</p>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-bullhorn"></i> Notice Board</h3>
                                <button class="action-button inline" onclick="navigate('noticeBoard')">View All</button>
                            </div>
                            <div class="notice-board">${recentNoticesHtml}</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-newspaper"></i> Latest News</h3>
                                ${ userRole === 'admin' ? `<button class="action-button inline" onclick="navigate('settings', 'list', 'content')">Manage</button>` : ''}
                            </div>
                            <div class="notice-board">${latestNewsHtml}</div>
                        </div>
                     </div>

                     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-top: 30px;">
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-calendar-star"></i> Upcoming Events</h3>
                                <button class="action-button inline" onclick="navigate('events')">View All</button>
                            </div>
                            <div class="notice-board">${upcomingEventsHtml}</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-book"></i> New Library Books</h3>
                                <button class="action-button inline" onclick="navigate('library', 'list', 'bookList')">View All</button>
                            </div>
                            <div class="notice-board">${newBooksHtml}</div>
                        </div>
                        ${ userRole === 'admin' ? `
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-question-circle"></i> Recent Inquiries</h3>
                                <button class="action-button inline" onclick="navigate('inquiries')">View All</button>
                            </div>
                            <div class="notice-board">${recentInquiriesHtml}</div>
                        </div>
                        ` : '' }
                     </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-top: 30px;">
                         <div style="display: flex; flex-direction: column; gap: 30px;">
                            <div class="card">
                                <div class="card-header"><h3><i class="fas fa-chart-pie"></i> Class Strength</h3></div>
                                <ul class="detail-list">${courseStrengthHtml}</ul>
                            </div>
                            <div class="card"><div class="card-header"><h3><i class="fas fa-calendar-day"></i> Upcoming Exams</h3></div><ul class="detail-list">${upcomingExamsHtml}</ul></div>
                            ${ userRole === 'admin' ? `
                            <div class="card">
                                <div class="card-header"><h3><i class="fas fa-user-clock"></i> Recently Added Students</h3></div>
                                <div class="recent-students-scroller">
                                    <div class="scroller-inner">${recentStudentsHtml}</div>
                                </div>
                            </div>
                            ` : '' }
                        </div>
                        <div class="card"><div class="card-header"><h3><i class="fas fa-chart-line"></i> Monthly Financials</h3></div><canvas id="financials-chart"></canvas></div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-top: 30px;">
                        ${directorDeskHtml}
                        ${aboutSchoolHtml}
                    </div>

                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-chalkboard-teacher"></i> Our Faculty</h3></div>
                        <div class="dashboard-grid" style="margin-top: 20px;">
                            ${ourFacultyHtml}
                        </div>
                    </div>
                    
                    ${homeVideoGalleryHtml}
                    ${schoolPhotosHtml}
                    ${importantLinksHtml}
                </div>`;
                
                initSlider();

                if (getEl('financials-chart')) {
                    const { income, expense, labels } = getMonthlyFinancialData();
                    new Chart(getEl('financials-chart').getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [
                                { label: 'Income', data: income, backgroundColor: 'var(--success-color)' },
                                { label: 'Expense', data: expense, backgroundColor: 'var(--error-color)' }
                            ]
                        },
                        options: { scales: { y: { beginAtZero: true, ticks: { color: 'var(--text-color)' } }, x: { ticks: { color: 'var(--text-color)' } } } }
                    });
                }
            }
            
            function lookupStudent(query) {
                const resultsContainer = getEl('student-lookup-results');
                if (!resultsContainer) return;
                query = query.trim().toLowerCase();
                
                if (!query) {
                    resultsContainer.innerHTML = '';
                    return;
                }
                
                const results = (state.data.students || []).filter(s => 
                    (s.name && s.name.toLowerCase().includes(query)) ||
                    (s.rollNumber && s.rollNumber.toLowerCase().includes(query)) ||
                    (s.admissionNumber && s.admissionNumber.toLowerCase().includes(query)) ||
                    (s.contact && s.contact.includes(query))
                ).slice(0, 5);
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No students found.</p>';
                    return;
                }
                
                resultsContainer.innerHTML = results.map(s => `
                    <div class="lookup-result-item">
                        <img src="${s.photo || `https://i.pravatar.cc/50?u=${s.id}`}" alt="Photo">
                        <div style="flex-grow: 1;">
                            <strong>${s.name}</strong>
                            <p style="font-size: 0.9em; color: var(--text-muted);">Course: ${s.className || 'N/A'} | Roll: ${s.rollNumber || 'N/A'}</p>
                        </div>
                        <button class="action-button inline" onclick="navigate('students', 'profile', '${s.id}')">View Profile</button>
                    </div>
                `).join('');
            }

            function renderStudentDashboardPage() {
                const mainContent = getEl('main-content');
                const user = state.loggedInUser;
                const schoolInfo = state.data.siteContent;

                const student = user.role === 'parent' ? findById('students', user.studentId) : user;
                if (!student) {
                    mainContent.innerHTML = renderHeader(`Error`);
                    mainContent.innerHTML += `<div class="page active"><p class="form-feedback error">Could not find linked student data.</p></div>`;
                    return;
                }
                
                mainContent.innerHTML = renderHeader(`Welcome, ${user.name}`);
                
                const { present, absent } = calculateAttendance('students', student.id);
                const totalDays = present + absent;
                const attendancePercentage = totalDays > 0 ? ((present / totalDays) * 100).toFixed(1) : '0';

                const upcomingExamsHtml = (state.data.examSchedules || [])
                    .filter(ex => new Date(ex.date) >= new Date() && ex.className === student.className)
                    .sort((a, b) => new Date(a.date) - new Date(b.date))
                    .slice(0, 5)
                    .map(ex => {
                        const examMaster = findById('examMasters', ex.examMasterId);
                        return `
                        <li class="detail-list-item">
                            <span><i class="fas fa-file-signature" style="color:var(--primary-light); margin-right:10px;"></i><strong>${ex.subject}</strong><br><small style="color:var(--text-muted)">${examMaster ? examMaster.name : 'Unknown Exam'}</small></span>
                            <span>${new Date(ex.date).toLocaleDateString()} at ${ex.startTime}</span>
                        </li>
                        `;
                    }).join('') || '<li>No upcoming exams scheduled for your course.</li>';
                
                const schoolPhotosHtml = (state.data.schoolPhotos && state.data.schoolPhotos.length > 0) ? `
                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-school"></i> Photo Gallery</h3></div>
                        <div class="school-photos-container">
                            ${state.data.schoolPhotos.slice(0, 3).map(photo => `
                                <div class="school-photo-item">
                                    <img src="${photo.image}" alt="${photo.title}">
                                    <div class="photo-title">${photo.title}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : '';

                mainContent.innerHTML += `<div class="page active">
                     <div class="card" style="text-align: center;">
                        <h2 style="font-size: 1.8rem; color: var(--primary-light); text-transform: uppercase;">${schoolInfo.schoolName || 'SMS VARANASI'}</h2>
                    </div>
                    <div class="dashboard-grid">
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('studentProfile')">
                            <i class="fas fa-user-circle"></i><h3>Profile</h3><p>View Profile</p>
                        </div>
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('studentAttendance')">
                            <i class="fas fa-calendar-check"></i><h3>Attendance</h3><p>View Attendance</p>
                        </div>
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('studentHomework')">
                            <i class="fas fa-book-open"></i><h3>Homework</h3><p>View Homework</p>
                        </div>
                         <div class="stat-card" style="cursor: pointer;" onclick="navigate('admitCardPortal')">
                            <i class="fas fa-id-card"></i><h3>Admit Card</h3><p>Get Admit Card</p>
                        </div>
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('resultPortal')">
                            <i class="fas fa-award"></i><h3>Result</h3><p>Check Result</p>
                        </div>
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('studentFeePayment')">
                            <i class="fas fa-rupee-sign"></i><h3>Fee Payment</h3><p>Pay Your Fees</p>
                        </div>
                    </div>
                     <div class="card">
                        <div class="card-header"><h3>Attendance Summary</h3></div>
                        <div class="attendance-stats">
                            <div class="stat-item present"><span class="count">${present}</span><span>Present</span></div>
                            <div class="stat-item absent"><span class="count">${absent}</span><span>Absent</span></div>
                        </div>
                        <div class="attendance-bar-container"><div class="attendance-bar" style="width: ${attendancePercentage}%;"></div></div>
                        <p class="percentage">${attendancePercentage}% Overall Attendance</p>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>Upcoming Exams</h3></div>
                        <ul class="detail-list">${upcomingExamsHtml}</ul>
                    </div>
                     ${schoolPhotosHtml}
                </div>`;
            }

            function renderTeacherDashboardPage() {
                const mainContent = getEl('main-content');
                const user = state.loggedInUser;
                const schoolInfo = state.data.siteContent;

                mainContent.innerHTML = renderHeader(`Welcome, ${user.name}`);
                
                 const schoolPhotosHtml = (state.data.schoolPhotos && state.data.schoolPhotos.length > 0) ? `
                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-school"></i> Photo Gallery</h3></div>
                        <div class="school-photos-container">
                            ${state.data.schoolPhotos.slice(0, 3).map(photo => `
                                <div class="school-photo-item">
                                    <img src="${photo.image}" alt="${photo.title}">
                                    <div class="photo-title">${photo.title}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : '';

                mainContent.innerHTML += `<div class="page active">
                    <div class="card" style="background: var(--primary-gradient); color: white;">
                        <h2 style="font-size: 1.8rem;">Teacher Dashboard</h2>
                        <p>Manage your courses and academic activities from here.</p>
                    </div>
                     <div class="dashboard-grid">
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('academics', 'list', 'homework')">
                            <i class="fas fa-book-open"></i><h3>Homework</h3><p>Manage Homework</p>
                        </div>
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('adminStudentAttendance')">
                           <i class="fas fa-calendar-check"></i><h3>Attendance</h3><p>Take Attendance</p>
                        </div>
                         <div class="stat-card" style="cursor: pointer;" onclick="showUnifiedScanner()">
                           <i class="fas fa-qrcode"></i><h3>Scan Student QR</h3><p>For Attendance</p>
                        </div>
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('resultPortal')">
                            <i class="fas fa-award"></i><h3>Results</h3><p>View Results</p>
                        </div>
                        <div class="stat-card" style="cursor: pointer;" onclick="navigate('noticeBoard')">
                            <i class="fas fa-bullhorn"></i><h3>Notice Board</h3><p>View Notices</p>
                        </div>
                    </div>
                    ${schoolPhotosHtml}
                </div>`;
            }

            function getTodaysAttendanceSummary(type = 'students') {
                const today = new Date().toISOString().slice(0, 10);
                let attendanceSource;
                if(type === 'students') attendanceSource = state.data.studentAttendance;
                else if (type === 'teachers') attendanceSource = state.data.teacherAttendance;
                else if (type === 'staff') attendanceSource = state.data.staffAttendance;
                else return { present: 0, absent: 0, totalMarked: 0, absentMembers: [] };

                const todaysRecords = attendanceSource[today] || {};
                const memberList = state.data[type] || [];

                let present = 0;
                let absent = 0;
                
                if (!memberList || memberList.length === 0) {
                    return { present: 0, absent: 0, totalMarked: 0, absentMembers: [] };
                }

                memberList.forEach(member => {
                    if (todaysRecords.hasOwnProperty(member.id)) {
                       if (todaysRecords[member.id] === 'present') {
                           present++;
                       } else if (todaysRecords[member.id] === 'absent') {
                           absent++;
                       }
                    }
                });
                
                const totalMarked = present + absent;
                return { present, absent, totalMarked };
            }

            function renderAdmissionPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('New Admission');
                mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="card-header">
                            <h3>Start a New Admission (2025-26)</h3>
                        </div>
                        <p>Click the button below to open the new student admission form.</p>
                        <button class="action-button" style="margin-top:20px; font-size: 1.1rem; padding: 15px 30px;" onclick="showAdmissionForm()"><i class="fas fa-user-plus"></i> Open Admission Form</button>
                    </div>
                </div>`;
            }

            function showAdmissionForm() {
                const courseOptionsHTML = courseOptionsList
                    .map(c => `<option value="${c}">${c}</option>`).join('');
                
                const formContent = `
                    <form id="admission-form">
                        <h3 style="color: var(--primary-light); margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Personal Details</h3>
                        <div class="form-grid">
                            <div class="form-group"><label for="admission-name">Full Name</label><input type="text" id="admission-name" required></div>
                            <div class="form-group"><label for="admission-father-name">Father's Name</label><input type="text" id="admission-father-name" required></div>
                             <div class="form-group"><label for="admission-mother-name">Mother's Name</label><input type="text" id="admission-mother-name" required></div>
                            <div class="form-group"><label for="admission-guardian-name">Guardian's Name</label><input type="text" id="admission-guardian-name" required></div>
                            <div class="form-group"><label for="admission-dob">Date of Birth</label><input type="text" id="admission-dob" placeholder="YYYY-MM-DD" required></div>
                            <div class="form-group"><label for="admission-gender">Gender</label><select id="admission-gender" required><option value="">Select Gender</option><option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option></select></div>
                            <div class="form-group"><label for="admission-category">Category</label><select id="admission-category" required><option value="">Select Category</option><option value="General">General</option><option value="OBC">OBC</option><option value="SC">SC</option><option value="ST">ST</option></select></div>
                        </div>
                        
                        <h3 style="color: var(--primary-light); margin-top: 30px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Contact & Login</h3>
                        <div class="form-grid">
                            <div class="form-group"><label for="admission-guardian-contact">Guardian's Contact Number (For Parent Login)</label><input type="tel" id="admission-guardian-contact" pattern="[0-9]{10}" title="Please enter a 10-digit phone number" required></div>
                            <div class="form-group"><label for="admission-contact">Student's Contact (Optional)</label><input type="tel" id="admission-contact" pattern="[0-9]{10}" title="Please enter a 10-digit phone number"></div>
                            <div class="form-group"><label for="admission-email">Email</label><input type="email" id="admission-email" ></div>
                            <div class="form-group"><label for="admission-password">Password</label><input type="password" id="admission-password" required placeholder="Create a password for student & parent"></div>
                        </div>
                        <div class="form-group"><label for="admission-address">Address</label><textarea id="admission-address" rows="3" required></textarea></div>
                        <div class="form-group"><label for="admission-pincode">Pin Code</label><input type="text" id="admission-pincode" value="221011" required></div>

                        <h3 style="color: var(--primary-light); margin-top: 30px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Academic Details</h3>
                        <div class="form-grid">
                             <div class="form-group">
                                <label for="admission-class">Select Course/Program</label>
                                <select id="admission-class" required>
                                    <option value="">Select a Course</option>
                                    ${courseOptionsHTML}
                                </select>
                            </div>
                        </div>

                        <h3 style="color: var(--primary-light); margin-top: 30px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Documents & Photo</h3>
                        <div class="form-grid">
                            <div class="form-group"><label for="admission-photo">Student's Photo</label><input type="file" id="admission-photo" accept="image/*" required></div>
                            <div class="form-group"><label for="admission-doc-aadhar">Aadhar Card (PDF/Image)</label><input type="file" id="admission-doc-aadhar" accept="image/*,application/pdf"></div>
                            <div class="form-group"><label for="admission-doc-signature">Signature</label><input type="file" id="admission-doc-signature" accept="image/*"></div>
                        </div>
                        
                        <button type="submit" class="action-button" style="width: 100%; margin-top: 20px;">Complete Admission</button>
                    </form>
                `;

                showModal('New Student Admission Form', formContent, '900px');
                getEl('admission-form').onsubmit = handleAdmissionSubmit;
            }
            
            async function handleAdmissionSubmit(e) {
                e.preventDefault();
                getEl('loading-overlay').style.display = 'flex';
                
                try {
                    const studentId = Date.now().toString();
                    const admissionNumber = `MGKVP/24SMS-${Date.now().toString().slice(-6)}`;
                    
                    const nextRollNumber = (state.data.students || []).length + 1;
                    const newRollNumber = `SMS${new Date().getFullYear().toString().slice(-2)}${(nextRollNumber).toString().padStart(5, '0')}`;
                    
                    const photoFile = getEl('admission-photo').files[0];
                    if (!photoFile) {
                        showToast("Student photo is required.", "error");
                        getEl('loading-overlay').style.display = 'none';
                        return;
                    }
                    
                    const aadharFile = getEl('admission-doc-aadhar').files[0];
                    const signatureFile = getEl('admission-doc-signature').files[0];

                    const studentPhoto = await fileToBase64(photoFile);
                    let studentDocs = [];
                    if(aadharFile) studentDocs.push({ name: "Aadhar Card", data: await fileToBase64(aadharFile), filename: aadharFile.name });
                    if(signatureFile) studentDocs.push({ name: "Signature", data: await fileToBase64(signatureFile), filename: signatureFile.name });

                    const studentData = {
                        id: studentId,
                        admissionNumber,
                        rollNumber: newRollNumber,
                        name: getEl('admission-name').value.trim(),
                        fatherName: getEl('admission-father-name').value.trim(),
                        motherName: getEl('admission-mother-name').value.trim(),
                        guardianName: getEl('admission-guardian-name').value.trim(),
                        guardianContact: getEl('admission-guardian-contact').value.trim(),
                        category: getEl('admission-category').value,
                        dob: getEl('admission-dob').value,
                        gender: getEl('admission-gender').value,
                        email: getEl('admission-email').value.trim(),
                        contact: getEl('admission-contact').value.trim(),
                        password: btoa(getEl('admission-password').value),
                        address: getEl('admission-address').value.trim(),
                        pincode: getEl('admission-pincode').value.trim(),
                        photo: studentPhoto,
                        board: "MGKVP",
                        className: getEl('admission-class').value,
                        documents: studentDocs
                    };

                    updateOrAddItem('students', studentData);

                    getEl('loading-overlay').style.display = 'none';
                    closeModal();
                    showAdmissionReceipt(studentData);
                    showToast('Admission Successful!', 'success');

                } catch (err) {
                    console.error("Admission Error:", err);
                    getEl('loading-overlay').style.display = 'none';
                    showToast('Admission failed. Please check all fields and try again.', 'error');
                }
            }
            
            function showAdmissionReceipt(student) {
                const schoolInfo = state.data.siteContent;
                const modalId = `receipt-${student.id}`;

                const receiptContent = `
                    <div class="printable-area" id="${modalId}">
                        <div class="receipt-container">
                             <div class="receipt-header">
                                <h2 style="text-transform: uppercase;">${schoolInfo.schoolName}</h2>
                                <p>${schoolInfo.schoolAddress}</p>
                                <h3>ADMISSION CONFIRMATION</h3>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px;">
                                <div>
                                    <p><strong>Admission No:</strong> ${student.admissionNumber}</p>
                                    <p><strong>Roll No:</strong> ${student.rollNumber}</p>
                                    <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                                </div>
                                <img src="${student.photo}" alt="Student Photo" class="receipt-student-photo">
                            </div>

                            <dl class="receipt-details-grid">
                                <dt>Student Name:</dt><dd>${student.name}</dd>
                                <dt>Father's Name:</dt><dd>${student.fatherName}</dd>
                                <dt>Course:</dt><dd>${student.className}</dd>
                            </dl>

                            <div class="receipt-footer">
                                <div class="receipt-signature">
                                    <div class="receipt-signature-line"></div>
                                    <p>Authorized Signature</p>
                                </div>
                                <p>Welcome! This is a computer-generated confirmation.</p>
                            </div>
                        </div>
                    </div>
                     <div class="no-print" style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="action-button" onclick="printContent('#${modalId}')"><i class="fas fa-print"></i> Print Receipt</button>
                        <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Admission-Receipt-${student.admissionNumber}.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                `;
                showModal('Admission Successful', receiptContent, '800px');
            }


            function showFeeReceipt(studentId, transactionId, autoPrint = false) {
                const schoolInfo = state.data.siteContent;
                const student = findById('students', studentId);
                const transaction = findById('transactions', transactionId);
                if (!student || !transaction) return showToast("Receipt not found", "error");

                const modalId = `receipt-${transactionId}`;
                const receiptContent = `
                    <div class="printable-area" id="${modalId}">
                        <div class="receipt-container">
                             <div class="receipt-header">
                                <h2 style="text-transform: uppercase;">${schoolInfo.schoolName}</h2>
                                <p>${schoolInfo.schoolAddress}</p>
                                <h3>FEE RECEIPT</h3>
                            </div>
                            <div style="margin-bottom: 25px;">
                                <p><strong>Receipt No:</strong> ${transaction.id}</p>
                                <p><strong>Date:</strong> ${new Date(transaction.date).toLocaleDateString()}</p>
                            </div>
                            <dl class="receipt-details-grid">
                                <dt>Admission No:</dt><dd>${student.admissionNumber}</dd>
                                <dt>Roll No:</dt><dd>${student.rollNumber}</dd>
                                <dt>Student Name:</dt><dd>${student.name}</dd>
                                <dt>Amount Paid:</dt><dd style="font-weight: bold; font-size: 1.1rem;">₹${Number(transaction.amount).toLocaleString()}</dd>
                                <dt>Payment For:</dt><dd>${transaction.type || 'Fee Payment'}</dd>
                            </dl>
                            <div class="receipt-footer">
                                <div class="receipt-signature">
                                    <div class="receipt-signature-line"></div>
                                    <p>Authorized Signature</p>
                                </div>
                                <p>Thank you for your payment.</p>
                            </div>
                        </div>
                    </div>
                    <div class="no-print" style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="action-button" onclick="printContent('#${modalId}')"><i class="fas fa-print"></i> Print Receipt</button>
                        <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Fee-Receipt-${transaction.id}.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                `;
                showModal('Fee Payment Receipt', receiptContent, '800px');
                
                if (autoPrint) {
                    setTimeout(() => printContent(`#${modalId}`), 500);
                }
            }


            function renderNoticeBoardPage() {
                const mainContent = getEl('main-content');
                
                const userRole = state.loggedInUser?.role || 'guest';
                const actionsHtml = userRole === 'admin' ? `<button class="action-button inline" onclick="showNoticeForm()"><i class="fas fa-plus"></i> Add Notice</button>` : '';

                mainContent.innerHTML = renderHeader('Notice Board', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="table-container"><table id="notices-table"></table></div></div></div>`;
                renderNoticesTable();
            }

            function renderNoticesTable() {
                const table = getEl('notices-table');
                if(!table) return;
                const userRole = state.loggedInUser?.role || 'guest';
                const { notices } = state.data;
                let html = `<thead><tr><th>Title</th><th>Content</th><th>Date</th>`;
                if(userRole === 'admin') html += `<th>Actions</th>`;
                html += `</tr></thead><tbody>`;

                if (!notices || notices.length === 0) {
                     html += `<tr><td colspan="${userRole === 'admin' ? 4 : 3}" style="text-align:center;">No notices found.</td></tr>`;
                } else { 
                    notices.sort((a,b) => b.id - a.id).forEach(n => { 
                        html += `<tr><td>${n.title}</td><td>${n.content}</td><td>${new Date(n.id).toLocaleString()}</td>`;
                        if(userRole === 'admin') {
                           html += `<td class="action-buttons">
                                        <button class="edit-btn" onclick="showNoticeForm('${n.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                        <button class="delete-btn" onclick="deleteItem('notices', '${n.id}', 'Are you sure you want to delete this notice?', renderNoticesTable)" title="Delete"><i class="fas fa-trash"></i></button>
                                    </td>`;
                        }
                        html += `</tr>`;
                    }); 
                }
                html += '</tbody>'; 
                table.innerHTML = html;
            }

            function showNoticeForm(id = null) {
                const notice = id ? findById('notices', id) : {};
                const title = id ? 'Edit Notice' : 'Add New Notice';
                const formContent = `<form id="notice-form"><input type="hidden" id="notice-id" value="${notice.id || ''}"><div class="form-group"><label for="notice-title">Title</label><input type="text" id="notice-title" value="${notice.title || ''}" required></div><div class="form-group"><label for="notice-content">Content</label><textarea id="notice-content" rows="5" required>${notice.content || ''}</textarea></div><button type="submit" class="action-button">${id ? 'Save Changes' : 'Add Notice'}</button></form>`;
                showModal(title, formContent);
                getEl('notice-form').onsubmit = e => { e.preventDefault(); const noticeData = { id: getEl('notice-id').value || Date.now(), title: getEl('notice-title').value, content: getEl('notice-content').value }; updateOrAddItem('notices', noticeData); showToast(`Notice ${id ? 'updated' : 'added'}!`, 'success'); closeModal(); renderNoticesTable(); if (state.currentPage === 'home') renderHomePage(); };
            }

            function renderEventsPage() {
                const mainContent = getEl('main-content');
                const userRole = state.loggedInUser?.role || 'guest';
                const actionsHtml = userRole === 'admin' ? `<button class="action-button inline" onclick="showEventForm()"><i class="fas fa-plus"></i> Add Event</button>` : '';
                mainContent.innerHTML = renderHeader('College Events', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="table-container"><table id="events-table"></table></div></div></div>`;
                renderEventsTable();
            }

            function renderEventsTable() {
                const table = getEl('events-table');
                if(!table) return;
                const userRole = state.loggedInUser?.role || 'guest';
                const { events } = state.data;
                let html = `<thead><tr><th>Title</th><th>Description</th><th>Event Date</th>`;
                if(userRole === 'admin') html += `<th>Actions</th>`;
                html += `</tr></thead><tbody>`;

                if (!events || events.length === 0) {
                     html += `<tr><td colspan="${userRole === 'admin' ? 4 : 3}" style="text-align:center;">No events found.</td></tr>`;
                } else { 
                    events.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(event => { 
                        html += `<tr>
                                    <td>${event.title}</td>
                                    <td>${event.description}</td>
                                    <td>${new Date(event.date).toLocaleDateString()}</td>
                                    ${userRole === 'admin' ? `
                                    <td class="action-buttons">
                                        <button class="edit-btn" onclick="showEventForm('${event.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                        <button class="delete-btn" onclick="deleteItem('events', '${event.id}', 'Are you sure you want to delete this event?', renderEventsTable)" title="Delete"><i class="fas fa-trash"></i></button>
                                    </td>` : ''}
                                </tr>`;
                    }); 
                }
                html += '</tbody>'; 
                table.innerHTML = html;
            }

            function showEventForm(id = null) {
                const event = id ? findById('events', id) : {};
                const title = id ? 'Edit Event' : 'Add New Event';
                const formContent = `<form id="event-form">
                    <input type="hidden" id="event-id" value="${event.id || ''}">
                    <div class="form-group"><label for="event-title">Title</label><input type="text" id="event-title" value="${event.title || ''}" required></div>
                    <div class="form-group"><label for="event-description">Description</label><textarea id="event-description" rows="5" required>${event.description || ''}</textarea></div>
                    <div class="form-group"><label for="event-date">Event Date</label><input type="date" id="event-date" value="${event.date || ''}" required></div>
                    <button type="submit" class="action-button">${id ? 'Save Changes' : 'Add Event'}</button>
                </form>`;
                showModal(title, formContent);
                getEl('event-form').onsubmit = e => { 
                    e.preventDefault(); 
                    const eventData = { 
                        id: getEl('event-id').value || Date.now(), 
                        title: getEl('event-title').value, 
                        description: getEl('event-description').value,
                        date: getEl('event-date').value
                    }; 
                    updateOrAddItem('events', eventData); 
                    showToast(`Event ${id ? 'updated' : 'added'}!`, 'success'); 
                    closeModal(); 
                    renderEventsTable(); 
                    if (state.currentPage === 'home') renderHomePage();
                };
            }

            function renderBookListPage() {
                const mainContent = getEl('main-content');
                const userRole = state.loggedInUser?.role || 'guest';
                const actionsHtml = userRole === 'admin' ? `<button class="action-button inline" onclick="showBookForm()"><i class="fas fa-plus"></i> Add Book</button>` : '';
                mainContent.innerHTML = renderHeader('Library - Book List', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card">
                    <div class="search-box-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="book-search-input" oninput="renderBookTable(this.value)" placeholder="Search by Title, Author, or Book ID..." class="search-input">
                    </div>
                    <div class="table-container"><table id="books-table"></table></div>
                </div></div>`;
                renderBookTable();
            }

            function renderBookTable(searchTerm = '') {
                const table = getEl('books-table');
                if(!table) return;
                const userRole = state.loggedInUser?.role || 'guest';
                const bookList = (state.data.books || []).filter(b => searchTerm ? 
                    (b.title.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (b.author.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (b.bookId.toLowerCase().includes(searchTerm.toLowerCase()))
                    : true);

                let head = `<thead><tr><th>Book ID</th><th>Title</th><th>Author</th><th>Available Copies</th>${userRole === 'admin' ? '<th>Actions</th>': ''}</tr></thead>`;
                let body = `<tbody>`;
                if (bookList.length === 0) {
                     body += `<tr><td colspan="${userRole === 'admin' ? 5 : 4}" style="text-align:center;">No books found.</td></tr>`;
                } else {
                     bookList.sort((a, b) => (a.title > b.title) ? 1 : -1).forEach(b => { 
                        const issuedCount = (state.data.issuedBooks || []).filter(ib => ib.bookId === b.id && !ib.returnDate).length;
                        const availableCopies = b.copies - issuedCount;
                        body += `<tr>
                            <td><strong>${b.bookId}</strong></td>
                            <td>${b.title}</td>
                            <td>${b.author}</td>
                            <td>${availableCopies} / ${b.copies}</td>
                            ${userRole === 'admin' ? `
                            <td class="action-buttons">
                                <button class="edit-btn" onclick="showBookForm('${b.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="delete-btn" onclick="deleteItem('books', '${b.id}', 'Are you sure you want to delete this book?', renderBookTable)" title="Delete"><i class="fas fa-trash"></i></button>
                            </td>` : ''}
                        </tr>`; 
                    });
                }
                table.innerHTML = head + body + `</tbody>`;
            }
            
            function showBookForm(id = null) {
                const book = id ? findById('books', id) : {};
                const title = id ? 'Edit Book' : 'Add New Book';
                const formContent = `<form id="book-form">
                    <input type="hidden" id="book-id" value="${book.id || ''}">
                    <div class="form-group"><label for="book-title">Title</label><input type="text" id="book-title" value="${book.title || ''}" required></div>
                    <div class="form-group"><label for="book-author">Author</label><input type="text" id="book-author" value="${book.author || ''}" required></div>
                    <div class="form-group"><label for="book-copies">Total Copies</label><input type="number" id="book-copies" value="${book.copies || '1'}" min="1" required></div>
                    <button type="submit" class="action-button">${id ? 'Save Changes' : 'Add Book'}</button>
                </form>`;
                showModal(title, formContent);
                getEl('book-form').onsubmit = e => {
                    e.preventDefault();
                    const bookData = {
                        id: getEl('book-id').value || Date.now().toString(),
                        bookId: book.bookId || `BOOK-${Date.now().toString().slice(-6)}`,
                        title: getEl('book-title').value,
                        author: getEl('book-author').value,
                        copies: parseInt(getEl('book-copies').value),
                    };
                    updateOrAddItem('books', bookData);
                    showToast(`Book ${id ? 'updated' : 'added'}!`, 'success');
                    closeModal();
                    renderBookTable();
                    if (state.currentPage === 'home') renderHomePage();
                };
            }

            function renderIssueReturnPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Library - Issue & Return');
                mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="card-header"><h3>Issue a New Book</h3></div>
                        <form id="issue-book-form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="issue-student-id">Student Admission No.</label>
                                    <input type="text" id="issue-student-id" required>
                                </div>
                                <div class="form-group">
                                    <label for="issue-book-id">Book ID</label>
                                    <input type="text" id="issue-book-id" required>
                                </div>
                            </div>
                            <button type="submit" class="action-button">Issue Book</button>
                        </form>
                    </div>

                    <div class="card">
                        <div class="card-header"><h3>Currently Issued Books</h3></div>
                        <div class="table-container"><table id="issued-books-table"></table></div>
                    </div>
                </div>`;
                renderIssuedBooksTable();
                getEl('issue-book-form').onsubmit = handleIssueBook;
            }
            
            function handleIssueBook(e) {
                e.preventDefault();
                const studentAdmNo = getEl('issue-student-id').value;
                const bookIdentifier = getEl('issue-book-id').value;

                const student = (state.data.students || []).find(s => s.admissionNumber === studentAdmNo);
                const book = (state.data.books || []).find(b => b.bookId === bookIdentifier);

                if(!student) return showToast('Student not found with this Admission No.', 'error');
                if(!book) return showToast('Book not found with this Book ID.', 'error');
                
                const issuedCount = (state.data.issuedBooks || []).filter(ib => ib.bookId === book.id && !ib.returnDate).length;
                if(issuedCount >= book.copies) return showToast('All copies of this book are currently issued.', 'error');

                const issueData = {
                    id: Date.now().toString(),
                    studentId: student.id,
                    bookId: book.id,
                    issueDate: new Date().toISOString().slice(0, 10),
                    returnDate: null
                };

                updateOrAddItem('issuedBooks', issueData);
                showToast(`Book "${book.title}" issued to ${student.name}.`, 'success');
                e.target.reset();
                renderIssuedBooksTable();
                renderBookTable();
            }
            
            function renderIssuedBooksTable() {
                const table = getEl('issued-books-table');
                if (!table) return;

                const issuedList = (state.data.issuedBooks || []).filter(ib => !ib.returnDate);
                let html = `<thead><tr><th>Book Title</th><th>Student Name</th><th>Issue Date</th><th>Action</th></tr></thead><tbody>`;

                if(issuedList.length === 0) {
                    html += `<tr><td colspan="4" style="text-align:center;">No books are currently issued.</td></tr>`;
                } else {
                    issuedList.sort((a,b) => new Date(b.issueDate) - new Date(a.issueDate)).forEach(ib => {
                        const book = findById('books', ib.bookId);
                        const student = findById('students', ib.studentId);
                        if(book && student) {
                             html += `<tr>
                                <td>${book.title}</td>
                                <td>${student.name}</td>
                                <td>${new Date(ib.issueDate).toLocaleDateString()}</td>
                                <td><button class="action-button secondary" onclick="handleReturnBook('${ib.id}')">Return</button></td>
                            </tr>`;
                        }
                    });
                }
                html += `</tbody>`;
                table.innerHTML = html;
            }

            function handleReturnBook(issueId) {
                if(confirm('Are you sure this book is being returned?')) {
                    const issuedBook = findById('issuedBooks', issueId);
                    if(issuedBook) {
                        issuedBook.returnDate = new Date().toISOString().slice(0, 10);
                        updateOrAddItem('issuedBooks', issuedBook);
                        showToast('Book marked as returned.', 'success');
                        renderIssuedBooksTable();
                        renderBookTable();
                    }
                }
            }


            function renderTeacherPage() {
                if (state.currentView === 'profile' && state.currentItemId) {
                    renderTeacherProfilePage(state.currentItemId);
                } else {
                    renderTeacherListPage();
                }
            }

            function renderTeacherListPage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showTeacherForm()"><i class="fas fa-plus"></i> Add Teacher</button>`;
                mainContent.innerHTML = renderHeader('Teacher Management', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="card-header"><h3>Teacher List</h3></div>
                             <div class="search-box-container">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" id="teacher-search-input" oninput="renderTeacherTable(this.value)" placeholder="Search by Name, Employee ID..." class="search-input">
                                </div>
                            <div class="table-container"><table id="teachers-table"></table></div></div></div>`;
                renderTeacherTable();
            }

            function renderTeacherTable(searchTerm = '') {
                const table = getEl('teachers-table');
                if (!table) return;
                const teacherList = (state.data.teachers || []).filter(t => searchTerm ? 
                    (t.name && t.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (t.employeeId && t.employeeId.toLowerCase().includes(searchTerm.toLowerCase()))
                    : true);

                let head = `<thead><tr><th>Photo</th><th>Employee ID</th><th>Name</th><th>Role/Subject</th><th>Contact</th><th>Actions</th></tr></thead>`;
                let body = `<tbody>`;
                if (teacherList.length === 0) {
                     body += `<tr><td colspan="6" style="text-align:center;">No teachers found.</td></tr>`;
                } else {
                     teacherList.sort((a, b) => (a.name > b.name) ? 1 : -1).forEach(t => { 
                        body += `<tr>
                            <td><img src="${t.photo || `https://i.pravatar.cc/45?u=${t.id}`}" alt="Photo" class="table-photo"></td>
                            <td><strong>${t.employeeId || 'N/A'}</strong></td>
                            <td>${t.name}</td>
                            <td>${t.role}</td>
                            <td>${t.contact}</td>
                            <td class="action-buttons">
                                <button class="view-btn" onclick="navigate('teachers', 'profile', '${t.id}')" title="View Profile"><i class="fas fa-eye"></i></button>
                                <button class="edit-btn" onclick="showTeacherForm('${t.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="delete-btn" onclick="deleteItem('teachers', '${t.id}', 'Are you sure you want to delete this teacher?', renderTeacherTable)" title="Delete"><i class="fas fa-trash"></i></button>


                            </td>
                        </tr>`; 
                    });
                }
                table.innerHTML = head + body + `</tbody>`;
            }

            async function showTeacherForm(id = null) {
                const teacher = id ? findById('teachers', id) : {};
                const title = id ? 'Edit Teacher' : 'Add New Teacher';
                const formContent = `<form id="teacher-form">
                        <input type="hidden" id="teacher-id" value="${teacher.id || ''}">
                        <div class="form-grid">
                            <div class="form-group"><label for="teacher-name">Full Name</label><input type="text" id="teacher-name" value="${teacher.name || ''}" required></div>
                            <div class="form-group"><label for="teacher-role">Role / Subject Taught</label><input type="text" id="teacher-role" value="${teacher.role || ''}" placeholder="e.g., Maths Teacher" required></div>
                            <div class="form-group"><label for="teacher-email">Email</label><input type="email" id="teacher-email" value="${teacher.email || ''}"></div>
                            <div class="form-group"><label for="teacher-contact">Contact Number</label><input type="tel" id="teacher-contact" value="${teacher.contact || ''}" required></div>
                             <div class="form-group"><label for="teacher-dob">Date of Birth</label><input type="text" id="teacher-dob" placeholder="YYYY-MM-DD" value="${teacher.dob || ''}" required></div>
                            <div class="form-group"><label for="teacher-password">Password</label><input type="password" id="teacher-password" ${id && teacher.password ? 'placeholder="Leave blank to keep unchanged"' : 'required'}></div>
                        </div>
                        <div class="form-group"><label for="teacher-photo">Teacher's Photo</label><input type="file" id="teacher-photo" accept="image/*"><input type="hidden" id="teacher-photo-base64" value="${teacher.photo || ''}"></div>
                        <button type="submit" class="action-button" style="width: 100%; margin-top: 20px;">${id ? 'Save Changes' : 'Add Teacher'}</button>
                    </form>`;
                showModal(title, formContent, '800px');
                getEl('teacher-photo').onchange = async (e) => { if (e.target.files[0]) getEl('teacher-photo-base64').value = await fileToBase64(e.target.files[0]); };
                getEl('teacher-form').onsubmit = (e) => { 
                    e.preventDefault();
                    const newPassword = getEl('teacher-password').value;
                    const teacherData = { 
                        ...teacher,
                        id: getEl('teacher-id').value || Date.now().toString(), 
                        employeeId: teacher.employeeId || `EMP-${Date.now().toString().slice(-6)}`,
                        name: getEl('teacher-name').value, 
                        role: getEl('teacher-role').value,
                        email: getEl('teacher-email').value, 
                        contact: getEl('teacher-contact').value,
                        dob: getEl('teacher-dob').value,
                        photo: getEl('teacher-photo-base64').value,
                        password: newPassword ? btoa(newPassword) : teacher.password
                    };
                    updateOrAddItem('teachers', teacherData);
                    showToast(`Teacher ${id ? 'updated' : 'added'}!`, 'success');
                    closeModal(); 
                    if(state.currentView === 'profile') {
                       renderTeacherProfilePage(teacherData.id);
                    } else {
                       renderTeacherTable();
                    }
                };
            }
            
            function renderTeacherProfilePage(id) {
                const teacher = findById('teachers', id);
                if (!teacher) {
                    showToast('Teacher not found.', 'error');
                    return navigate('teachers', 'list');
                }
                
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Teacher Profile', `<button class="action-button inline" onclick="navigate('teachers', 'list')"><i class="fas fa-arrow-left"></i> Back to List</button>`);
                
                const { present, absent } = calculateAttendance('teachers', id);
                const totalDays = present + absent;
                const attendancePercentage = totalDays > 0 ? ((present / totalDays) * 100).toFixed(1) : '0';
                const modalId = `teacher-profile-printable-${id}`;

                mainContent.innerHTML += `
                    <div class="page active">
                        <div class="profile-grid" id="${modalId}">
                            <div class="card profile-card">
                                <img class="profile-photo" src="${teacher.photo || `https://i.pravatar.cc/150?u=${teacher.id}`}" alt="Teacher Photo">
                                <h2 style="text-align: center;">${teacher.name}</h2>
                                <p style="text-align: center; color: var(--text-muted);">${teacher.role}</p>
                                <ul class="profile-details">
                                    <li><i class="fas fa-id-card"></i> ${teacher.employeeId || 'Not Assigned'}</li>
                                    <li><i class="fas fa-envelope"></i> ${teacher.email || 'N/A'}</li>
                                    <li><i class="fas fa-phone"></i> ${teacher.contact}</li>
                                </ul>
                                 <div class="no-print" style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top:20px;">
                                    <button onclick="showTeacherForm('${id}')" class="action-button">Edit</button>
                                    <button onclick="showTeacherIdCard('${id}')" class="action-button"><i class="fas fa-id-card"></i> ID Card</button>
                                    <button onclick="downloadAsPdf('#${modalId}', 'Teacher-Profile-${teacher.name}.pdf')" class="action-button secondary"><i class="fas fa-download"></i> Download</button>
                                </div>
                            </div>
                            <div>
                                <div class="card">
                                    <div class="card-header"><h3>Attendance Summary</h3></div>
                                    <div class="attendance-stats">
                                        <div class="stat-item present"><span class="count">${present}</span><span>Present</span></div>
                                        <div class="stat-item absent"><span class="count">${absent}</span><span>Absent</span></div>
                                    </div>
                                    <div class="attendance-bar-container"><div class="attendance-bar" style="width: ${attendancePercentage}%;"></div></div>
                                    <p class="percentage">${attendancePercentage}% Overall Attendance</p>
                                </div>
                                 <div class="card"><div class="card-header"><h3>Attendance History</h3></div><div id="attendance-history-container" style="max-height: 300px; overflow-y: auto;"></div></div>
                            </div>
                        </div>
                    </div>`;
                renderAttendanceHistory('teachers', id);
            }
            
            function showTeacherIdCard(teacherId) {
                const schoolInfo = state.data.siteContent;
                const teacher = findById('teachers', teacherId);
                if (!teacher) return;
                
                const modalId = `teacher-id-${teacherId}`;
                const modalContent = `
                    <div class="printable-area" id="${modalId}">
                        <div class="id-card">
                            <div class="id-card-header">
                                <h3 style="text-transform: uppercase;">${schoolInfo.schoolName}</h3>
                                <p style="font-size: 0.9em; margin-top: 5px;">TEACHER ID CARD</p>
                            </div>
                            <div class="id-card-body">
                                <img src="${teacher.photo || `https://i.pravatar.cc/100?u=${teacher.id}`}" alt="Photo" class="id-card-photo">
                                <h4>${teacher.name}</h4>
                                <p><strong>Employee ID:</strong> ${teacher.employeeId || 'N/A'}</p>
                                <p><strong>Role:</strong> ${teacher.role || 'N/A'}</p>
                                <div class="id-card-qr" id="id-card-qr-code"></div>
                            </div>
                        </div>
                    </div>
                     <div class="no-print" style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="action-button" onclick="printContent('#${modalId}')"><i class="fas fa-print"></i> Print ID Card</button>
                        <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Teacher-ID-${teacher.name}.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                `;
                showModal('Teacher ID Card', modalContent, '400px');
                if (teacher.employeeId) {
                     setTimeout(() => {
                        const qrContainer = getEl('id-card-qr-code');
                        if(qrContainer){
                           qrContainer.innerHTML = '';
                           new QRCode(qrContainer, { text: teacher.employeeId, width: 120, height: 120, colorDark : "#000000", colorLight : "#ffffff" });
                           convertQrCanvasToImage(qrContainer);
                        }
                    }, 200);
                }
            }

            function renderStaffPage() {
                if (state.currentView === 'profile' && state.currentItemId) {
                    renderStaffProfilePage(state.currentItemId);
                } else {
                    renderStaffListPage();
                }
            }

            function renderStaffListPage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showStaffForm()"><i class="fas fa-plus"></i> Add Staff</button>`;
                mainContent.innerHTML = renderHeader('Staff Management', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="card-header"><h3>Staff List</h3></div>
                             <div class="search-box-container">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" id="staff-search-input" oninput="renderStaffTable(this.value)" placeholder="Search by Name, Employee ID..." class="search-input">
                                </div>
                            <div class="table-container"><table id="staff-table"></table></div></div></div>`;
                renderStaffTable();
            }

            function renderStaffTable(searchTerm = '') {
                const table = getEl('staff-table');
                if (!table) return;
                const staffList = (state.data.staff || []).filter(s => searchTerm ? 
                    (s.name && s.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (s.employeeId && s.employeeId.toLowerCase().includes(searchTerm.toLowerCase()))
                    : true);

                let head = `<thead><tr><th>Photo</th><th>Employee ID</th><th>Name</th><th>Role</th><th>Contact</th><th>Actions</th></tr></thead>`;
                let body = `<tbody>`;
                if (staffList.length === 0) {
                     body += `<tr><td colspan="6" style="text-align:center;">No staff members found.</td></tr>`;
                } else {
                     staffList.sort((a, b) => (a.name > b.name) ? 1 : -1).forEach(s => { 
                        body += `<tr>
                            <td><img src="${s.photo || `https://i.pravatar.cc/45?u=${s.id}`}" alt="Photo" class="table-photo"></td>
                            <td><strong>${s.employeeId || 'N/A'}</strong></td>
                            <td>${s.name}</td>
                            <td>${s.role}</td>
                            <td>${s.contact}</td>
                            <td class="action-buttons">
                                <button class="view-btn" onclick="navigate('staff', 'profile', '${s.id}')" title="View Profile"><i class="fas fa-eye"></i></button>
                                <button class="edit-btn" onclick="showStaffForm('${s.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="delete-btn" onclick="deleteItem('staff', '${s.id}', 'Are you sure you want to delete this staff member?', renderStaffTable)" title="Delete"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`; 
                    });
                }
                table.innerHTML = head + body + `</tbody>`;
            }

            async function showStaffForm(id = null) {
                const staff = id ? findById('staff', id) : {};
                const title = id ? 'Edit Staff Member' : 'Add New Staff Member';
                const formContent = `<form id="staff-form">
                        <input type="hidden" id="staff-id" value="${staff.id || ''}">
                        <div class="form-grid">
                            <div class="form-group"><label for="staff-name">Full Name</label><input type="text" id="staff-name" value="${staff.name || ''}" required></div>
                            <div class="form-group"><label for="staff-role">Role</label><input type="text" id="staff-role" value="${staff.role || ''}" placeholder="e.g., Accountant, Security" required></div>
                            <div class="form-group"><label for="staff-email">Email</label><input type="email" id="staff-email" value="${staff.email || ''}"></div>
                            <div class="form-group"><label for="staff-contact">Contact Number</label><input type="tel" id="staff-contact" value="${staff.contact || ''}" required></div>
                             <div class="form-group"><label for="staff-dob">Date of Birth</label><input type="text" id="staff-dob" placeholder="YYYY-MM-DD" value="${staff.dob || ''}" required></div>
                        </div>
                        <div class="form-group"><label for="staff-photo">Staff Photo</label><input type="file" id="staff-photo" accept="image/*"><input type="hidden" id="staff-photo-base64" value="${staff.photo || ''}"></div>
                        <button type="submit" class="action-button" style="width: 100%; margin-top: 20px;">${id ? 'Save Changes' : 'Add Staff Member'}</button>
                    </form>`;
                showModal(title, formContent, '800px');
                getEl('staff-photo').onchange = async (e) => { if (e.target.files[0]) getEl('staff-photo-base64').value = await fileToBase64(e.target.files[0]); };
                getEl('staff-form').onsubmit = (e) => { 
                    e.preventDefault();
                    const staffData = { 
                        ...staff,
                        id: getEl('staff-id').value || Date.now().toString(), 
                        employeeId: staff.employeeId || `STF-${Date.now().toString().slice(-6)}`,
                        name: getEl('staff-name').value, 
                        role: getEl('staff-role').value,
                        email: getEl('staff-email').value, 
                        contact: getEl('staff-contact').value,
                        dob: getEl('staff-dob').value,
                        photo: getEl('staff-photo-base64').value,
                    };
                    updateOrAddItem('staff', staffData);
                    showToast(`Staff member ${id ? 'updated' : 'added'}!`, 'success');
                    closeModal(); 
                    if(state.currentView === 'profile') {
                       renderStaffProfilePage(staffData.id);
                    } else {
                       renderStaffTable();
                    }
                };
            }
            
            function renderStaffProfilePage(id) {
                const staffMember = findById('staff', id);
                if (!staffMember) {
                    showToast('Staff member not found.', 'error');
                    return navigate('staff', 'list');
                }
                
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Staff Profile', `<button class="action-button inline" onclick="navigate('staff', 'list')"><i class="fas fa-arrow-left"></i> Back to List</button>`);
                
                const { present, absent } = calculateAttendance('staff', id);
                const totalDays = present + absent;
                const attendancePercentage = totalDays > 0 ? ((present / totalDays) * 100).toFixed(1) : '0';
                const modalId = `staff-profile-printable-${id}`;

                mainContent.innerHTML += `
                    <div class="page active">
                        <div class="profile-grid" id="${modalId}">
                            <div class="card profile-card">
                                <img class="profile-photo" src="${staffMember.photo || `https://i.pravatar.cc/150?u=${id}`}" alt="Staff Photo">
                                <h2 style="text-align: center;">${staffMember.name}</h2>
                                <p style="text-align: center; color: var(--text-muted);">${staffMember.role}</p>
                                <ul class="profile-details">
                                    <li><i class="fas fa-id-card"></i> ${staffMember.employeeId || 'Not Assigned'}</li>
                                    <li><i class="fas fa-envelope"></i> ${staffMember.email || 'N/A'}</li>
                                    <li><i class="fas fa-phone"></i> ${staffMember.contact}</li>
                                </ul>
                                 <div class="no-print" style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top:20px;">
                                    <button onclick="showStaffForm('${id}')" class="action-button">Edit</button>
                                    <button onclick="showStaffIdCard('${id}')" class="action-button"><i class="fas fa-id-card"></i> ID Card</button>
                                    <button onclick="downloadAsPdf('#${modalId}', 'Staff-Profile-${staffMember.name}.pdf')" class="action-button secondary"><i class="fas fa-download"></i> Download</button>
                                </div>
                            </div>
                            <div>
                                <div class="card">
                                    <div class="card-header"><h3>Attendance Summary</h3></div>
                                    <div class="attendance-stats">
                                        <div class="stat-item present"><span class="count">${present}</span><span>Present</span></div>
                                        <div class="stat-item absent"><span class="count">${absent}</span><span>Absent</span></div>
                                    </div>
                                    <div class="attendance-bar-container"><div class="attendance-bar" style="width: ${attendancePercentage}%;"></div></div>
                                    <p class="percentage">${attendancePercentage}% Overall Attendance</p>
                                </div>
                                 <div class="card"><div class="card-header"><h3>Attendance History</h3></div><div id="attendance-history-container" style="max-height: 300px; overflow-y: auto;"></div></div>
                            </div>
                        </div>
                    </div>`;
                renderAttendanceHistory('staff', id);
            }
            
            function showStaffIdCard(staffId) {
                const schoolInfo = state.data.siteContent;
                const staffMember = findById('staff', staffId);
                if (!staffMember) return;

                const modalId = `staff-id-${staffId}`;
                const modalContent = `
                    <div class="printable-area" id="${modalId}">
                        <div class="id-card">
                            <div class="id-card-header">
                                <h3 style="text-transform: uppercase;">${schoolInfo.schoolName}</h3>
                                <p style="font-size: 0.9em; margin-top: 5px;">STAFF ID CARD</p>
                            </div>
                            <div class="id-card-body">
                                <img src="${staffMember.photo || `https://i.pravatar.cc/100?u=${staffId}`}" alt="Photo" class="id-card-photo">
                                <h4>${staffMember.name}</h4>
                                <p><strong>Employee ID:</strong> ${staffMember.employeeId || 'N/A'}</p>
                                <p><strong>Role:</strong> ${staffMember.role || 'N/A'}</p>
                                <div class="id-card-qr" id="id-card-qr-code"></div>
                            </div>
                        </div>
                    </div>
                     <div class="no-print" style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="action-button" onclick="printContent('#${modalId}')"><i class="fas fa-print"></i> Print ID Card</button>
                        <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Staff-ID-${staffMember.name}.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                `;
                showModal('Staff ID Card', modalContent, '400px');
                if (staffMember.employeeId) {
                     setTimeout(() => {
                        const qrContainer = getEl('id-card-qr-code');
                        if(qrContainer){
                           qrContainer.innerHTML = '';
                           new QRCode(qrContainer, { text: staffMember.employeeId, width: 120, height: 120, colorDark : "#000000", colorLight : "#ffffff" });
                           convertQrCanvasToImage(qrContainer);
                        }
                    }, 200);
                }
            }

            function renderStudentPage() {
                 if (state.currentView === 'profile' && state.currentItemId) {
                    renderStudentProfilePage(state.currentItemId);
                } else {
                    renderStudentListPage();
                }
            }

            function renderStudentListPage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="navigate('admission')"><i class="fas fa-plus"></i> Add Student</button>`;
                mainContent.innerHTML = renderHeader('Students', actionsHtml);

                const preFilter = state.studentListFilter;
                let filterInfo = '';
                if (preFilter) {
                    filterInfo = `
                        <div class="card" style="border-left: 4px solid var(--info-color);">
                            Showing students from <strong>${preFilter}</strong>. 
                            <a href="#" onclick="event.preventDefault(); navigate('students', 'list', null, null)" style="margin-left: 15px;">Clear Filter</a>
                        </div>`;
                }
                
                mainContent.innerHTML += `<div class="page active">
                            ${filterInfo}
                            <div class="card">
                                <div class="card-header"><h3>Student List</h3></div>
                                <div class="table-controls">
                                    <div class="search-box-container">
                                        <i class="fas fa-search search-icon"></i>
                                        <input type="text" id="student-search-input" oninput="renderStudentTable(this.value)" placeholder="Search by Name, Roll No, Admission No..." class="search-input">
                                    </div>
                                </div>
                                <div class="table-container"><table id="students-table"></table></div>
                            </div>
                        </div>`;

                renderStudentTable();
            }

            function renderStudentTable(searchTerm = '') {
                const table = getEl('students-table');
                if (!table) return;

                let students = state.data.students || [];

                const preFilter = state.studentListFilter;
                if (preFilter) {
                    students = students.filter(s => s.className === preFilter);
                }

                if (searchTerm) {
                    searchTerm = searchTerm.toLowerCase();
                    students = students.filter(s => 
                        (s.name && s.name.toLowerCase().includes(searchTerm)) ||
                        (s.admissionNumber && s.admissionNumber.toLowerCase().includes(searchTerm)) ||
                        (s.rollNumber && s.rollNumber.toLowerCase().includes(searchTerm))
                    );
                }

                let head = `<thead><tr><th>Photo</th><th>Admission No.</th><th>Roll No.</th><th>Name</th><th>Course</th><th>Actions</th></tr></thead>`;
                let body = `<tbody>`;
                if (students.length === 0) {
                    body += `<tr><td colspan="6" style="text-align:center;">No students found.</td></tr>`;
                } else {
                    students.sort((a, b) => b.id - a.id).forEach(s => { 
                        body += `<tr>
                                <td><img src="${s.photo || `https://i.pravatar.cc/45?u=${s.id}`}" alt="Photo" class="table-photo"></td>
                                <td><strong>${s.admissionNumber || 'N/A'}</strong></td>
                                <td><strong>${s.rollNumber || 'N/A'}</strong></td>
                                <td>${s.name}</td><td>${s.className || ''}</td>
                                <td class="action-buttons">
                                <button class="view-btn" onclick="navigate('students', 'profile', '${s.id}')" title="View Profile"><i class="fas fa-eye"></i></button>
                                <button class="edit-btn" onclick="showStudentForm('${s.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="certificate-btn" onclick="showCertificateGenerationModal('${s.id}')" title="Generate Certificate"><i class="fas fa-certificate"></i></button>
                                <button class="delete-btn" onclick="deleteItem('students', '${s.id}', 'Are you sure you want to delete this student?', () => renderStudentTable(document.getElementById('student-search-input').value))" title="Delete"><i class="fas fa-trash"></i></button>
                                </td></tr>`; 
                    });
                }
                table.innerHTML = head + body + `</tbody>`;
            }

            function showStudentForm(id = null) {
                const student = id ? findById('students', id) : {};
                const title = id ? 'Edit Student' : 'Add New Student';
                const courseOptionsHTML = courseOptionsList
                    .map(c => `<option value="${c}" ${student.className === c ? 'selected' : ''}>${c}</option>`).join('');

                const formContent = `<form id="student-form"><input type="hidden" id="student-id" value="${student.id || ''}">
                        <div class="form-grid">
                            <div class="form-group"><label for="student-admission">Admission Number</label><input type="text" id="student-admission" value="${student.admissionNumber || ''}" ${id ? '' : 'placeholder="Will be auto-generated"'} ><small>${id ? 'You can change the admission number.' : 'Leave blank to auto-generate.'}</small></div>
                            <div class="form-group"><label for="student-roll">Roll Number</label><input type="text" id="student-roll" value="${student.rollNumber || ''}" ${id ? '' : 'placeholder="Will be auto-generated"'} ><small>${id ? 'You can change the roll number.' : 'Leave blank to auto-generate.'}</small></div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group"><label for="student-name">Full Name</label><input type="text" id="student-name" value="${student.name || ''}" required></div>
                            <div class="form-group"><label for="student-father-name">Father's Name</label><input type="text" id="student-father-name" value="${student.fatherName || ''}" required></div>
                             <div class="form-group"><label for="student-mother-name">Mother's Name</label><input type="text" id="student-mother-name" value="${student.motherName || ''}" required></div>
                            <div class="form-group"><label for="student-guardian-name">Guardian's Name</label><input type="text" id="student-guardian-name" value="${student.guardianName || ''}" required></div>
                             <div class="form-group"><label for="student-dob">Date of Birth</label><input type="text" placeholder="YYYY-MM-DD" id="student-dob" value="${student.dob || ''}" required></div>
                            <div class="form-group"><label for="student-email">Email</label><input type="email" id="student-email" value="${student.email || ''}"></div>
                            <div class="form-group"><label for="student-guardian-contact">Guardian's Contact</label><input type="tel" id="student-guardian-contact" value="${student.guardianContact || ''}" required></div>
                            <div class="form-group"><label for="student-contact">Student's Contact</label><input type="tel" id="student-contact" value="${student.contact || ''}"></div>
                            <div class="form-group"><label for="student-gender">Gender</label><select id="student-gender" required><option value="Male" ${student.gender === 'Male' ? 'selected' : ''}>Male</option><option value="Female" ${student.gender === 'Female' ? 'selected' : ''}>Female</option><option value="Other" ${student.gender === 'Other' ? 'selected' : ''}>Other</option></select></div>
                            <div class="form-group"><label for="student-category">Category</label><select id="student-category" required><option value="General" ${student.category === 'General' ? 'selected' : ''}>General</option><option value="OBC" ${student.category === 'OBC' ? 'selected' : ''}>OBC</option><option value="SC" ${student.category === 'SC' ? 'selected' : ''}>SC</option><option value="ST" ${student.category === 'ST' ? 'selected' : ''}>ST</option></select></div>
                        </div>
                        <div class="form-group"><label for="student-address">Address</label><textarea id="student-address" rows="3">${student.address || ''}</textarea></div>
                        <div class="form-group"><label for="student-pincode">Pin Code</label><input type="text" id="student-pincode" value="${student.pincode || '221011'}" required></div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="student-class">Course/Program</label>
                                <select id="student-class">${courseOptionsHTML}</select>
                            </div>
                        </div>
                        <div class="form-group"><label for="student-photo">Student Photo</label><input type="file" id="student-photo" accept="image/*"><input type="hidden" id="student-photo-base64" value="${student.photo || ''}"></div>
                        <button type="submit" class="action-button">${id ? 'Save Changes' : 'Add Student'}</button></form>`;
                showModal(title, formContent, '900px');
                getEl('student-photo').onchange = async (e) => { if (e.target.files[0]) getEl('student-photo-base64').value = await fileToBase64(e.target.files[0]); };
                getEl('student-form').onsubmit = (e) => { 
                    e.preventDefault();
                    let admissionNumber = getEl('student-admission').value.trim();
                    let rollNumber = getEl('student-roll').value.trim();
                    if (!getEl('student-id').value) {
                        if (!admissionNumber) admissionNumber = `MGKVP/24SMS-${Date.now().toString().slice(-6)}`;
                        if (!rollNumber) {
                             const nextRollNumber = (state.data.students || []).length + 1;
                             rollNumber = `SMS${new Date().getFullYear().toString().slice(-2)}${(nextRollNumber).toString().padStart(5, '0')}`;
                        }
                    }
                    const studentData = { ...student, id: getEl('student-id').value || Date.now().toString(), admissionNumber, rollNumber, name: getEl('student-name').value, fatherName: getEl('student-father-name').value, motherName: getEl('student-mother-name').value, guardianName: getEl('student-guardian-name').value, guardianContact: getEl('student-guardian-contact').value, dob: getEl('student-dob').value, gender: getEl('student-gender').value, category: getEl('student-category').value, email: getEl('student-email').value, contact: getEl('student-contact').value, address: getEl('student-address').value, pincode: getEl('student-pincode').value, photo: getEl('student-photo-base64').value, className: getEl('student-class').value, documents: student.documents || [], results: student.results || [], fingerprintData: student.fingerprintData || null, password: student.password || '' };
                    updateOrAddItem('students', studentData);
                    showToast(`Student ${id ? 'updated' : 'added'}!`, 'success');
                    closeModal(); 
                    if(state.currentView === 'profile') {
                        renderStudentProfilePage(studentData.id);
                    } else {
                        renderStudentListPage();
                    }
                };
            }

            function renderStudentProfilePage(id) {
                const student = findById('students', id);
                if (!student) {
                    showToast('Student not found.', 'error');
                    return navigate('students', 'list');
                }
                const studentTransactions = (state.data.transactions || []).filter(t => t.studentId === id);
                const paidFee = studentTransactions.reduce((sum, t) => sum + Number(t.amount), 0);
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Student Profile', `<button class="action-button inline" onclick="navigate('students', 'list')"><i class="fas fa-arrow-left"></i> Back to List</button>`);
                
                const signatureDoc = (student.documents || []).find(doc => doc.name && doc.name.toLowerCase().includes('signature'));
                const modalId = `student-profile-printable-${id}`;

                mainContent.innerHTML += `
                    <div class="page active">
                        <div class="profile-grid" id="${modalId}">
                            <div class="card profile-card">
                                <img class="profile-photo" src="${student.photo || `https://i.pravatar.cc/150?u=${id}`}" alt="Student Photo">
                                ${signatureDoc ? `<img src="${signatureDoc.data}" alt="Signature" style="display:block; margin: -10px auto 15px; height: 40px; max-width: 150px; object-fit: contain;">` : ''}
                                <h2 style="text-align: center;">${student.name}</h2>
                                <p style="text-align: center; color: var(--text-muted);">${student.email || 'No email'}</p>
                                <ul class="profile-details">
                                    <li><i class="fas fa-id-card"></i> Adm No: ${student.admissionNumber || 'N/A'}</li>
                                    <li><i class="fas fa-hashtag"></i> Roll No: ${student.rollNumber || 'N/A'}</li>
                                    <li><i class="fas fa-school"></i> ${student.className}</li>
                                     <li><i class="fas fa-user-tie"></i> Father: ${student.fatherName || 'N/A'}</li>
                                     <li><i class="fas fa-female"></i> Mother: ${student.motherName || 'N/A'}</li>
                                    <li><i class="fas fa-user-shield"></i> Guardian: ${student.guardianName || 'N/A'} (${student.guardianContact || 'N/A'})</li>
                                    <li><i class="fas fa-phone"></i> Student Contact: ${student.contact || 'N/A'}</li>
                                    <li><i class="fas fa-venus-mars"></i> Gender: ${student.gender || 'N/A'}</li>
                                    <li><i class="fas fa-layer-group"></i> Category: ${student.category || 'N/A'}</li>
                                    <li><i class="fas fa-map-marker-alt"></i> ${student.address || 'Not provided'}, ${student.pincode || ''}</li>
                                </ul>
                                <div style="text-align:center;">
                                    <div id="student-qr-code"></div>
                                </div>
                                <div class="no-print" style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top:20px;">
                                    <button onclick="showStudentForm('${id}')" class="action-button">Edit Profile</button>
                                    <button onclick="showIdCard('${id}')" class="action-button"><i class="fas fa-id-card"></i> ID Card</button>
                                    <button onclick="printContent('#${modalId}')" class="action-button"><i class="fas fa-print"></i> Print</button>
                                    <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Student-Profile-${student.name}.pdf')"><i class="fas fa-download"></i> Download</button>
                                </div>
                            </div>
                            <div>
                                <div class="card">
                                    <div class="card-header"><h3>Financial Summary</h3></div>
                                    <p>Total Paid: ₹${paidFee.toLocaleString()}</p>
                                    <button onclick="showPaymentForm('${id}')" class="action-button inline no-print" style="margin-top: 15px; margin-bottom: 20px;">Add Payment</button>
                                    <h3 style="margin-top:20px;">Payment History</h3>
                                    <ul class="detail-list">
                                        ${studentTransactions.length ? studentTransactions.sort((a,b) => new Date(b.date) - new Date(a.date)).map(t => `<li><span>${new Date(t.date).toLocaleDateString()} - ${t.type}</span><div style="display:flex; align-items:center; gap: 10px;"><span>₹${Number(t.amount).toLocaleString()}</span><button class="action-button no-print secondary" onclick="showFeeReceipt('${student.id}', '${t.id}')" style="padding: 5px 10px;" title="Print Receipt"><i class="fas fa-print"></i></button></div></li>`).join('') : '<li>No payments made.</li>'}
                                    </ul>
                                </div>
                                <div class="card"><div class="card-header"><h3>Attendance History</h3></div><div id="attendance-history-container" style="max-height: 300px; overflow-y: auto;"></div></div>
                                <div class="card"><div class="card-header"><h3>Student Documents</h3><button class="action-button inline no-print" onclick="showDocumentUploadForm('${id}')"><i class="fas fa-upload"></i> Upload</button></div><ul class="detail-list">${renderDocumentList(student)}</ul></div>
                            </div>
                        </div>
                    </div>`;
                
                if (student.admissionNumber) {
                    const qrContainer = getEl('student-qr-code');
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, { text: student.admissionNumber, width: 128, height: 128 });
                }
                renderAttendanceHistory('students', id);
            }

            function renderStudentProfileView() {
                const user = state.loggedInUser;
                const student = user.role === 'parent' ? findById('students', user.studentId) : user;

                if (!student) {
                    mainContent.innerHTML = renderHeader(`Error`);
                    mainContent.innerHTML += `<div class="page active"><p class="form-feedback error">Could not find linked student data.</p></div>`;
                    return;
                }

                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('My Profile');
                mainContent.innerHTML += `<div class="page active">
                    <div class="card profile-card" style="max-width: 500px; margin: auto;">
                        <img class="profile-photo" src="${student.photo || `https://i.pravatar.cc/150?u=${student.id}`}" alt="Student Photo">
                        <h2 style="text-align: center;">${student.name}</h2>
                         <ul class="profile-details">
                            <li><i class="fas fa-id-card"></i> Adm No: ${student.admissionNumber || 'N/A'}</li>
                            <li><i class="fas fa-hashtag"></i> Roll No: ${student.rollNumber || 'N/A'}</li>
                            <li><i class="fas fa-school"></i> ${student.className}</li>
                             <li><i class="fas fa-user-tie"></i> Father: ${student.fatherName || 'N/A'}</li>
                             <li><i class="fas fa-female"></i> Mother: ${student.motherName || 'N/A'}</li>
                            <li><i class="fas fa-user-shield"></i> Guardian: ${student.guardianName || 'N/A'}</li>
                            <li><i class="fas fa-mobile-alt"></i> Guardian Contact: ${student.guardianContact || 'N/A'}</li>
                            <li><i class="fas fa-phone"></i> Student Contact: ${student.contact || 'N/A'}</li>
                            <li><i class="fas fa-envelope"></i> ${student.email || 'N/A'}</li>
                            <li><i class="fas fa-map-marker-alt"></i> ${student.address || 'Not provided'}, ${student.pincode || ''}</li>
                        </ul>
                    </div>
                </div>`;
            }

            function renderStudentAttendanceView() {
                const user = state.loggedInUser;
                const student = user.role === 'parent' ? findById('students', user.studentId) : user;
                if (!student) return;

                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('My Attendance');
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="card-header"><h3>My Monthly Attendance Report</h3></div>
                    <div id="student-attendance-report-container"></div>
                </div></div>`;
                renderStudentMonthlyAttendanceReport(student.id);
            }
                function renderStudentMonthlyAttendanceReport(studentId) {
                const container = getEl('student-attendance-report-container');
                if(!container) return;
                const now = new Date();
                const currentYear = now.getFullYear();
                const modalId = `student-attendance-printable-${studentId}`;

                const yearOptions = Array.from({ length: 5 }, (_, i) => currentYear - i)
                    .map(y => `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`).join('');
                
                const monthOptions = Array.from({ length: 12 }, (_, i) => {
                    const monthName = new Date(0, i).toLocaleString('en-US', { month: 'long' });
                    return `<option value="${i}" ${i === now.getMonth() ? 'selected' : ''}>${monthName}</option>`;
                }).join('');

                container.innerHTML = `
                    <div class="no-print" style="display:flex; flex-wrap: wrap; gap: 20px; align-items: flex-end; margin-bottom: 20px;">
                        <div class="form-group" style="margin-bottom: 0; flex-grow: 1;">
                            <label for="student-report-month-filter">Select Month</label>
                            <select id="student-report-month-filter" onchange="displayMonthlyAttendanceReport('students', '${studentId}', true)">${monthOptions}</select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0; flex-grow: 1;">
                            <label for="student-report-year-filter">Select Year</label>
                            <select id="student-report-year-filter" onchange="displayMonthlyAttendanceReport('students', '${studentId}', true)">${yearOptions}</select>
                        </div>
                        <button class="action-button inline" onclick="printContent('#${modalId}')" style="flex-shrink: 0;"><i class="fas fa-print"></i> Print Report</button>
                         <button class="action-button secondary inline" onclick="downloadAsPdf('#${modalId}', 'Attendance-Report.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                    <div id="${modalId}"></div>
                `;
                displayMonthlyAttendanceReport('students', studentId, true);
            }

            function renderAttendanceHistory(type, memberId) {
                const container = getEl('attendance-history-container');
                if (!container) return;

                let attendanceRecords;
                if (type === 'students') attendanceRecords = state.data.studentAttendance || {};
                else if (type === 'teachers') attendanceRecords = state.data.teacherAttendance || {};
                else if (type === 'staff') attendanceRecords = state.data.staffAttendance || {};
                else return;

                let history = [];
                for (const date in attendanceRecords) {
                    if (attendanceRecords[date][memberId]) {
                        history.push({ date: date, status: attendanceRecords[date][memberId] });
                    }
                }
                history.sort((a, b) => new Date(b.date) - new Date(a.date));
                if (history.length === 0) {
                    container.innerHTML = `<p>No attendance records found.</p>`;
                    return;
                }
                let tableHtml = `<table class="table-container"><thead><tr><th>Date</th><th>Status</th></tr></thead><tbody>`;
                history.forEach(rec => {
                    const statusClass = rec.status === 'present' ? 'color: var(--success-color)' : 'color: var(--error-color)';
                    tableHtml += `<tr><td>${new Date(rec.date).toLocaleDateString()}</td><td style="${statusClass}; font-weight: bold;">${rec.status.charAt(0).toUpperCase() + rec.status.slice(1)}</td></tr>`;
                });
                tableHtml += `</tbody></table>`;
                container.innerHTML = tableHtml;
            }
            
            function showIdCard(studentId) {
                const schoolInfo = state.data.siteContent;
                const student = findById('students', studentId);
                if (!student) return;

                const modalId = `student-id-${studentId}`;
                const modalContent = `
                    <div class="printable-area" id="${modalId}">
                        <div class="id-card">
                            <div class="id-card-header">
                                <h3 style="text-transform: uppercase;">${schoolInfo.schoolName}</h3>
                            </div>
                            <div class="id-card-body">
                                <img src="${student.photo || `https://i.pravatar.cc/100?u=${studentId}`}" alt="Photo" class="id-card-photo">
                                <h4>${student.name}</h4>
                                <p><strong>Admission No:</strong> ${student.admissionNumber || 'N/A'}</p>
                                <p><strong>Roll No:</strong> ${student.rollNumber || 'N/A'}</p>
                                <p><strong>Course:</strong> ${student.className || 'N/A'}</p>
                                <div class="id-card-qr" id="id-card-qr-code"></div>
                            </div>
                        </div>
                    </div>
                     <div class="no-print" style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="action-button" onclick="printContent('#${modalId}')"><i class="fas fa-print"></i> Print ID Card</button>
                        <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Student-ID-${student.name}.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                `;
                showModal('Student ID Card', modalContent, '400px');
                if (student.admissionNumber) {
                     setTimeout(() => {
                        const qrContainer = getEl('id-card-qr-code');
                        if(qrContainer){
                           qrContainer.innerHTML = '';
                           new QRCode(qrContainer, { text: student.admissionNumber, width: 120, height: 120, colorDark : "#000000", colorLight : "#ffffff" });
                           convertQrCanvasToImage(qrContainer);
                        }
                    }, 200);
                }
            }


            function renderDocumentList(student) {
                if (!student.documents || student.documents.length === 0) return '<li>No documents uploaded.</li>';
                return student.documents.map((doc, index) => `<li><span><i class="fas fa-file-alt" style="margin-right: 10px;"></i> ${doc.name}</span>
                        <div class="action-buttons no-print"><a href="${doc.data}" download="${doc.filename}" class="view-btn" title="View/Download"><i class="fas fa-download"></i></a>
                        <button class="delete-btn" onclick="deleteDocument('${student.id}', ${index})" title="Delete"><i class="fas fa-trash"></i></button></div></li>`).join('');
            }

            function showDocumentUploadForm(studentId) {
                const title = "Upload Document";
                const formContent = `<form id="document-upload-form"><div class="form-group"><label for="doc-name">Document Name</label><input type="text" id="doc-name" required></div>
                        <div class="form-group"><label for="doc-file">Select File</label><input type="file" id="doc-file" required></div>
                        <button type="submit" class="action-button">Upload Document</button></form>`;
                showModal(title, formContent);
                getEl('document-upload-form').onsubmit = async (e) => { e.preventDefault(); const student = findById('students', studentId); const file = getEl('doc-file').files[0]; const name = getEl('doc-name').value;
                    if (file && name && student) { try { const base64Data = await fileToBase64(file); if (!student.documents) student.documents = []; student.documents.push({ name, data: base64Data, filename: file.name }); updateOrAddItem('students', student); showToast("Document uploaded successfully!", "success"); closeModal(); renderStudentProfilePage(studentId); } catch (err) { showToast("File upload failed.", "error"); } } };
            }

            function deleteDocument(studentId, docIndex) { if (confirm('Are you sure you want to delete this document?')) { const student = findById('students', studentId); if (student && student.documents) { student.documents.splice(docIndex, 1); updateOrAddItem('students', student); showToast("Document deleted.", "success"); renderStudentProfilePage(studentId); } } }
            
            function renderTimetablePage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showTimetableForm()"><i class="fas fa-plus"></i> Add Timetable</button>`;
                mainContent.innerHTML = renderHeader('Course Timetables', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="gallery-grid" id="timetable-grid-container"></div></div></div>`;
                renderTimetableGrid();
            }

            function renderTimetableGrid() {
                const container = getEl('timetable-grid-container');
                if(!container) return;
                const { timetables } = state.data;
                if (!timetables || timetables.length === 0) { container.innerHTML = `<p>No timetables uploaded yet.</p>`; return; }
                container.innerHTML = timetables.sort((a,b) => b.id - a.id).map(item => `<div class="gallery-item card"><h4>${item.title}</h4><img src="${item.image}" alt="${item.title}" style="margin-top:15px;"><div class="gallery-item-footer"><button class="delete-btn" onclick="deleteItem('timetables', '${item.id}', 'Are you sure you want to delete this timetable?', renderTimetableGrid)" title="Delete"><i class="fas fa-trash"></i></button></div></div>`).join('');
            }
            function showTimetableForm() {
                const title = 'Add New Timetable';
                const formContent = `<form id="timetable-form">
                        <div class="form-group"><label for="timetable-title">Title</label><input type="text" id="timetable-title" placeholder="e.g., BCA Sem 2 Timetable" required></div>
                        <div class="form-group"><label for="timetable-image">Select Image</label><input type="file" id="timetable-image" accept="image/*" required></div>
                        <button type="submit" class="action-button">Add Timetable</button>
                    </form>`;
                showModal(title, formContent);
                getEl('timetable-form').onsubmit = async e => { 
                    e.preventDefault(); 
                    const imageFile = getEl('timetable-image').files[0]; 
                    if(!imageFile) return; 
                    const timetableData = { id: Date.now(), title: getEl('timetable-title').value, image: await fileToBase64(imageFile) }; 
                    updateOrAddItem('timetables', timetableData); 
                    showToast('Timetable added!', 'success'); 
                    closeModal(); 
                    renderTimetableGrid(); 
                };
            }

            function renderExamsPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Examinations', `<button class="action-button inline" onclick="showExamMasterForm()"><i class="fas fa-plus"></i> Add New Exam</button>`);
                
                mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="card-header"><h3>Examinations</h3><p>Create main exams like Odd Semester or Sessional Test.</p></div>
                        <div class="table-container"><table id="exam-masters-table"></table></div>
                    </div>
                    <div id="exam-schedule-section" style="display:none;"></div>
                </div>`;
                renderExamMastersTable();
            }

            function renderExamMastersTable() {
                const table = getEl('exam-masters-table');
                if (!table) return;
                const { examMasters } = state.data;
                let html = `<thead><tr><th>Exam Name</th><th>Category</th><th>Result Declared On</th><th>Actions</th></tr></thead><tbody>`;
                if (!examMasters || examMasters.length === 0) {
                    html += `<tr><td colspan="4" style="text-align:center;">No exams created yet. Click 'Add New Exam'.</td></tr>`;
                } else {
                    examMasters.sort((a,b) => b.id - a.id).forEach(ex => { 
                        html += `<tr>
                            <td><strong>${ex.name}</strong></td>
                            <td>${ex.category || 'N/A'}</td>
                            <td>${ex.declarationDate ? new Date(ex.declarationDate).toLocaleDateString() : 'Not Set'}</td>
                            <td class="action-buttons">
                                <button class="schedule-btn" onclick="renderExamScheduleView('${ex.id}')" title="Manage Schedule"><i class="fas fa-calendar-alt"></i></button>
                                <button class="edit-btn" onclick="showExamMasterForm('${ex.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="delete-btn" onclick="deleteExamMaster('${ex.id}')" title="Delete"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`; 
                    });
                }
                html += '</tbody>';
                table.innerHTML = html;
            }

            function showExamMasterForm(id = null) {
                const exam = id ? findById('examMasters', id) : {};
                const title = id ? 'Edit Exam' : 'Create New Exam';

                const examCategoryOptions = examCategoriesList.map(cat => 
                    `<option value="${cat}" ${exam.category === cat ? 'selected' : ''}>${cat}</option>`
                ).join('');

                const formContent = `<form id="exam-master-form">
                    <input type="hidden" id="exam-master-id" value="${exam.id || ''}">
                    <div class="form-group"><label for="exam-master-name">Exam Name</label><input type="text" id="exam-master-name" value="${exam.name || ''}" placeholder="e.g., Odd Semester 2025" required></div>
                    <div class="form-group">
                        <label for="exam-master-category">Exam Category</label>
                        <select id="exam-master-category">${examCategoryOptions}</select>
                    </div>
                    <div class="form-group"><label for="exam-declaration-date">Result Declaration Date</label><input type="date" id="exam-declaration-date" value="${exam.declarationDate || ''}"></div>
                    <h4 style="margin-top: 20px; color: var(--primary-light);">Grade Sheet Details</h4>
                    <div class="form-group">
                        <label for="exam-session">Session</label>
                        <input type="text" id="exam-session" value="${exam.session || '2024-2025'}" required>
                    </div>
                    <div class="form-group">
                        <label for="exam-title">Examination Title (for Grade Sheet)</label>
                        <input type="text" id="exam-title" value="${exam.examTitle || 'First Semester Examination'}" required>
                    </div>
                    <div class="form-group">
                        <label for="exam-course-desc">Course Description (for Grade Sheet)</label>
                        <input type="text" id="exam-course-desc" value="${exam.courseDesc || 'Three Year Full Time Bachelor of Computer Application'}" required>
                    </div>
                    <button type="submit" class="action-button">${id ? 'Save Changes' : 'Create Exam'}</button>
                </form>`;
                showModal(title, formContent);
                getEl('exam-master-form').onsubmit = e => { 
                    e.preventDefault(); 
                    const examData = { 
                        id: getEl('exam-master-id').value || Date.now().toString(), 
                        name: getEl('exam-master-name').value.trim(),
                        category: getEl('exam-master-category').value,
                        declarationDate: getEl('exam-declaration-date').value,
                        session: getEl('exam-session').value,
                        examTitle: getEl('exam-title').value,
                        courseDesc: getEl('exam-course-desc').value
                    }; 
                    if (!examData.name) {
                        showToast("Exam name cannot be empty.", "error");
                        return;
                    }
                    updateOrAddItem('examMasters', examData); 
                    showToast(`Exam ${id ? 'updated' : 'added'}!`, 'success'); 
                    closeModal(); 
                    renderExamMastersTable(); 
                };
            }
            
           
            function renderExamScheduleView(examMasterId) {
                const exam = findById('examMasters', examMasterId);
                const scheduleSection = getEl('exam-schedule-section');
                scheduleSection.style.display = 'block';
                scheduleSection.innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <h3>Schedule for: ${exam.name}</h3>
                            <button class="action-button inline" onclick="showExamScheduleForm('${examMasterId}')"><i class="fas fa-plus"></i> Add Subject to Schedule</button>
                        </div>
                        <div class="table-container"><table id="exam-schedule-table"></table></div>
                    </div>
                `;
                renderExamScheduleTable(examMasterId);
                scheduleSection.scrollIntoView({ behavior: 'smooth' });
            }

            function renderExamScheduleTable(examMasterId) {
                const table = getEl('exam-schedule-table');
                if(!table) return;
                const schedules = state.data.examSchedules.filter(s => s.examMasterId === examMasterId);
                
                let html = `<thead><tr><th>Course</th><th>Subject</th><th>Paper Code</th><th>Credits</th><th>Exam Date</th><th>Start Time</th><th>End Time</th><th>Actions</th></tr></thead><tbody>`;
                 if (schedules.length === 0) {
                    html += `<tr><td colspan="8" style="text-align:center;">No schedule added for this exam yet.</td></tr>`;
                } else {
                    schedules.sort((a,b) => new Date(a.date) - new Date(b.date)).forEach(sch => {
                        html += `<tr>
                            <td>${sch.className}</td>
                            <td>${sch.subject}</td>
                            <td>${sch.paperCode || '-'}</td>
                            <td>${sch.credits || '-'}</td>
                            <td>${new Date(sch.date).toLocaleDateString()}</td>
                            <td>${sch.startTime}</td>
                            <td>${sch.endTime}</td>
                            <td class="action-buttons">
                                <button class="edit-btn" onclick="showExamScheduleForm('${examMasterId}', '${sch.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="delete-btn" onclick="deleteItem('examSchedules', '${sch.id}', 'Delete this schedule item?', () => renderExamScheduleTable('${examMasterId}'))" title="Delete"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`;
                    });
                }
                html += '</tbody>';
                table.innerHTML = html;
            }

            function showExamScheduleForm(examMasterId, scheduleId = null) {
                const schedule = scheduleId ? findById('examSchedules', scheduleId) : {};
                const title = scheduleId ? 'Edit Exam Schedule' : 'Add to Exam Schedule';
                
                const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}" ${schedule.className === c ? 'selected' : ''}>${c}</option>`).join('');

                const formContent = `<form id="exam-schedule-form">
                    <input type="hidden" id="exam-schedule-id" value="${schedule.id || ''}">
                    <div class="form-group"><label for="exam-schedule-class">Course</label><select id="exam-schedule-class">${courseOptionsHTML}</select></div>
                    <div class="form-grid">
                        <div class="form-group"><label for="exam-schedule-subject">Subject</label><input type="text" id="exam-schedule-subject" value="${schedule.subject || ''}" required></div>
                        <div class="form-group"><label for="exam-schedule-code">Paper Code</label><input type="text" id="exam-schedule-code" value="${schedule.paperCode || ''}" placeholder="e.g., BCA-22-201"></div>
                    </div>
                    <div class="form-group"><label for="exam-schedule-credits">Credits</label><input type="number" id="exam-schedule-credits" value="${schedule.credits || '4'}" required></div>
                    <div class="form-group"><label for="exam-schedule-date">Exam Date</label><input type="date" id="exam-schedule-date" value="${schedule.date || new Date().toISOString().slice(0,10)}" required></div>
                    <div class="form-grid">
                        <div class="form-group"><label for="exam-schedule-start">Start Time</label><input type="time" id="exam-schedule-start" value="${schedule.startTime || '09:00'}" required></div>
                        <div class="form-group"><label for="exam-schedule-end">End Time</label><input type="time" id="exam-schedule-end" value="${schedule.endTime || '12:00'}" required></div>
                    </div>
                    <button type="submit" class="action-button">${scheduleId ? 'Save Changes' : 'Add to Schedule'}</button>
                </form>`;
                showModal(title, formContent, '700px');
                getEl('exam-schedule-form').onsubmit = e => {
                    e.preventDefault();
                    const scheduleData = {
                        id: getEl('exam-schedule-id').value || Date.now().toString(),
                        examMasterId: examMasterId,
                        className: getEl('exam-schedule-class').value,
                        subject: getEl('exam-schedule-subject').value,
                        paperCode: getEl('exam-schedule-code').value.trim(),
                        credits: parseInt(getEl('exam-schedule-credits').value),
                        date: getEl('exam-schedule-date').value,
                        startTime: getEl('exam-schedule-start').value,
                        endTime: getEl('exam-schedule-end').value,
                    };
                    updateOrAddItem('examSchedules', scheduleData);
                    showToast('Schedule saved!', 'success');
                    closeModal();
                    renderExamScheduleTable(examMasterId);
                }
            }
            
            function deleteExamMaster(id) {
                if (confirm('DANGER! Deleting this exam will also delete all its schedules and any marks entered for it. This cannot be undone. Are you sure?')) {
                    state.data.examSchedules = (state.data.examSchedules || []).filter(sch => sch.examMasterId !== id);
                    if(state.data.marks[id]) {
                        delete state.data.marks[id];
                    }
                    state.data.examMasters = (state.data.examMasters || []).filter(ex => ex.id !== id);
                    saveData();
                    showToast('Exam and all related data deleted.', 'success');
                    renderExamsPage();
                }
            }


            function renderFinancialsPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Income / All Transactions');
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="card-header"><h3>All Transactions</h3></div><div class="table-container"><table id="transactions-table"></table></div></div></div>`;
                renderTransactionsTable();
            }

            function renderTransactionsTable() {
                const table = getEl('transactions-table');
                if (!table) return;
                const transactions = (state.data.transactions || []).sort((a, b) => new Date(b.date) - new Date(a.date));
                let html = `<thead><tr><th>Student Name</th><th>Type</th><th>Amount (₹)</th><th>Date</th><th>Actions</th></tr></thead><tbody>`;
                if (transactions.length === 0) html += `<tr><td colspan="5" style="text-align:center;">No transactions found.</td></tr>`;
                else transactions.forEach(t => { const student = findById('students', t.studentId); html += `<tr><td>${student ? `<a href="#" onclick="event.preventDefault(); navigate('students', 'profile', '${student.id}')">${student.name}</a>` : 'Unknown Student'}</td><td>${t.type || 'Fee'}</td><td>${Number(t.amount).toLocaleString()}</td><td>${new Date(t.date).toLocaleDateString()}</td><td class="action-buttons"><button class="view-btn" onclick="showFeeReceipt('${t.studentId}', '${t.id}')" title="Print Receipt"><i class="fas fa-print"></i></button><button class="delete-btn" onclick="deleteItem('transactions', '${t.id}', 'Are you sure you want to delete this transaction?', renderTransactionsTable)" title="Delete"><i class="fas fa-trash"></i></button></td></tr>`; });
                table.innerHTML = html + `</tbody>`;
            }

            function showPaymentForm(studentId) {
                const student = findById('students', studentId);
                const title = `Add Payment for ${student.name}`;
                const formContent = `<form id="payment-form"><input type="hidden" id="payment-student-id" value="${studentId}">
                        <div class="form-group"><label for="payment-type">Payment Type</label><input type="text" id="payment-type" value="Semester Fee" required></div>
                        <div class="form-group"><label for="payment-amount">Amount (₹)</label><input type="number" id="payment-amount" value="300" required></div>
                        <div class="form-group"><label for="payment-date">Date</label><input type="date" id="payment-date" value="${new Date().toISOString().slice(0,10)}" required></div><button type="submit" class="action-button">Record Payment</button></form>`;
                showModal(title, formContent);
                getEl('payment-form').onsubmit = e => { e.preventDefault(); const transaction = { id: Date.now().toString(), studentId: getEl('payment-student-id').value, amount: getEl('payment-amount').value, date: getEl('payment-date').value, type: getEl('payment-type').value }; updateOrAddItem('transactions', transaction); showToast("Payment recorded!", "success"); closeModal(); if(state.currentPage === 'students' && state.currentView === 'profile') { renderStudentProfilePage(studentId); } };
            }

            function renderExpensesPage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showExpenseForm()"><i class="fas fa-plus"></i> Add Expense</button>`;
                mainContent.innerHTML = renderHeader('Expenses', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="table-container"><table id="expenses-table"></table></div></div></div>`;
                renderExpensesTable();
            }

            function renderExpensesTable() {
                const table = getEl('expenses-table');
                if (!table) return;
                const expenses = (state.data.expenses || []).sort((a,b) => new Date(b.date) - new Date(a.date));
                let html = `<thead><tr><th>
            Title</th><th>Amount (₹)</th><th>Category</th><th>Date</th><th>Actions</th></tr></thead><tbody>`;
                if (expenses.length === 0) html += `<tr><td colspan="5" style="text-align:center;">No expenses found.</td></tr>`;
                else expenses.forEach(e => { html += `<tr><td>${e.title}</td><td>${Number(e.amount).toLocaleString()}</td><td>${e.category}</td><td>${new Date(e.date).toLocaleDateString()}</td><td class="action-buttons"><button class="edit-btn" onclick="showExpenseForm('${e.id}')" title="Edit"><i class="fas fa-edit"></i></button><button class="delete-btn" onclick="deleteItem('expenses', '${e.id}', 'Are you sure you want to delete this expense?', renderExpensesTable)" title="Delete"><i class="fas fa-trash"></i></button></td></tr>`; });
                table.innerHTML = html + `</tbody>`;
            }

            function showExpenseForm(id = null) {
                const expense = id ? findById('expenses', id) : {};
                const title = id ? 'Edit Expense' : 'Add New Expense';
                const formContent = `<form id="expense-form"><input type="hidden" id="expense-id" value="${expense.id || ''}">
                        <div class="form-group"><label for="expense-title">Title (e.g., Electricity Bill)</label><input type="text" id="expense-title" value="${expense.title || ''}" required></div>
                        <div class="form-group"><label for="expense-amount">Amount (₹)</label><input type="number" id="expense-amount" value="${expense.amount || ''}" required></div>
                        <div class="form-group"><label for="expense-category">Category</label><input type="text" id="expense-category" value="${expense.category || ''}" placeholder="e.g., Utilities, Rent, Supplies" required></div>
                        <div class="form-group"><label for="expense-date">Date</label><input type="date" id="expense-date" value="${expense.date || new Date().toISOString().slice(0,10)}" required></div>
                        <button type="submit" class="action-button">${id ? 'Save Changes' : 'Add Expense'}</button></form>`;
                showModal(title, formContent);
                getEl('expense-form').onsubmit = e => { e.preventDefault(); const expenseData = { id: getEl('expense-id').value || Date.now().toString(), title: getEl('expense-title').value, amount: getEl('expense-amount').value, category: getEl('expense-category').value, date: getEl('expense-date').value, }; updateOrAddItem('expenses', expenseData); showToast(`Expense ${id ? 'updated' : 'added'}!`, 'success'); closeModal(); renderExpensesPage(); };
            }
            
            function renderResultPortalPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Result Portal');

                mainContent.innerHTML += `<div class="page active"><div class="card">
                        <div class="card-header"><h3>Find Your Grade Sheet</h3></div>
                        <p>Enter your Roll Number and Date of Birth (or Password) to view your grade sheet.</p>
                        <form id="find-result-form" style="margin-top:20px;">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="result-roll-number">Roll Number</label>
                                    <input type="text" id="result-roll-number" placeholder="Enter Roll Number" required>
                                </div>
                                <div class="form-group">
                                    <label for="result-dob">Date of Birth</label>
                                    <input type="text" id="result-dob" placeholder="YYYY-MM-DD">
                                </div>
                            </div>
                             <p style="text-align:center; margin-bottom: 15px;">OR</p>
                             <div class="form-group">
                                <label for="result-password">Password</label>
                                <input type="password" id="result-password" placeholder="Enter Password">
                            </div>
                            <button type="submit" class="action-button inline">Find Result</button>
                        </form>
                        <div id="result-display-area" style="margin-top:30px;"></div>
                    </div></div>`;

                getEl('find-result-form').onsubmit = (e) => { 
                    e.preventDefault(); 
                    handleFindResult();
                };
            }
            
            function handleFindResult() {
                const rollNumber = getEl('result-roll-number').value.trim().toLowerCase();
                const dob = getEl('result-dob').value;
                const password = getEl('result-password').value;
                const resultArea = getEl('result-display-area');
                resultArea.innerHTML = '';

                if (!rollNumber || (!dob && !password)) {
                    resultArea.innerHTML = `<p class="form-feedback error">Please enter a roll number and either a date of birth or a password.</p>`;
                    return;
                }

                const student = (state.data.students || []).find(s => {
                    if (s.rollNumber && s.rollNumber.toLowerCase() === rollNumber) {
                        if (dob && s.dob === dob) return true;
                        if (password && s.password && btoa(password) === s.password) return true;
                    }
                    return false;
                });
                
                if (!student) {
                    resultArea.innerHTML = `<p class="form-feedback error">No student found with these details. Please check your credentials.</p>`;
                    return;
                }
                
                showResultDetailsForm(student.id);
            }
            
            function showResultDetailsForm(studentId) {
                const resultArea = getEl('result-display-area');
                const student = findById('students', studentId);
                 const examOptions = (state.data.examMasters || [])
                    .filter(em => em.declarationDate && new Date(em.declarationDate) <= new Date() && state.data.marks[em.id] && state.data.marks[em.id][student.id])
                    .sort((a,b) => b.id - a.id)
                    .map(ex => `<option value="${ex.id}">${ex.name}</option>`).join('');

                if (!examOptions) {
                    resultArea.innerHTML = `<p class="form-feedback error" style="display:block;">Result for this student has not been declared for any exam yet.</p>`;
                    return;
                }
                
                resultArea.innerHTML = `
                    <div class="card">
                        <h4>Select Exam to View Grade Sheet</h4>
                        <form id="result-details-form">
                            <div class="form-group">
                                <label for="result-exam-select">Select Exam</label>
                                <select id="result-exam-select" required>
                                    <option value="">Select Exam</option>
                                    ${examOptions}
                                </select>
                            </div>
                            <button type="submit" class="action-button">Generate Grade Sheet</button>
                        </form>
                    </div>
                    <div id="marksheet-display-container"></div>
                `;
                
                getEl('result-details-form').onsubmit = (e) => {
                    e.preventDefault();
                    const examMasterId = getEl('result-exam-select').value;
                    const container = getEl('marksheet-display-container');
                    if(examMasterId) {
                        showMarksheet(studentId, examMasterId, container);
                    } else {
                        container.innerHTML = '';
                    }
                };
            }
            
            function showMarksheet(studentId, examMasterId, container) {
                const schoolInfo = state.data.siteContent;
                const student = findById('students', studentId);
                const examMaster = findById('examMasters', examMasterId);
                const marksData = (state.data.marks[examMasterId] || {})[student.id] || [];
                
                const coCurricularData = (state.data.coCurricular || []).find(cc => cc.studentId === studentId && cc.examMasterId === examMasterId);
                
                if (marksData.length === 0) {
                    container.innerHTML = `<p class="form-feedback error">Grade Sheet not available for the selected exam.</p>`;
                    return;
                }

                const gradePointMapNew = { 'O': 10, 'A+': 9, 'A': 8, 'B+': 7, 'B': 6, 'C': 5, 'P': 4, 'F': 0, 'Ab': 0 };

                let totalCredits = 0;
                let totalGradePoints = 0;
                let resultStatus = "PASS";

                const markRows = marksData.map(m => {
                    const gradePoint = gradePointMapNew[m.grade] || 0;
                    const creditValue = parseInt(m.credits || 0);
                    const totalPoints = gradePoint * creditValue;
                    
                    if(m.grade === 'F' || m.grade === 'Ab') resultStatus = "FAIL";

                    totalCredits += creditValue;
                    totalGradePoints += totalPoints;

                    return `<tr>
                        <td>${m.paperCode}</td>
                        <td>${m.subject}</td>
                        <td>${m.grade}</td>
                        <td>${creditValue}</td>
                        <td>${totalPoints}</td>
                    </tr>`;
                }).join('');
                
                const coCurricularRow = coCurricularData ? `
                    <tr>
                        <td>${coCurricularData.paperCode || 'CC-2'}</td>
                        <td>${coCurricularData.subject}</td>
                        <td>${coCurricularData.grade}</td>
                        <td>2</td>
                        <td>Pass</td>
                    </tr>
                ` : '';

                const sgpa = totalCredits > 0 ? (totalGradePoints / totalCredits).toFixed(2) : "0.00";
                const serialNumber = `0000017571`;
                const modalId = `gradesheet-${student.id}-${examMasterId}`;
                const admissionYear = student.admissionNumber ? student.admissionNumber.substring(6, 8) : new Date().getFullYear().toString().slice(-2);
                const batch = `20${admissionYear}-20${parseInt(admissionYear) + 3}`;
                
                const gradeSheetHtml = `
                    <div class="printable-area" id="${modalId}">
                        <div class="grade-sheet-container">
                            <div class="grade-sheet-header">
                                <img src="https://smsvaranasi.com/img/logo.png" alt="Logo" class="logo">
                                <h1>${schoolInfo.schoolName}</h1>
                                <p>(An Autonomous College)</p>
                                <p>Affiliated To Mahatma Gandhi Kashi Vidyapith, Varanasi</p>
                                <h2>Three Year (Full-Time)</h2>
                                <p>Bachelor of Computer Applications</p>
                                <p>${examMaster.examTitle || 'SECOND SEMESTER EXAMINATION'}</p>
                                <p>SESSION: ${examMaster.session || '2024-2025'}</p>
                                <h4>GRADE SHEET</h4>
                            </div>
                            
                            <div class="grade-sheet-details-container">
                                <table class="grade-sheet-student-details">
                                    <tr>
                                        <td><strong>Roll No.:</strong> ${student.rollNumber}</td>
                                        <td><strong>Enrollment No.:</strong> ${student.admissionNumber}</td>
                                    </tr>
                                    <tr>
                                        <td colspan="2"><strong>Name:</strong> ${student.name}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Father's Name:</strong> ${student.fatherName}</td>
                                        <td><strong>Mother's Name:</strong> ${student.motherName}</td>
                                    </tr>
                                     <tr>
                                        <td><strong>Batch:</strong> ${batch}</td>
                                        <td><strong>Sr. No.:</strong> ${serialNumber}</td>
                                    </tr>
                                </table>
                                <div class="grade-sheet-photo-qr-container">
                                    <div class="grade-sheet-student-photo-container">
                                        <img src="${student.photo || `https://i.pravatar.cc/120?u=${student.id}`}" alt="Student Photo">
                                    </div>
                                    <div id="grade-sheet-qr" class="qr-code"></div>
                                </div>
                            </div>
                            
                             <table class="grade-sheet-marks-table">
                                <thead>
                                    <tr>
                                        <th>Paper No.</th>
                                        <th>Subjects</th>
                                        <th>Grade</th>
                                        <th>Credits</th>
                                        <th>Total Grade Points</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${markRows}
                                    <tr class="total-row">
                                        <td colspan="3" style="text-align:right;">TOTAL</td>
                                        <td>${totalCredits}</td>
                                        <td>${totalGradePoints}</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div class="grade-sheet-summary">
                                S.G.P.A. Second Semester : ${sgpa}
                            </div>

                             ${coCurricularData ? `
                            <div class="grade-sheet-co-curricular-section">
                                <h5>Co-Curricular Course</h5>
                                <table class="grade-sheet-co-curricular-table">
                                    <thead>
                                        <tr>
                                            <th>Paper No.</th>
                                            <th>Subjects</th>
                                            <th>Grade</th>
                                            <th>Credits</th>
                                            <th>Result</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${coCurricularRow}
                                    </tbody>
                                </table>
                            </div>
                            ` : ''}
                            
                            <div class="grade-sheet-footer-container">
                                <div class="result-line">
                                    <p><strong>Result: ${resultStatus}</strong></p>
                                    <p><strong>Dated: ${examMaster.declarationDate ? new Date(examMaster.declarationDate).toLocaleDateString('en-GB').replace(/\//g, '-') : 'N/A'}</strong></p>
                                </div>
                                <div class="signatures" style="margin-top: 50px;">
                                    <div class="sig-block">Prepared By</div>
                                    <div class="sig-block">Checked by</div>
                                    <div class="sig-block">Controller of Examinations</div>
                                    <div class="sig-block">Principal</div>
                                </div>
                                <p style="font-size: 12px; margin-top: 20px;">
                                    <strong>Ab. = Absent • Total Grade Points = Grade Points x Credit Hours.<br>
                                    Minimum Requirement is 40% (i.e. Grade 'C') in each paper to qualify the Examination • See overleaf for GRADING SCALE</strong>
                                </p>
                            </div>
                        </div>
                        <div class="grade-sheet-grading-scale-container">
                           <h3>POINT SCALE FOR GRADING</h3>
                           <table class="grade-sheet-grading-scale-table">
                                <thead>
                                    <tr>
                                        <th>Percentage Distribution of Marks (Out of 100)</th>
                                        <th>Grade Point</th>
                                        <th>Letter Grade</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>=> 90 - < 100</td><td>10</td><td>A++</td><td>Outstanding</td></tr>
                                    <tr><td>=> 80 - < 90</td><td>9</td><td>A+</td><td>Excellent</td></tr>
                                    <tr><td>=> 70 - < 80</td><td>8</td><td>A</td><td>Very Good</td></tr>
                                    <tr><td>=> 60 - < 70</td><td>7</td><td>B+</td><td>Good</td></tr>
                                    <tr><td>=> 50 - < 60</td><td>6</td><td>B</td><td>Average</td></tr>
                                    <tr><td>=> 40 - < 50</td><td>5</td><td>C</td><td>Pass</td></tr>
                                    <tr><td>Below 40</td><td>0</td><td>F</td><td>Fail</td></tr>
                                </tbody>
                           </table>
                           <div class="grade-sheet-grading-scale-formulas">
                               <p><strong>SGPA</strong> = Aggregate of Grade Points (GP x Credit) earned in a Semester / Number of Credit Registered in a Semester</p>
                               <p><strong>CGPA</strong> = Aggregate of Grade Points (GP x Credit) earned in all Semesters / Number of Credits Registered in all Semesters</p>
                               <hr>
                               <p><strong>FIRST Division</strong> = CGPA 6.50 and above</p>
                               <p><strong>SECOND Division</strong> = CGPA 5.00 and above but less that 6.50</p>
                               <p><strong>Percentage of Marks in the Aggregate</strong> = CGPA x 9.50</p>
                               <hr>
                               <p>Co-curricular Grades will not be used to determine SGPA / CGPA. Despite the fact that Passing this paper is required in all Semesters.</p>
                           </div>
                        </div>
                    </div>
                    <div class="no-print" style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="action-button" onclick="printContent('#${modalId}')"><i class="fas fa-print"></i> Print Grade Sheet</button>
                        <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Grade-Sheet-${student.name}.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                `;
                container.innerHTML = gradeSheetHtml;
                
                 setTimeout(() => {
                    const qrContainer = getEl('grade-sheet-qr');
                    if(qrContainer) {
                        qrContainer.innerHTML = '';
                        const qrData = `Sr.No: ${serialNumber}\nRoll No: ${student.rollNumber}\nName: ${student.name}\nCourse: ${student.className}\nExam: ${examMaster.name}\nSGPA: ${sgpa}`;
                        new QRCode(qrContainer, { text: qrData, width: 80, height: 80, colorDark: "#000000", colorLight: "#ffffff" });
                        convertQrCanvasToImage(qrContainer);
                    }
                }, 100);
            }
            
            function renderAdmitCardPortalPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Admit Card Portal');

                const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}">${c}</option>`).join('');

                const examOptions = (state.data.examMasters || [])
                    .sort((a, b) => b.id - a.id)
                    .map(ex => `<option value="${ex.id}">${ex.name}</option>`).join('');

                mainContent.innerHTML += `<div class="page active"><div class="card">
                    <div class="card-header"><h3>Download Your Admit Card</h3></div>
                    <p>Please provide your details below to generate your admit card.</p>
                    <form id="find-admit-card-form" style="margin-top:20px;">
                        <div class="form-group">
                            <label for="admit-card-class-select">1. Select Your Course</label>
                            <select id="admit-card-class-select" required>
                                <option value="">-- Select Course --</option>
                                ${courseOptionsHTML}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="admit-card-exam-select">2. Select Exam</label>
                            <select id="admit-card-exam-select" required>
                                <option value="">-- Select Exam --</option>
                                ${examOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="admit-card-roll-number">3. Enter Your Roll Number</label>
                            <input type="text" id="admit-card-roll-number" placeholder="Enter your roll number" required>
                        </div>
                        <button type="submit" class="action-button inline">Generate Admit Card</button>
                    </form>
                    <div id="admit-card-display-area" style="margin-top:30px;"></div>
                </div></div>`;

                getEl('find-admit-card-form').onsubmit = (e) => {
                    e.preventDefault();
                    handleFindAdmitCard();
                };
            }
            
            function handleFindAdmitCard() {
                const courseName = getEl('admit-card-class-select').value;
                const examMasterId = getEl('admit-card-exam-select').value;
                const rollNumber = getEl('admit-card-roll-number').value.trim();
                const displayArea = getEl('admit-card-display-area');

                if (!courseName || !examMasterId || !rollNumber) {
                    displayArea.innerHTML = `<p class="form-feedback error">Please fill all three fields.</p>`;
                    return;
                }

                const student = (state.data.students || []).find(s => 
                    s.className === courseName && 
                    s.rollNumber && 
                    s.rollNumber.toLowerCase() === rollNumber.toLowerCase()
                );

                if (student) {
                    showAdmitCard(student, examMasterId, displayArea);
                } else {
                    displayArea.innerHTML = `<p class="form-feedback error">No student found with Roll Number <strong>${rollNumber}</strong> in <strong>${courseName}</strong>. Please check your details.</p>`;
                }
            }
            
            function showAdmitCard(student, examMasterId, container) {
                const schoolInfo = state.data.siteContent;
                const examMaster = findById('examMasters', examMasterId);
                if(!examMaster) {
                    showToast("Selected exam could not be found.", "error");
                    return;
                }
                const examSchedulesForCourse = (state.data.examSchedules || [])
                    .filter(ex => ex.examMasterId === examMasterId && ex.className === student.className)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
                
                if(examMaster.category === 'Odd Semester' || examMaster.category === 'Even Semester') {
                    examSchedulesForCourse.push({
                        date: 'N/A',
                        subject: 'FIRST AID AND HEALTH',
                        paperCode: 'CC-2',
                        startTime: 'N/A',
                        endTime: 'N/A'
                    });
                }
                
                const getDayOfWeek = (dateString) => {
                    if(dateString === 'N/A') return 'N/A';
                    const date = new Date(dateString);
                    const userTimezoneOffset = date.getTimezoneOffset() * 60000;
                    const correctedDate = new Date(date.getTime() + userTimezoneOffset);
                    return correctedDate.toLocaleDateString('en-US', { weekday: 'long' });
                };

                const examRows = examSchedulesForCourse.map(ex => `
                    <tr>
                        <td>${ex.date === 'N/A' ? 'TBD' : new Date(ex.date).toLocaleDateString('en-GB')}</td>
                        <td>${getDayOfWeek(ex.date)}</td>
                        <td>${ex.subject}</td>
                        <td>${ex.paperCode || '-'}</td>
                        <td>${ex.startTime} - ${ex.endTime}</td>
                    </tr>
                `).join('') || '<tr><td colspan="5" style="text-align:center;">No exams scheduled for your course in this examination.</td></tr>';
                
                const signatureDoc = (student.documents || []).find(doc => doc.name && doc.name.toLowerCase().includes('signature'));
                const modalId = `admit-card-${student.id}`;
            
                const admitCardHtml = `
                    <div class="printable-area" id="${modalId}">
                        <div class="admit-card-container" style="width: 100%; max-width: 800px; border: 2px solid var(--primary-color); padding: 25px; margin: auto; background: var(--background-color);">
                            <div class="id-card-header" style="border-bottom-width: 3px;">
                                <h3 style="text-transform: uppercase;">${schoolInfo.schoolName}</h3>
                                <p style="font-size: 1.2em; margin-top: 8px; color: var(--primary-light); font-weight: 600;">ADMIT CARD - ${examMaster.name}</p>
                            </div>
                             <div style="display: flex; justify-content: space-between; align-items: flex-start; margin: 25px 0; padding: 0 10px;">
                                <div style="text-align: left; font-size: 1rem; line-height: 1.6;">
                                    <p><strong>Student Name:</strong> ${student.name}</p>
                                    <p><strong>Father's Name:</strong> ${student.fatherName}</p>
                                    <p><strong>Roll No:</strong> ${student.rollNumber}</p>
                                    <p><strong>Course:</strong> ${student.className}</p>
                                </div>
                                <div style="text-align:center;">
                                    <img src="${student.photo || `https://i.pravatar.cc/120?u=${student.id}`}" alt="Photo" class="id-card-photo" style="margin:0; width: 120px; height: 140px; border-radius: 8px; object-fit: cover;">
                                    ${signatureDoc ? `<img src="${signatureDoc.data}" alt="Signature" style="height: 40px; max-width: 120px; object-fit: contain; margin-top: 5px;">` : ''}
                                </div>
                            </div>
                            <h4 style="margin: 25px 0 15px 0; text-align:center; font-size: 1.2rem;">Exam Schedule</h4>
                            <div class="table-container" style="padding: 0 10px;">
                                <table style="font-size: 0.95em; width:100%;">
                                    <thead style="background-color: var(--secondary-color);">
                                        <tr>
                                            <th style="text-align: left;">Date</th>
                                            <th style="text-align: left;">Day</th>
                                            <th style="text-align: left;">Subject</th>
                                            <th style="text-align: left;">Paper Code</th>
                                            <th style="text-align: left;">Time</th>
                                        </tr>
                                    </thead>
                                    <tbody>${examRows}</tbody>
                                </table>
                            </div>
                            <div class="receipt-footer" style="margin-top: 30px; padding: 0 10px;">
                                <div class="receipt-signature" style="margin-top: 60px;">
                                    <div class="receipt-signature-line"></div>
                                    <p>Controller of Examinations</p>
                                </div>
                                <p style="text-align:left; font-size: 0.85rem;"><strong>Instructions:</strong><br>1. Bring this admit card to the examination hall for every exam.<br>
                                 2. No electronic devices (mobiles, smart watches, etc.) are allowed inside the examination hall.<br>3. Reach the examination center at least 15 minutes before the scheduled time.</p>
                            </div>
                        </div>
                    </div>
                    <div class="no-print" style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="action-button" onclick="printContent('#${modalId}')"><i class="fas fa-print"></i> Print Admit Card</button>
                        <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Admit-Card-${student.name}.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                `;
                
                if (container) {
                    container.innerHTML = admitCardHtml;
                } else {
                    showModal("Admit Card", admitCardHtml, "900px");
                }
            }
            
            function renderCertificatePage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Certificate Generation');
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="card-header"><h3>Generate Certificate</h3></div><p>Select a student to generate a certificate.</p>
                        <div class="search-box-container" style="margin-top: 20px;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" oninput="renderCertificateStudentList(this.value)" placeholder="Search Student..." class="search-input">
                        </div>
                        <div class="table-container"><table id="certificate-student-table"></table></div>
                        </div></div>`;
                renderCertificateStudentList();
            }
            
            function renderCertificateStudentList(searchTerm = '') {
                const table = getEl('certificate-student-table');
                if (!table) return;
                let students = (state.data.students || []).filter(s => searchTerm ? 
                    (s.name && s.name.toLowerCase().includes(searchTerm.toLowerCase())) : true);
                let head = `<thead><tr><th>Admission No.</th><th>Name</th><th>Action</th></tr></thead>`;
                let body = `<tbody>`;
                if (students.length === 0) body += `<tr><td colspan="3" style="text-align:center;">No students found.</td></tr>`;
                else students.sort((a, b) => b.id - a.id).forEach(s => { body += `<tr>
                    <td><strong>${s.admissionNumber || 'N/A'}</strong></td>
                    <td>${s.name}</td>
                    <td><button class="action-button inline" onclick="showCertificateGenerationModal('${s.id}')"><i class="fas fa-certificate"></i> Generate</button></td>
                </tr>`; });
                table.innerHTML = head + body + `</tbody>`;
            }

            function showCertificateGenerationModal(studentId) {
                const student = findById('students', studentId);
                const formContent = `
                    <form id="certificate-gen-form">
                        <p>Generating certificate for <strong>${student.name}</strong>.</p>
                        <div class="form-group">
                            <label for="certificate-title">Certificate For</label>
                            <input type="text" id="certificate-title" value="Completing the ${student.className} Program" required>
                        </div>
                        <div class="form-group">
                            <label for="certificate-date">Issue Date</label>
                            <input type="date" id="certificate-date" value="${new Date().toISOString().slice(0,10)}" required>
                        </div>
                        <button type="submit" class="action-button">Preview Certificate</button>
                    </form>
                `;
                showModal('Generate Certificate', formContent);
                getEl('certificate-gen-form').onsubmit = (e) => {
                    e.preventDefault();
                    const certTitle = getEl('certificate-title').value;
                    const issueDate = getEl('certificate-date').value;
                    closeModal();
                    showCertificate(student, certTitle, issueDate);
                };
            }
            
            function showCertificate(student, certTitle, issueDate) {
                 const schoolInfo = state.data.siteContent;
                 const adminProfile = JSON.parse(localStorage.getItem('adminAccount') || '{}');
                 const modalId = `certificate-${student.id}`;
                 const content = `
                    <div class="printable-area" id="${modalId}">
                        <div class="certificate-container">
                            <div class="certificate-header">
                                <h1>Certificate of Achievement</h1>
                                <h2 style="text-transform: uppercase;">${schoolInfo.schoolName}</h2>
                            </div>
                            <div class="certificate-body">
                                <img src="${student.photo || `https://i.pravatar.cc/150?u=${student.id}`}" alt="Student Photo" class="certificate-student-photo">
                                <p>This is to certify that</p>
                                <p class="student-name">${student.name}</p>
                                <p>has successfully completed the requirements for</p>
                                <p><strong class="class-name">${certTitle}</strong></p>
                                <p>on ${new Date(issueDate).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}.</p>
                            </div>
                            <div class="certificate-footer">
                                <div class="signature-block">
                                    <div class="signature-line"></div>
                                    <p><strong>Date</strong></p>
                                </div>
                                <div class="signature-block">
                                     <div class="signature-line"></div>
                                    <p><strong>${adminProfile.name || 'Director'}</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="no-print" style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="action-button" onclick="printContent('#${modalId}')"><i class="fas fa-print"></i> Print Certificate</button>
                        <button class="action-button secondary" onclick="downloadAsPdf('#${modalId}', 'Certificate-${student.name}.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                `;
                showModal('Certificate Preview', content, '900px');
            }


            function renderNotesPage() { 
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showNoteForm()"><i class="fas fa-plus"></i> Add Note</button>`;
                mainContent.innerHTML = renderHeader('Admin Personal Notes', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="table-container"><table id="notes-table"></table></div></div></div>`;
                renderNotesTable();
            }

            function renderNotesTable() {
                const table = getEl('notes-table');
                if(!table) return;
                const { adminNotes } = state.data;
                let html = `<thead><tr><th>Title</th><th>Content</th><th>Date</th><th>Actions</th></tr></thead><tbody>`;
                 if (!adminNotes || adminNotes.length === 0) html += `<tr><td colspan="4" style="text-align:center;">No personal notes found.</td></tr>`;
                else { adminNotes.sort((a,b) => b.id - a.id).forEach(n => { html += `<tr><td>${n.title}</td><td>${n.content.substring(0, 50)}...</td><td>${new Date(n.id).toLocaleDateString()}</td><td class="action-buttons"><button class="edit-btn" onclick="showNoteForm('${n.id}')" title="Edit"><i class="fas fa-edit"></i></button><button class="delete-btn" onclick="deleteItem('adminNotes', '${n.id}', 'Are you sure you want to delete this note?', renderNotesTable)" title="Delete"><i class="fas fa-trash"></i></button></td></tr>`; }); }
                html += '</tbody>'; table.innerHTML = html;
            }
            function showNoteForm(id = null) { 
                const note = id ? findById('adminNotes', id) : {}; 
                const title = id ? 'Edit Note' : 'Add New Note'; 
                const formContent = `<form id="note-form"><input type="hidden" id="note-id" value="${note.id || ''}"><div class="form-group"><label for="note-title">Title</label><input type="text" id="note-title" value="${note.title || ''}" required></div><div class="form-group"><label for="note-content">Content</label><textarea id="note-content" rows="5" required>${note.content || ''}</textarea></div><button type="submit" class="action-button">${id ? 'Save Changes' : 'Add Note'}</button></form>`; 
                showModal(title, formContent); 
                getEl('note-form').onsubmit = e => { 
                    e.preventDefault(); 
                    const noteData = { id: getEl('note-id').value || Date.now(), title: getEl('note-title').value, content: getEl('note-content').value }; 
                    updateOrAddItem('adminNotes', noteData); 
                    showToast(`Note ${id ? 'updated' : 'added'}!`, 'success'); 
                    closeModal(); 
                    renderNotesTable(); 
                }; 
            }
            
            function renderGalleryPage() { 
                const mainContent = getEl('main-content'); 
                const actionsHtml = (state.loggedInUser?.role === 'admin') ? `<button class="action-button inline" onclick="showGalleryForm()"><i class="fas fa-plus"></i> Add Photo</button>` : ''; 
                mainContent.innerHTML = renderHeader('Photo Gallery', actionsHtml); 
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="gallery-grid" id="gallery-grid-container"></div></div></div>`; 
                renderGalleryGrid(); 
            }

            function renderGalleryGrid() { 
                const container = getEl('gallery-grid-container'); 
                if(!container) return; 
                const { gallery } = state.data; 
                if (!gallery || gallery.length === 0) { 
                    container.innerHTML = `<p>No photos in the gallery yet.</p>`; 
                    return; 
                } 
                container.innerHTML = gallery.sort((a,b) => b.id - a.id).map(item => `
                    <div class="gallery-item card">
                        <img src="${item.photo}" alt="${item.title}">
                        <div class="gallery-item-footer">
                            <span>${item.title}</span>
                            ${state.loggedInUser?.role === 'admin' ? `<button class="delete-btn" onclick="deleteItem('gallery', '${item.id}', 'Are you sure you want to delete this photo?', renderGalleryGrid)" title="Delete"><i class="fas fa-trash"></i></button>` : ''}
                        </div>
                    </div>`).join(''); 
            }

            function showGalleryForm() { 
                const title = 'Add Photo to Gallery'; 
                const formContent = `<form id="gallery-form"><div class="form-group"><label for="gallery-title">Photo Title</label><input type="text" id="gallery-title" required></div><div class="form-group"><label for="gallery-photo">Select Photo</label><input type="file" id="gallery-photo" accept="image/*" required></div><button type="submit" class="action-button">Add Photo</button></form>`; 
                showModal(title, formContent); 
                getEl('gallery-form').onsubmit = async e => { 
                    e.preventDefault(); 
                    const photoFile = getEl('gallery-photo').files[0]; 
                    if(!photoFile) return; 
                    const photoData = { id: Date.now(), title: getEl('gallery-title').value, photo: await fileToBase64(photoFile) }; 
                    updateOrAddItem('gallery', photoData); 
                    showToast('Photo added to gallery!', 'success'); 
                    closeModal(); 
                    renderGalleryGrid(); 
                }; 
            }
            
            function renderVideosPage() { 
                const mainContent = getEl('main-content'); 
                const actionsHtml = (state.loggedInUser?.role === 'admin') ? `<button class="action-button inline" onclick="showVideoForm()"><i class="fas fa-plus"></i> Add Video</button>` : ''; 
                mainContent.innerHTML = renderHeader('Video Gallery', actionsHtml); 
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="videos-grid" id="videos-grid-container"></div></div></div>`; 
                renderVideosGrid(); 
            }

            function renderVideosGrid() { 
                const container = getEl('videos-grid-container'); 
                if(!container) return; 
                const { videos } = state.data; 
                if (!videos || videos.length === 0) { 
                    container.innerHTML = `<p>No videos in the gallery yet.</p>`; 
                    return; 
                } 
                container.innerHTML = videos.sort((a,b) => b.id - a.id).map(item => `
                    <div class="video-item card">
                        <iframe src="${getYoutubeEmbedUrl(item.url)}" title="${item.title}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                        <div class="video-item-footer">
                            <span>${item.title}</span>
                             ${state.loggedInUser?.role === 'admin' ? `<button class="delete-btn" onclick="deleteItem('videos', '${item.id}', 'Are you sure you want to delete this video?', renderVideosGrid)" title="Delete"><i class="fas fa-trash"></i></button>`: ''}
                        </div>
                    </div>`).join(''); 
            }
            function showVideoForm() { 
                const title = 'Add Video to Gallery'; 
                const formContent = `<form id="video-form"><div class="form-group"><label for="video-title">Video Title</label><input type="text" id="video-title" required></div><div class="form-group"><label for="video-url">YouTube Video URL</label><input type="url" id="video-url" placeholder="https://www.youtube.com/watch?v=..." required></div><button type="submit" class="action-button">Add Video</button></form>`; 
                showModal(title, formContent); 
                getEl('video-form').onsubmit = e => { 
                    e.preventDefault(); 
                    const videoTitle = getEl('video-title').value; 
                    const videoUrl = getEl('video-url').value; 
                    if(videoUrl && videoTitle) { 
                        const videoData = { id: Date.now(), title: videoTitle, url: videoUrl }; 
                        updateOrAddItem('videos', videoData); 
                        showToast('Video added to gallery!', 'success'); 
                        closeModal(); 
                        renderVideosGrid(); 
                    } 
                }; 
            }
            
            function getYoutubeEmbedUrl(url) { 
                try { 
                    const urlObj = new URL(url); 
                    let videoId = urlObj.searchParams.get("v"); 
                    if (!videoId) { 
                        const pathParts = urlObj.pathname.split('/'); 
                        videoId = pathParts[pathParts.length - 1]; 
                    } 
                    return `https://www.youtube.com/embed/${videoId}`; 
                } catch (e) { 
                    console.error("Invalid YouTube URL:", url);
                    return '';
                } 
            }

            function setupAttendancePage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Student Attendance');
                mainContent.innerHTML += `
                    <div class="page active">
                        <div class="card">
                            <div class="card-header" style="flex-direction: column; align-items: flex-start; border-bottom: none; padding-bottom: 0;">
                                <h3>Student Attendance Management</h3>
                                <div class="view-switcher" style="margin-top: 15px;">
                                    <button id="mark-view-btn" class="action-button inline">Manual</button>
                                    <button id="report-view-btn" class="action-button inline">Monthly Report</button>
                                </div>
                            </div>
                            <div id="attendance-content" style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;"></div>
                        </div>
                    </div>
                `;
                getEl('mark-view-btn').onclick = () => renderMarkAttendanceView('students');
                getEl('report-view-btn').onclick = () => renderAttendanceReportView('students');
                renderMarkAttendanceView('students');
            }

            function setActiveView(activeBtnId) {
                 [
                    'mark-view-btn', 'report-view-btn',
                    'teacher-mark-view-btn', 'teacher-report-view-btn',
                    'staff-mark-view-btn', 'staff-report-view-btn'
                 ].forEach(id => {
                    const btn = getEl(id);
                    if (btn) btn.classList.remove('active');
                 });
                 if (getEl(activeBtnId)) getEl(activeBtnId).classList.add('active');
            }

            function renderMarkAttendanceView(type = 'students') {
                if(html5QrCode && html5QrCode.isScanning) html5QrCode.stop();
                
                let activeBtnId;
                if(type === 'students') activeBtnId = 'mark-view-btn';
                else if (type === 'teachers') activeBtnId = 'teacher-mark-view-btn';
                else if (type === 'staff') activeBtnId = 'staff-mark-view-btn';
                setActiveView(activeBtnId);
                
                const contentArea = getEl('attendance-content');
                const today = new Date().toISOString().slice(0, 10);


                let filterHtml = '';
                if (type === 'students') {
                     const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}">${c}</option>`).join('');
                     filterHtml = `<div class="form-group"><label for="attendance-class-filter">Filter by Course</label><select id="attendance-class-filter" onchange="renderAttendanceSheet('${type}')"><option value="">All Students</option>${courseOptionsHTML}</select></div>`;
                }
                
                contentArea.innerHTML = `
                    <div class="form-group"><label for="attendance-date">Select Date</label><input type="date" id="attendance-date" value="${today}" onchange="renderAttendanceSheet('${type}')"></div>
                    ${filterHtml}
                    <div class="table-container"><table id="attendance-table"></table></div>
                    <button class="action-button" style="margin-top: 20px;" onclick="saveAttendance('${type}')">Save ${type.charAt(0).toUpperCase() + type.slice(1)} Attendance</button>
                `;
                
                renderAttendanceSheet(type);
            }
            
            function renderAttendanceReportView(type = 'students') {
                
                if (html5QrCode && html5QrCode.isScanning) html5QrCode.stop();
                
                let activeBtnId;
                if(type === 'students') activeBtnId = 'report-view-btn';
                else if (type === 'teachers') activeBtnId = 'teacher-report-view-btn';
                else if (type === 'staff') activeBtnId = 'staff-report-view-btn';
                setActiveView(activeBtnId);
                
                const contentArea = getEl('attendance-content');

                const now = new Date();
                const currentYear = now.getFullYear();

                const yearOptions = Array.from({ length: 5 }, (_, i) => currentYear - i)
                    .map(y => `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`).join('');
                
                const monthOptions = Array.from({ length: 12 }, (_, i) => {
                    const monthName = new Date(0, i).toLocaleString('en-US', { month: 'long' });
                    return `<option value="${i}" ${i === now.getMonth() ? 'selected' : ''}>${monthName}</option>`;
                }).join('');

                let classFilterHtml = '';
                if (type === 'students') {
                    const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}">${c}</option>`).join('');
                    classFilterHtml = `
                        <div class="form-group" style="margin-bottom: 0; flex-grow: 1;">
                            <label for="report-class-filter">Filter by Course</label>
                            <select id="report-class-filter" onchange="displayMonthlyAttendanceReport('${type}')"><option value="all">All Students</option>${courseOptionsHTML}</select>
                        </div>`;
                }
                const modalId = `attendance-report-printable-${type}`;

                contentArea.innerHTML = `
                    <div class="no-print" style="display:flex; flex-wrap: wrap; gap: 20px; align-items: flex-end; margin-bottom: 20px;">
                        <div class="form-group" style="margin-bottom: 0; flex-grow: 1;">
                            <label for="report-month-filter">Select Month</label>
                            <select id="report-month-filter" onchange="displayMonthlyAttendanceReport('${type}')">${monthOptions}</select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0; flex-grow: 1;">
                            <label for="report-year-filter">Select Year</label>
                            <select id="report-year-filter" onchange="displayMonthlyAttendanceReport('${type}')">${yearOptions}</select>
                        </div>
                        ${classFilterHtml}
                        <button class="action-button inline" onclick="printContent('#${modalId}')" style="flex-shrink: 0;"><i class="fas fa-print"></i> Print Report</button>
                        <button class="action-button secondary inline" onclick="downloadAsPdf('#${modalId}', 'Attendance-Report.pdf')"><i class="fas fa-download"></i> Download PDF</button>
                    </div>
                    <div id="${modalId}"></div>`;
                
                displayMonthlyAttendanceReport(type);
            }
            
            function displayMonthlyAttendanceReport(type = 'students', memberId = null, isReadonly = false) {
                let reportContainer;
                if(state.currentPage === 'studentAttendance') {
                    reportContainer = getEl(`student-attendance-printable-${memberId}`);
                } else {
                    reportContainer = getEl(`attendance-report-printable-${type}`);
                }
                
                if (!reportContainer) return;
                
                let month, year, filterEl;
                if (state.currentPage === 'studentAttendance') {
                    month = parseInt(getEl('student-report-month-filter').value);
                    year = parseInt(getEl('student-report-year-filter').value);
                } else {
                    month = parseInt(getEl('report-month-filter').value);
                    year = parseInt(getEl('report-year-filter').value);
                    filterEl = getEl('report-class-filter');
                }
                
                const selectedClass = filterEl ? filterEl.value : 'all';

                let memberList;
                if (memberId) {
                    memberList = [findById(type, memberId)];
                } else {
                    memberList = (state.data[type] || []);
                    if (type === 'students' && selectedClass !== 'all') {
                        memberList = memberList.filter(s => s.className === selectedClass);
                    }
                }
                
                if (memberList.length === 0 || (memberId && !memberList[0])) {
                    reportContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">No members found for this selection.</p>';
                    return;
                }
                
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const monthName = new Date(year, month).toLocaleString('default', { month: 'long' });

                let tableHtml = `<div class="printable-area attendance-report">
                                 <h3 style="text-align: center; margin-bottom: 20px; color: var(--text-color);">Attendance Report for ${monthName} ${year}</h3>
                                 <form id="attendance-edit-form">
                                 <div class="table-container"><table class="monthly-attendance-table"><thead><tr><th class="sticky-col">Name</th>`;
                
                for (let day = 1; day <= daysInMonth; day++) {
                    tableHtml += `<th>${day}</th>`;
                }
                tableHtml += `<th>P</th><th>A</th><th>%</th></tr></thead><tbody>`;

                memberList.forEach(member => {
                    let presentCount = 0;
                    let absentCount = 0;
                    tableHtml += `<tr><td class="sticky-col">${member.name}</td>`;
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const date = new Date(year, month, day);
                        const dateString = date.toISOString().slice(0, 10);
                        const dayOfWeek = date.getDay();
                        
                        let attendanceSource;
                        if (type === 'students') attendanceSource = state.data.studentAttendance;
                        else if (type === 'teachers') attendanceSource = state.data.teacherAttendance;
                        else if (type === 'staff') attendanceSource = state.data.staffAttendance;

                        const attendanceStatus = (attendanceSource[dateString] && attendanceSource[dateString][member.id]) ? attendanceSource[dateString][member.id] : null;

                        let cellClass = '';
                        let cellContent = '-';

                        if (dayOfWeek === 0) { // Sunday
                            cellClass = 'weekend-cell';
                            cellContent = 'S';
                        } else {
                            if (isReadonly) {
                                if (attendanceStatus === 'present') {
                                    presentCount++;
                                    cellClass = 'present-cell';
                                    cellContent = 'P';
                                } else if (attendanceStatus === 'absent') {
                                    absentCount++;
                                    cellClass = 'absent-cell';
                                    cellContent = 'A';
                                } else {
                                    cellContent = '-';
                                }
                            } else {
                                cellContent = `
                                    <select name="attendance_${member.id}_${dateString}" class="attendance-select" style="background: transparent; border: none; color: var(--text-color); width: 40px; text-align: center; -moz-appearance: none; -webkit-appearance: none; appearance: none;">
                                        <option value="" ${!attendanceStatus ? 'selected' : ''}>-</option>
                                        <option value="present" ${attendanceStatus === 'present' ? 'selected' : ''} style="color: var(--success-color);">P</option>
                                        <option value="absent" ${attendanceStatus === 'absent' ? 'selected' : ''} style="color: var(--error-color);">A</option>
                                    </select>
                                `;
                                if (attendanceStatus === 'present') {
                                    presentCount++;
                                    cellClass = 'present-cell';
                                } else if (attendanceStatus === 'absent') {
                                    absentCount++;
                                    cellClass = 'absent-cell';
                                }
                            }
                        }
                        
                        tableHtml += `<td class="${cellClass}">${cellContent}</td>`;
                    }
                    
                    const totalMarkedDays = presentCount + absentCount;
                    const percentage = totalMarkedDays > 0 ? ((presentCount / totalMarkedDays) * 100).toFixed(0) : 0;

                    tableHtml += `<td class="present-cell">${presentCount}</td><td class="absent-cell">${absentCount}</td><td>${percentage}%</td></tr>`;
                });

                tableHtml += `</tbody></table></div>`;
                
                if (!isReadonly) {
                    tableHtml += `<button type="submit" class="action-button no-print" style="margin-top: 20px;">Save Changes</button>`;
                }

                tableHtml += `</form></div>`;
                reportContainer.innerHTML = tableHtml;

                const form = getEl('attendance-edit-form');
                if(form && !isReadonly) {
                    form.onsubmit = (e) => {
                        e.preventDefault();
                        const formData = new FormData(form);
                        let changesMade = false;
                        for(let [key, value] of formData.entries()) {
                             if (!key.startsWith('attendance_')) continue;
                            const [, memberId, dateString] = key.split('_');
                            
                            let attendanceKey;
                            if (type === 'students') attendanceKey = 'studentAttendance';
                            else if (type === 'teachers') attendanceKey = 'teacherAttendance';
                            else if (type === 'staff') attendanceKey = 'staffAttendance';
                            else continue;

                            if (!state.data[attendanceKey][dateString]) {
                                state.data[attendanceKey][dateString] = {};
                            }

                            const originalValue = state.data[attendanceKey][dateString][memberId];

                            if (value) {
                                if(originalValue !== value) {
                                    state.data[attendanceKey][dateString][memberId] = value;
                                    changesMade = true;
                                }
                            } else {
                                if(originalValue) {
                                    delete state.data[attendanceKey][dateString][memberId];
                                    changesMade = true;
                                }
                            }
                        }
                        if(changesMade){
                           saveData();
                           showToast('Attendance updated successfully!', 'success');
                           displayMonthlyAttendanceReport(type, memberId);
                        } else {
                           showToast('No changes to save.', 'info');
                        }
                    };
                }
            }

            function renderTeacherAttendancePage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Teacher Attendance');
                mainContent.innerHTML += `
                    <div class="page active">
                        <div class="card">
                            <div class="card-header" style="flex-direction: column; align-items: flex-start; border-bottom: none; padding-bottom: 0;">
                                <h3>Teacher Attendance Management</h3>
                                <div class="view-switcher" style="margin-top: 15px;">
                                    <button id="teacher-mark-view-btn" class="action-button inline">Manual</button>
                                    <button id="teacher-report-view-btn" class="action-button inline">Monthly Report</button>
                                </div>
                            </div>
                            <div id="attendance-content" style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;"></div>
                        </div>
                    </div>`;
                getEl('teacher-mark-view-btn').onclick = () => renderMarkAttendanceView('teachers');
                getEl('teacher-report-view-btn').onclick = () => renderAttendanceReportView('teachers');
                renderMarkAttendanceView('teachers');
            }
            
            function renderStaffAttendancePage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Staff Attendance');
                mainContent.innerHTML += `
                    <div class="page active">
                        <div class="card">
                            <div class="card-header" style="flex-direction: column; align-items: flex-start; border-bottom: none; padding-bottom: 0;">
                                <h3>Staff Attendance Management</h3>
                                <div class="view-switcher" style="margin-top: 15px;">
                                    <button id="staff-mark-view-btn" class="action-button inline">Manual</button>
                                    <button id="staff-report-view-btn" class="action-button inline">Monthly Report</button>
                                </div>
                            </div>
                            <div id="attendance-content" style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;"></div>
                        </div>
                    </div>`;
                getEl('staff-mark-view-btn').onclick = () => renderMarkAttendanceView('staff');
                getEl('staff-report-view-btn').onclick = () => renderAttendanceReportView('staff');
                renderMarkAttendanceView('staff');
            }

            function calculateAttendance(type, memberId) {
                let present = 0, absent = 0;
                let attendanceRecords;
                if (type === 'students') attendanceRecords = state.data.studentAttendance || {};
                else if (type === 'teachers') attendanceRecords = state.data.teacherAttendance || {};
                else if (type === 'staff') attendanceRecords = state.data.staffAttendance || {};
                else return { present: 0, absent: 0 };
                
                for (const date in attendanceRecords) {
                    if (attendanceRecords[date][memberId]) {
                        if (attendanceRecords[date][memberId] === 'present') present++;
                        else if (attendanceRecords[date][memberId] === 'absent') absent++;
                    }
                }
                return { present, absent };
            }

            function renderAttendanceSheet(type) { 
                const table = getEl('attendance-table'); 
                if(!table) return; 
                
                let membersToList = [];
                if (type === 'students') {
                    const classFilter = getEl('attendance-class-filter');
                    const className = classFilter ? classFilter.value : '';
                    membersToList = className ? (state.data.students || []).filter(s => s.className === className) : (state.data.students || []);
                } else {
                    membersToList = state.data[type] || [];
                }
                
                const date = getEl('attendance-date').value; 
                let attendanceData;
                if (type === 'students') attendanceData = (state.data.studentAttendance || {})[date] || {};
                else if (type === 'teachers') attendanceData = (state.data.teacherAttendance || {})[date] || {};
                else if (type === 'staff') attendanceData = (state.data.staffAttendance || {})[date] || {};

                let html = `<thead><tr><th>Member Name</th><th>Status</th></tr></thead><tbody>`; 
                if(membersToList.length === 0) {
                    html += `<tr><td colspan="2" style="text-align:center;">No members found for this course.</td></tr>`; 
                } else { 
                    membersToList.forEach(s => { 
                        const status = attendanceData[s.id] || 'absent'; 
                        html += `<tr data-member-id="${s.id}">
                                    <td>${s.name}</td>
                                    <td>
                                        <label style="margin-right:15px;"><input type="radio" name="status_${s.id}" value="present" ${status === 'present' ? 'checked' : ''}> Present</label>
                                        <label><input type="radio" name="status_${s.id}" value="absent" ${status === 'absent' ? 'checked' : ''}> Absent</label>
                                    </td>
                                </tr>`; 
                    }); 
                } 
                html += `</tbody>`; 
                table.innerHTML = html; 
            }
            
            function saveAttendance(type) { 
                const date = getEl('attendance-date').value; 
                let attendanceDataKey;
                if (type === 'students') attendanceDataKey = 'studentAttendance';
                else if (type === 'teachers') attendanceDataKey = 'teacherAttendance';
                else if (type === 'staff') attendanceDataKey = 'staffAttendance';
                else return;

                if(!state.data[attendanceDataKey][date]) state.data[attendanceDataKey][date] = {}; 
                let count = 0; 
                getEl('attendance-table').querySelectorAll('tbody tr').forEach(row => { 
                    const memberId = row.getAttribute('data-member-id');
                    if (memberId) {
                       const statusInput = row.querySelector('input[type="radio"]:checked');
                       if (statusInput) {
                           state.data[attendanceDataKey][date][memberId] = statusInput.value; 
                           count++; 
                       }
                    }
                }); 
                if (count > 0) { 
                    saveData(); 
                    showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} attendance for ${date} saved!`, 'success'); 
                    if(state.currentPage === 'home') renderHomePage(); 
                } else { 
                    showToast(`No one to mark.`, 'info'); 
                } 
            }

            function showUnifiedScanner() {
                const modalContent = `
                    <div id="unified-scanner-container" style="text-align: center;">
                        <div id="qr-scanner-container" style="width: 100%; max-width: 400px; margin: 0 auto;"></div>
                        <div id="unified-scan-result" style="margin-top: 15px; font-size: 1.1rem; padding: 10px; border-radius: 6px;"></div>
                        <div id="last-scanned-info" class="card" style="margin-top: 20px; display: none; padding: 15px;">
                            <img id="last-scanned-photo" src="" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 0 auto 15px; border: 3px solid var(--primary-light);">
                            <h4 id="last-scanned-name" style="font-size: 1.2rem;"></h4>
                            <p id="last-scanned-id" style="color: var(--text-muted);"></p>
                        </div>
                    </div>
                `;
                showModal('Unified QR Attendance Scanner', modalContent, '500px');
                
                html5QrCode = new Html5Qrcode("qr-scanner-container");
                const qrCodeSuccessCallback = (decodedText, decodedResult) => {
                    const resultEl = getEl('unified-scan-result');
                    const infoEl = getEl('last-scanned-info');
                    
                    const cleanDecodedText = decodedText.trim();
                    let member = null;
                    let memberType = '';
                    let attendanceKey = '';
                    let idField = '';

                    member = (state.data.students || []).find(s => s.admissionNumber === cleanDecodedText);
                    if (member) {
                        memberType = 'Student';
                        attendanceKey = 'studentAttendance';
                        idField = member.admissionNumber;
                    } else {
                        member = (state.data.teachers || []).find(t => t.employeeId === cleanDecodedText);
                        if (member) {
                            memberType = 'Teacher';
                            attendanceKey = 'teacherAttendance';
                            idField = member.employeeId;
                        } else {
                           member = (state.data.staff || []).find(s => s.employeeId === cleanDecodedText);
                           if (member) {
                                memberType = 'Staff';
                                attendanceKey = 'staffAttendance';
                                idField = member.employeeId;
                           }
                        }
                    }
                    
                    if (member) {
                        const today = new Date().toISOString().slice(0, 10);
                        if (!state.data[attendanceKey][today]) state.data[attendanceKey][today] = {};

                        if (state.data[attendanceKey][today][member.id] === 'present') {
                            resultEl.innerHTML = `<strong style="color: var(--warning-color);">Attendance already marked for ${member.name}.</strong>`;
                        } else {
                            state.data[attendanceKey][today][member.id] = 'present';
                            saveData(); 
                            resultEl.innerHTML = `<strong style="color: var(--success-color);">Success! Attendance marked for ${member.name} (${memberType}).</strong>`;
                            showToast(`Attendance marked for ${member.name}`, 'success');
                            if(state.currentPage === 'home') renderHomePage();
                        }
                        
                        getEl('last-scanned-photo').src = member.photo || `https://i.pravatar.cc/100?u=${member.id}`;
                        getEl('last-scanned-name').textContent = member.name;
                        getEl('last-scanned-id').textContent = idField;
                        infoEl.style.display = 'block';

                    } else {
                        resultEl.innerHTML = `<strong style="color: var(--error-color);">Error! Invalid QR Code. Member not found.</strong>`;
                        infoEl.style.display = 'none';
                    }
                };
                const config = { fps: 10, qrbox: { width: 250, height: 250 } };
                
                html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback)
                    .catch(err => {
                        console.error("QR Scanner Error:", err);
                        getEl('unified-scan-result').innerHTML = `<strong>Camera Error!</strong><br>Could not start camera. Check permissions.`;
                    });
            }

            function renderInquiriesPage() { 
                const mainContent = getEl('main-content'); 
                const userRole = state.loggedInUser?.role || 'guest';
                const actionsHtml = (userRole === 'admin' || userRole === 'guest') ? `<button class="action-button inline" onclick="showInquiryForm()"><i class="fas fa-plus"></i> Add Inquiry</button>`: '';
                mainContent.innerHTML = renderHeader('Inquiries', actionsHtml); 
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="table-container"><table id="inquiries-table"></table></div></div></div>`; 
                renderInquiriesTable(); 
            }

            function renderInquiriesTable() { 
                const table = getEl('inquiries-table'); 
                if (!table) return; 
                const { inquiries } = state.data; 
                const userRole = state.loggedInUser?.role || 'guest';
                let html = `<thead><tr><th>Name</th><th>Contact</th><th>Inquiry For</th><th>Status</th>`;
                if(userRole === 'admin') html += `<th>Actions</th>`;
                html += `</tr></thead><tbody>`;

                if (!inquiries || inquiries.length === 0) {
                    html += `<tr><td colspan="${userRole === 'admin' ? 5 : 4}" style="text-align:center;">No inquiries found.</td></tr>`;
                } else { 
                    inquiries.sort((a,b) => b.id - a.id).forEach(i => { 
                        html += `<tr>
                                    <td>${i.name}</td>
                                    <td>${i.contact}</td>
                                    <td>${i.inquiryFor}</td>
                                    <td>${i.status}</td>
                                    ${userRole === 'admin' ? `
                                    <td class="action-buttons">
                                        <button class="edit-btn" onclick="showInquiryForm('${i.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                        <button class="delete-btn" onclick="deleteItem('inquiries', '${i.id}', 'Are you sure you want to delete this inquiry?', renderInquiriesTable)" title="Delete"><i class="fas fa-trash"></i></button>
                                    </td>` : ''}
                                </tr>`; 
                    }); 
                } 
                html += '</tbody>'; table.innerHTML = html; 
            }

            function showInquiryForm(id = null) { 
                const inquiry = id ? findById('inquiries', id) : {}; 
                const title = id ? 'Edit Inquiry' : 'Add New Inquiry'; 
                const userRole = state.loggedInUser?.role || 'guest';
                
                const courseOptionsHTML = courseOptionsList
                    .map(c => `<option value="${c}" ${inquiry.className === c ? 'selected' : ''}>${c}</option>`).join('');

                const formContent = `<form id="inquiry-form">
                                        <input type="hidden" id="inquiry-id" value="${inquiry.id || ''}">
                                        <div class="form-grid">
                                            <div class="form-group"><label for="inquiry-name">Student's Name</label><input type="text" id="inquiry-name" value="${inquiry.name || ''}" required></div>
                                            <div class="form-group"><label for="inquiry-father-name">Father's Name</label><input type="text" id="inquiry-father-name" value="${inquiry.fatherName || ''}" required></div>
                                            <div class="form-group"><label for="inquiry-contact">Contact</label><input type="tel" id="inquiry-contact" value="${inquiry.contact || ''}" required></div>
                                            <div class="form-group"><label for="inquiry-email">Email</label><input type="email" id="inquiry-email" value="${inquiry.email || ''}"></div>
                                            <div class="form-group"><label for="inquiry-class">Course</label><select id="inquiry-class">${courseOptionsHTML}</select></div>
                                            <div class="form-group"><label for="inquiry-category">Category</label><select id="inquiry-category" required><option value="">Select Category</option><option value="General">General</option><option value="OBC">OBC</option><option value="SC">SC</option><option value="ST">ST</option></select></div>
                                        </div>
                                        <div class="form-group"><label for="inquiry-for">Inquiry Message (Optional)</label><textarea id="inquiry-for" rows="3">${inquiry.inquiryFor || ''}</textarea></div>
                                        ${userRole === 'admin' ? `
                                        <div class="form-group"><label for="inquiry-status">Status</label><select id="inquiry-status"><option value="New" ${inquiry.status === 'New' || !inquiry.status ? 'selected' : ''}>New</option><option value="Followed Up" ${inquiry.status === 'Followed Up' ? 'selected' : ''}>Followed Up</option><option value="Enrolled" ${inquiry.status === 'Enrolled' ? 'selected' : ''}>Enrolled</option><option value="Closed" ${inquiry.status === 'Closed' ? 'selected' : ''}>Closed</option></select></div>
                                        `: `
                                        <input type="hidden" id="inquiry-status-hidden" value="New">
                                        `}
                                        <button type="submit" class="action-button">${id ? 'Save Changes' : 'Submit Inquiry'}</button>
                                     </form>`; 
                showModal(title, formContent, '800px'); 
                getEl('inquiry-form').onsubmit = e => { 
                    e.preventDefault(); 
                    const statusEl = getEl('inquiry-status');
                    const status = statusEl ? statusEl.value : getEl('inquiry-status-hidden').value;

                    const inquiryData = { 
                        id: getEl('inquiry-id').value || Date.now(), 
                        name: getEl('inquiry-name').value,
                        fatherName: getEl('inquiry-father-name').value,
                        contact: getEl('inquiry-contact').value,
                        email: getEl('inquiry-email').value,
                        className: getEl('inquiry-class').value,
                        category: getEl('inquiry-category').value,
                        inquiryFor: getEl('inquiry-for').value, 
                        status: status
                    }; 

                    updateOrAddItem('inquiries', inquiryData); 
                    showToast(`Inquiry ${id ? 'updated' : 'submitted'}!`, 'success'); 
                    closeModal(); 
                    renderInquiriesTable();
                    if (state.currentPage === 'home') renderHomePage();
                }; 
            }
            
            function renderAccountSettingsPage() { 
                const mainContent = getEl('main-content');
                const adminProfile = state.loggedInUser;
                mainContent.innerHTML = renderHeader('User Account'); 
                mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="card-header"><h3>Profile Information</h3></div>
                        <form id="profile-settings-form">
                            <div class="form-group">
                                <label for="admin-name">Admin Name</label>
                                <input type="text" id="admin-name" value="${adminProfile.name || 'Admin'}">
                            </div>
                            <div class="form-group">
                                <label for="admin-photo-file">Admin Photo</label>
                                <input type="file" id="admin-photo-file" accept="image/*">
                                <input type="hidden" id="admin-photo-base64" value="${adminProfile.photo || ''}">
                                ${adminProfile.photo ? `<img src="${adminProfile.photo}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-top: 10px;">` : ''}
                            </div>
                            <button type="submit" class="action-button inline">Save Profile</button>
                        </form>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>Change Password</h3></div>
                        <form id="change-password-form">
                            <div class="form-group"><label for="current-password">Current Password</label><input type="password" id="current-password" required></div>
                            <div class="form-group"><label for="new-password">New Password</label><input type="password" id="new-password" minlength="4" required></div>
                            <div class="form-group"><label for="confirm-new-password">Confirm New Password</label><input type="password" id="confirm-new-password" required></div>
                            <button type="submit" class="action-button inline">Change Password</button>
                        </form>
                    </div>
                </div>`; 

                getEl('admin-photo-file').onchange = async (e) => { 
                    if (e.target.files[0]) {
                        getEl('admin-photo-base64').value = await fileToBase64(e.target.files[0]);
                    }
                }; 

                getEl('profile-settings-form').onsubmit = e => { 
                    e.preventDefault(); 
                    const currentAdmin = JSON.parse(localStorage.getItem('adminAccount'));
                    const newProfile = { 
                        ...currentAdmin,
                        name: getEl('admin-name').value, 
                        photo: getEl('admin-photo-base64').value 
                    }; 
                    localStorage.setItem('adminAccount', JSON.stringify(newProfile));
                    state.loggedInUser = {role: 'admin', ...newProfile};
                    localStorage.setItem('loggedInUser', JSON.stringify(state.loggedInUser));
                    showToast('Profile updated!', 'success'); 
                    renderSidebar(); 
                    renderAccountSettingsPage();
                };

                getEl('change-password-form').onsubmit = e => { 
                    e.preventDefault();
                    const currentAdmin = JSON.parse(localStorage.getItem('adminAccount')); 
                    const currentPass = getEl('current-password').value; 
                    const newPass = getEl('new-password').value; 
                    const confirmPass = getEl('confirm-new-password').value; 
                    if (btoa(currentPass) !== currentAdmin.password) { return showToast('Current password incorrect.', 'error'); } 
                    if (newPass.length < 4) { return showToast('New password must be at least 4 characters.', 'error'); } 
                    if (newPass !== confirmPass) { return showToast('New passwords do not match.', 'error'); } 
                    
                    const updatedAdmin = {...currentAdmin, password: btoa(newPass)};
                    localStorage.setItem('adminAccount', JSON.stringify(updatedAdmin));
                    state.loggedInUser = {role: 'admin', ...updatedAdmin};
                    localStorage.setItem('loggedInUser', JSON.stringify(state.loggedInUser));
                    showToast('Password changed successfully!', 'success');                 
                    e.target.reset(); 
                }; 
            }
            
            function renderAppearanceSettingsPage() { 
                const mainContent = getEl('main-content'); 
                const currentTheme = localStorage.getItem('theme') || 'dark'; 
                const currentWeight = localStorage.getItem('fontWeight') || 'normal'; 
                mainContent.innerHTML = renderHeader('Appearance'); 
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="card-header" style="padding-bottom:10px; border:none;"><h3>Background Theme</h3></div><p>Choose between a light or dark background.</p><div class="form-group" style="margin-top: 20px;"><select id="theme-select"><option value="light" ${currentTheme === 'light' ? 'selected' : ''}>Light Mode</option><option value="dark" ${currentTheme === 'dark' ? 'selected' : ''}>Dark Mode</option></select></div></div><div class="card"><div class="card-header" style="padding-bottom:10px; border:none;"><h3>Font Weight</h3></div><p>Change the overall font weight.</p><div class="form-group" style="margin-top: 20px;"><select id="font-weight-select"><option value="light" ${currentWeight === 'light' ? 'selected' : ''}>Light</option><option value="normal" ${currentWeight === 'normal' ? 'selected' : ''}>Normal</option><option value="bold" ${currentWeight === 'bold' ? 'selected' : ''}>Bold</option></select></div></div></div>`; 
                getEl('theme-select').onchange = (e) => changeTheme(e.target.value); 
                getEl('font-weight-select').onchange = changeFontWeight; 
            }
            
             function renderContentSettingsPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Site Content Management');
                const { siteContent } = state.data;

                const newsItemsHtml = (siteContent.latestNews || []).sort((a,b) => b.id-a.id).map(item => `
                    <div class="notice-item">
                        <h4>${item.title}</h4>
                        <p>${item.content.substring(0, 100)}...</p>
                        <div class="action-buttons no-print">
                            <button class="edit-btn" onclick="showNewsForm('${item.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                            <button class="delete-btn" onclick="deleteNewsItem('${item.id}')" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`).join('') || '<p>No news items yet.</p>';

                mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="card-header"><h3>From the Director's Desk</h3></div>
                        <form id="principal-desk-form">
                            <div class="form-group">
                                <textarea id="principal-desk-content" rows="6" required>${siteContent.principalDesk || ''}</textarea>
                            </div>
                            <button type="submit" class="action-button inline">Save Changes</button>
                        </form>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>About Our College</h3></div>
                        <form id="about-school-form">
                            <div class="form-group">
                                <textarea id="about-school-content" rows="6" required>${siteContent.aboutSchool || ''}</textarea>
                            </div>
                            <button type="submit" class="action-button inline">Save Changes</button>
                        </form>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Latest News</h3>
                            <button class="action-button inline" onclick="showNewsForm()"><i class="fas fa-plus"></i> Add News</button>
                        </div>
                        <div id="news-items-list">${newsItemsHtml}</div>
                    </div>
                </div>`;
                
                getEl('principal-desk-form').onsubmit = e => {
                    e.preventDefault();
                    state.data.siteContent.principalDesk = getEl('principal-desk-content').value;
                    saveData();
                    showToast("Director's message updated!", 'success');
                };
                getEl('about-school-form').onsubmit = e => {
                    e.preventDefault();
                    state.data.siteContent.aboutSchool = getEl('about-school-content').value;
                    saveData();
                    showToast("About college content updated!", 'success');
                };
            }
            
            function renderSetTopperPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Set College Toppers');
                 mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="card-header"><h3>Set College Toppers Manually</h3></div>
                        <p>Manually select students to display as college toppers on the dashboard. If no students are selected, the system will automatically display the topper based on the latest exam marks.</p>
                        <div class="search-box-container" style="margin-top: 20px;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="topper-lookup-input" oninput="lookupTopperStudent(this.value)" placeholder="Search student by name or admission no..." class="search-input">
                        </div>
                        <div id="topper-lookup-results"></div>
                        <hr style="border-color: var(--border-color); margin: 20px 0;">
                        <div id="current-toppers-display"></div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header"><h3>Upload Topper Photo</h3></div>
                        <p>Upload a specific photo to be shown in the "College Topper" section on the homepage. If no photo is uploaded, the student's own profile photo will be used.</p>
                        <form id="topper-photo-form" style="margin-top: 20px;">
                            <div class="form-group">
                                <label for="topper-photo-upload">Select Photo</label>
                                <input type="file" id="topper-photo-upload" accept="image/*">
                                <input type="hidden" id="topper-photo-base64" value="${state.data.siteContent.topperPhoto || ''}">
                            </div>
                            <div id="topper-photo-preview"></div>
                            <button type="submit" class="action-button inline">Save Topper Photo</button>
                             ${state.data.siteContent.topperPhoto ? `<button type="button" class="action-button secondary inline" onclick="removeTopperPhoto()">Remove Photo</button>` : ''}
                        </form>
                    </div>
                 </div>`;
                 displayCurrentManualToppers();
                 renderTopperPhotoPreview();

                getEl('topper-photo-upload').onchange = async (e) => { 
                    if (e.target.files[0]) {
                        getEl('topper-photo-base64').value = await fileToBase64(e.target.files[0]);
                        renderTopperPhotoPreview();
                    }
                };
                getEl('topper-photo-form').onsubmit = e => {
                    e.preventDefault();
                    state.data.siteContent.topperPhoto = getEl('topper-photo-base64').value;
                    saveData();
                    showToast('Topper photo updated!', 'success');
                    renderSetTopperPage();
                };
            }
            
             function renderTopperPhotoPreview() {
                const previewContainer = getEl('topper-photo-preview');
                const photoData = getEl('topper-photo-base64').value;
                if(photoData) {
                    previewContainer.innerHTML = `<img src="${photoData}" style="max-width: 150px; height: auto; border-radius: 8px; margin-bottom: 15px;">`;
                } else {
                    previewContainer.innerHTML = '';
                }
            }

            window.removeTopperPhoto = () => {
                state.data.siteContent.topperPhoto = '';
                saveData();
                showToast('Topper photo removed.', 'success');
                renderSetTopperPage();
            };

            function lookupTopperStudent(query) {
                const resultsContainer = getEl('topper-lookup-results');
                if (!resultsContainer) return;
                query = query.trim().toLowerCase();
                
                if (!query) {
                    resultsContainer.innerHTML = '';
                    return;
                }
                
                const existingTopperIds = state.data.siteContent.manualTopperStudentIds || [];
                const results = (state.data.students || []).filter(s => 
                        !existingTopperIds.includes(s.id) && 
                        ((s.name && s.name.toLowerCase().includes(query)) ||
                         (s.admissionNumber && s.admissionNumber.toLowerCase().includes(query)))
                    ).slice(0, 5);
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No students found or they are already in the topper list.</p>';
                } else {
                    resultsContainer.innerHTML = results.map(s => `
                        <div class="lookup-result-item">
                            <img src="${s.photo || `https://i.pravatar.cc/50?u=${s.id}`}" alt="Photo">
                            <div style="flex-grow: 1;">
                                <strong>${s.name}</strong>
                                <p style="font-size: 0.9em; color: var(--text-muted);">${s.className || 'N/A'}</p>
                            </div>
                            <button class="action-button inline" onclick="addManualTopper('${s.id}')">Set as Topper</button>
                        </div>
                    `).join('');
                }
            }

            function addManualTopper(studentId) {
                if (!state.data.siteContent.manualTopperStudentIds.includes(studentId)) {
                    state.data.siteContent.manualTopperStudentIds.push(studentId);
                    saveData();
                    showToast("Student added to toppers list!", "success");
                    getEl('topper-lookup-input').value = '';
                    getEl('topper-lookup-results').innerHTML = '';
                    displayCurrentManualToppers();
                } else {
                     showToast("This student is already a topper.", "info");
                }
            }

            function removeManualTopper(studentId) {
                state.data.siteContent.manualTopperStudentIds = state.data.siteContent.manualTopperStudentIds.filter(id => id !== studentId);
                saveData();
                showToast("Topper removed from the manual list.", "info");
                displayCurrentManualToppers();
            }
            
            function displayCurrentManualToppers() {
                const container = getEl('current-toppers-display');
                if(!container) return;

                const topperIds = state.data.siteContent.manualTopperStudentIds;
                if(topperIds && topperIds.length > 0) {
                    let toppersHtml = '<h4>Current Manual Toppers:</h4>';
                    topperIds.forEach(topperId => {
                         const student = findById('students', topperId);
                         if(student) {
                             toppersHtml += `
                                <div class="lookup-result-item">
                                    <img src="${student.photo || `https://i.pravatar.cc/50?u=${student.id}`}" alt="Photo">
                                    <div style="flex-grow: 1;">
                                        <strong>${student.name}</strong>
                                        <p style="font-size: 0.9em; color: var(--text-muted);">${student.className || 'N/A'}</p>
                                    </div>
                                    <button class="action-button secondary" onclick="removeManualTopper('${student.id}')">Remove</button>
                                </div>`;
                         }
                    });
                     container.innerHTML = toppersHtml;
                } else {
                     container.innerHTML = '<p style="color: var(--text-muted);">No manual toppers selected. Auto-selection is active.</p>';
                }
            }

            window.showNewsForm = (id = null) => {
                const newsItem = id ? (state.data.siteContent.latestNews || []).find(n => n.id == id) : {};
                const title = id ? 'Edit News Item' : 'Add New News Item';
                const formContent = `<form id="news-form">
                    <input type="hidden" id="news-id" value="${newsItem.id || ''}">
                    <div class="form-group"><label for="news-title">Title</label><input type="text" id="news-title" value="${newsItem.title || ''}" required></div>
                    <div class="form-group"><label for="news-content">Content</label><textarea id="news-content" rows="5" required>${newsItem.content || ''}</textarea></div>
                    <button type="submit" class="action-button">${id ? 'Save Changes' : 'Add News'}</button>
                </form>`;
                showModal(title, formContent);
                getEl('news-form').onsubmit = e => {
                    e.preventDefault();
                    const newsId = getEl('news-id').value || Date.now();
                    const newsData = { id: newsId, title: getEl('news-title').value, content: getEl('news-content').value };
                    
                    if (!state.data.siteContent.latestNews) state.data.siteContent.latestNews = [];
                    const index = state.data.siteContent.latestNews.findIndex(n => n.id == newsId);
                    if (index > -1) {
                        state.data.siteContent.latestNews[index] = newsData;
                    } else {
                        state.data.siteContent.latestNews.push(newsData);
                    }
                    saveData();
                    showToast(`News item ${id ? 'updated' : 'added'}!`, 'success');
                    closeModal();
                    renderContentSettingsPage();
                };
            };
            
            window.deleteNewsItem = (id) => {
                if(confirm('Are you sure you want to delete this news item?')) {
                    state.data.siteContent.latestNews = (state.data.siteContent.latestNews || []).filter(item => item.id != id);
                    saveData();
                    showToast('News item deleted.', 'success');
                    renderContentSettingsPage();
                }
            };


            function renderDataSettingsPage() { 
                const mainContent = getEl('main-content'); 
                mainContent.innerHTML = renderHeader('Data Management'); 
                mainContent.innerHTML += `<div class="page active"><div class="card"><div class="card-header"><h3>Export Data</h3></div><p>Download all application data as a single JSON file.</p><button id="export-data-btn" class="action-button inline" style="margin-top:15px;"><i class="fas fa-download"></i> Export Data</button></div><div class="card"><div class="card-header"><h3>Import Data</h3></div><p><strong>Warning:</strong> This will overwrite all current data.</p><input type="file" id="import-data-input" accept=".json" style="margin-top:15px;"><button id="import-data-btn" class="action-button inline"><i class="fas fa-upload"></i> Import Data</button></div><div class="card" style="border: 2px solid var(--error-color);"><div class="card-header"><h3>Reset Application</h3></div><p><strong>DANGER:</strong> This will delete everything.</p><button id="reset-app-btn" class="action-button inline" style="background: var(--error-color); margin-top:15px;"><i class="fas fa-bomb"></i> Reset All Data</button></div></div>`; 
                getEl('export-data-btn').onclick = () => { 
                    const dataStr = JSON.stringify(state.data); 
                    const dataBlob = new Blob([dataStr], {type: "application/json"}); 
                    const url = URL.createObjectURL(dataBlob); 
                    const a = document.createElement('a'); a.href = url; 
                    a.download = `sms-backup-${new Date().toISOString().slice(0,10)}.json`; 
                    a.click(); 
                    URL.revokeObjectURL(url); 
                    showToast('Data exported!', 'success'); 
                }; 
                getEl('import-data-btn').onclick = () => { 
                    const fileInput = getEl('import-data-input'); 
                    if (fileInput.files.length === 0) return showToast('Please select a backup file first.', 'info'); 
                    if (confirm('Are you sure you want to import data? This will overwrite all current data and cannot be undone.')) { 
                        const file = fileInput.files[0]; 
                        const reader = new FileReader(); 
                        reader.onload = e => { 
                            try { 
                                const importedData = JSON.parse(e.target.result); 
                                if(importedData.students) { 
                                    state.data = importedData; 
                                    saveData(); 
                                    showToast('Data imported successfully! The application will now reload.', 'success'); 
                                    setTimeout(() => location.reload(), 1500); 
                                } else { 
                                    showToast('Invalid backup file format.', 'error'); 
                                } 
                            } catch (err) { 
                                showToast('Error reading the backup file. It may be corrupted.', 'error'); 
                            } 
                        }; 
                        reader.readAsText(file); 
                    } 
                }; 
                getEl('reset-app-btn').onclick = () => { 
                    if(confirm('DANGER! This will permanently delete ALL data. This action cannot be undone. Are you absolutely sure?')) { 
                        if(prompt('To confirm this irreversible action, please type "DELETE" in the box below.') === 'DELETE') { 
                            localStorage.clear(); 
                            showToast('Application has been reset. Reloading now...', 'info'); 
                            setTimeout(() => location.reload(), 1500); 
                        } else { 
                            showToast('Reset cancelled.', 'info'); 
                        } 
                    } 
                }; 
            }
            
            function renderPromoteStudentsPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Promote Students');
                const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}">${c}</option>`).join('');
                mainContent.innerHTML += `
                    <div class="page active">
                        <div class="card">
                            <div class="card-header"><h3>Student Promotion Tool</h3></div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="promote-from-class">Promote From Course</label>
                                    <select id="promote-from-class" onchange="renderPromotionStudentList()"><option value="">Select a course</option>${courseOptionsHTML}</select>
                                </div>
                                <div class="form-group">
                                    <label for="promote-to-class">Promote To Course</label>
                                    <select id="promote-to-class"><option value="">Select a course</option>${courseOptionsHTML}</select>
                                </div>
                            </div>
                            <div id="promotion-student-list" style="margin-top: 20px;"></div>
                        </div>
                    </div>`;
            }
            function renderPromotionStudentList() {
                const container = getEl('promotion-student-list');
                const fromCourse = getEl('promote-from-class').value;
                container.innerHTML = '';
                if (!fromCourse) return;
                const studentsInCourse = (state.data.students || []).filter(s => s.className === fromCourse);
                if (studentsInCourse.length === 0) {
                    container.innerHTML = '<p>No students found in this course.</p>';
                    return;
                }

                let listHtml = `
                    <div class="table-container">
                        <table>
                            <thead><tr><th><input type="checkbox" onchange="toggleAllPromotionCheckboxes(this.checked)"></th><th>Name</th><th>Admission No.</th></tr></thead>
                            <tbody>
                                ${studentsInCourse.map(s => `<tr><td><input type="checkbox" class="promotion-checkbox" value="${s.id}"></td><td>${s.name}</td><td>${s.admissionNumber}</td></tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                    <button class="action-button" style="margin-top: 20px;" onclick="handleStudentPromotion()">Promote Selected Students</button>
                `;
                container.innerHTML = listHtml;
            }
            window.toggleAllPromotionCheckboxes = (checked) => {
                document.querySelectorAll('.promotion-checkbox').forEach(cb => cb.checked = checked);
            }
            function handleStudentPromotion() {
                const fromCourse = getEl('promote-from-class').value;
                const toCourse = getEl('promote-to-class').value;
                if (!fromCourse || !toCourse) {
                    return showToast('Please select both "From" and "To" courses.', 'error');
                }
                if (fromCourse === toCourse) {
                    return showToast('"From" and "To" courses cannot be the same.', 'error');
                }

                const selectedStudentIds = Array.from(document.querySelectorAll('.promotion-checkbox:checked')).map(cb => cb.value);
                if (selectedStudentIds.length === 0) {
                    return showToast('Please select at least one student to promote.', 'error');
                }
                
                let promotedCount = 0;
                selectedStudentIds.forEach(id => {
                    const student = findById('students', id);
                    if(student) {
                        student.className = toCourse;
                        updateOrAddItem('students', student);
                        promotedCount++;
                    }
                });
                saveData();
                
                if (promotedCount > 0) {
                    showToast(`${promotedCount} student(s) promoted to ${toCourse} successfully!`, 'success');
                    renderPromotionStudentList();
                }
            }

            function renderMarksheetManagerPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Grade Sheet Manager');

                const examOptions = (state.data.examMasters || []).sort((a,b) => b.id - a.id).map(ex => `<option value="${ex.id}">${ex.name}</option>`).join('');
                const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}">${c}</option>`).join('');

                mainContent.innerHTML += `<div class="page active"><div class="card">
                    <div class="card-header"><h3>Enter Student Grades</h3></div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="marks-exam-select">Select Exam</label>
                            <select id="marks-exam-select" onchange="renderMarksEntryTable()">
                                <option value="">Select Exam</option>${examOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="marks-class-select">Select Course</label>
                            <select id="marks-class-select" onchange="renderMarksEntryTable()">
                                <option value="">Select Course</option>${courseOptionsHTML}
                            </select>
                        </div>
                    </div>
                    <form id="marks-entry-form"><div id="marks-entry-table-container"></div></form>
                </div></div>`;
            }

            function renderMarksEntryTable() {
                const container = getEl('marks-entry-table-container');
                const examMasterId = getEl('marks-exam-select').value;
                const courseName = getEl('marks-class-select').value;

                container.innerHTML = '';
                if (!examMasterId || !courseName) {
                    container.innerHTML = '<p style="text-align:center; color:var(--text-muted); margin-top:20px;">Please select an exam and a course to enter grades.</p>';
                    return;
                }
                
                const studentsInCourse = (state.data.students || []).filter(s => s.className === courseName);
                const subjectsForCourse = (state.data.examSchedules || []).filter(sch => sch.examMasterId === examMasterId && sch.className === courseName);

                if (studentsInCourse.length === 0) {
                    container.innerHTML = '<p style="text-align:center; color:var(--error-color); margin-top:20px;">No students found in the selected course.</p>';
                    return;
                }
                if (subjectsForCourse.length === 0) {
                    container.innerHTML = '<p style="text-align:center; color:var(--error-color); margin-top:20px;">No subjects scheduled for this course in the selected exam.</p>';
                    return;
                }
                
                const gradeOptions = ['O', 'A+', 'A', 'B+', 'B', 'C', 'P', 'F', 'Ab'].map(g => `<option value="${g}">${g}</option>`).join('');

                let tableHtml = `<div class="table-container" style="margin-top:20px;"><table id="marks-table"><thead>
                                <tr>
                                    <th>Student Name</th>`;
                subjectsForCourse.forEach(sub => {
                    tableHtml += `<th>${sub.subject}<br><small>(${sub.paperCode})</small></th>`;
                });
                tableHtml += `<th>Co-Curricular (Grade)</th>`; // New column
                tableHtml += `</tr></thead><tbody>`;

                const marksForExam = state.data.marks[examMasterId] || {};
                const coCurricularData = state.data.coCurricular || [];

                studentsInCourse.sort((a,b) => a.rollNumber.localeCompare(b.rollNumber)).forEach(student => {
                    const studentMarks = marksForExam[student.id] || [];
                    const studentCoCurricular = coCurricularData.find(cc => cc.studentId === student.id && cc.examMasterId === examMasterId) || {};

                    tableHtml += `<tr><td>${student.name}<br><small>Roll: ${student.rollNumber}</small></td>`;
                    subjectsForCourse.forEach(subject => {
                        const mark = studentMarks.find(m => m.paperCode === subject.paperCode) || {};
                        tableHtml += `
                            <td>
                                <select class="mark-input" data-student-id="${student.id}" data-paper-code="${subject.paperCode}" style="width: 80px;">
                                    <option value="" ${!mark.grade ? 'selected' : ''}>-</option>
                                    ${['O', 'A+', 'A', 'B+', 'B', 'C', 'P', 'F', 'Ab'].map(g => `<option value="${g}" ${mark.grade === g ? 'selected' : ''}>${g}</option>`).join('')}
                                </select>
                            </td>
                        `;
                    });
                    
                    tableHtml += `<td><input type="text" class="co-curricular-input" data-student-id="${student.id}" value="${studentCoCurricular.grade || ''}" placeholder="e.g., B" style="width: 80px;"></td>`;

                    tableHtml += `</tr>`;
                });

                tableHtml += `</tbody></table></div><button type="submit" class="action-button" style="margin-top:20px;">Save All Grades</button>`;
                container.innerHTML = tableHtml;
                
                getEl('marks-entry-form').onsubmit = handleSaveMarks;
            }

            function handleSaveMarks(e) {
                e.preventDefault();
                const examMasterId = getEl('marks-exam-select').value;
                const courseName = getEl('marks-class-select').value;
                if (!examMasterId || !courseName) return;

                if (!state.data.marks[examMasterId]) {
                    state.data.marks[examMasterId] = {};
                }
                
                const allMarkInputs = document.querySelectorAll('.mark-input');
                const allCoCurricularInputs = document.querySelectorAll('.co-curricular-input');
                const marksByStudent = {};
                const subjectsForCourse = (state.data.examSchedules || []).filter(sch => sch.examMasterId === examMasterId && sch.className === courseName);

                allMarkInputs.forEach(input => {
                    const { studentId, paperCode } = input.dataset;
                    const grade = input.value;
                    const subjectInfo = subjectsForCourse.find(s => s.paperCode === paperCode);

                    if (grade && subjectInfo) {
                        if (!marksByStudent[studentId]) marksByStudent[studentId] = [];
                        
                        marksByStudent[studentId].push({
                            paperCode: paperCode,
                            subject: subjectInfo.subject,
                            credits: subjectInfo.credits,
                            grade: grade
                        });
                    }
                });
                
                for (const studentId in marksByStudent) {
                    state.data.marks[examMasterId][studentId] = marksByStudent[studentId];
                }

                allCoCurricularInputs.forEach(input => {
                    const studentId = input.dataset.studentId;
                    const grade = input.value.trim();
                    const existingIndex = (state.data.coCurricular || []).findIndex(cc => cc.studentId === studentId && cc.examMasterId === examMasterId);
                    
                    if (grade) {
                        const coCurricularEntry = {
                            studentId,
                            examMasterId,
                            paperCode: 'CC-2',
                            subject: 'FIRST AID AND HEALTH',
                            grade,
                        };
                        if (existingIndex > -1) {
                            state.data.coCurricular[existingIndex] = coCurricularEntry;
                        } else {
                            state.data.coCurricular.push(coCurricularEntry);
                        }
                    } else if (existingIndex > -1) {
                        state.data.coCurricular.splice(existingIndex, 1);
                    }
                });
                
                saveData();
                showToast('Grades saved successfully!', 'success');
            }
            
            function renderHomeworkPage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showHomeworkForm()"><i class="fas fa-plus"></i> Add Homework</button>`;
                mainContent.innerHTML = renderHeader('Homework Management', actionsHtml);

                const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}">${c}</option>`).join('');

                mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="form-group">
                            <label for="homework-class-filter">Filter by Course</label>
                            <select id="homework-class-filter" onchange="renderHomeworkTable()">
                                <option value="all">Show All</option>
                                ${courseOptionsHTML}
                            </select>
                        </div>
                        <div class="table-container"><table id="homework-table"></table></div>
                    </div>
                </div>`;
                renderHomeworkTable();
            }

            function renderHomeworkTable() {
                const table = getEl('homework-table');
                if (!table) return;

                const selectedClass = getEl('homework-class-filter').value;
                let homeworkList = state.data.homework || [];

                if (selectedClass !== 'all') {
                    homeworkList = homeworkList.filter(h => h.className === selectedClass);
                }

                let html = `<thead><tr><th>Course</th><th>Subject</th><th>Title</th><th>Due Date</th><th>Actions</th></tr></thead><tbody>`;
                if (homeworkList.length === 0) {
                    html += `<tr><td colspan="5" style="text-align:center;">No homework found for this course.</td></tr>`;
                } else {
                    homeworkList.sort((a, b) => new Date(b.dueDate) - new Date(a.dueDate)).forEach(h => {
                        html += `<tr>
                            <td>${h.className}</td>
                            <td>${h.subject}</td>
                            <td>${h.title}</td>
                            <td>${new Date(h.dueDate).toLocaleDateString()}</td>
                            <td class="action-buttons">
                                <button class="edit-btn" onclick="showHomeworkForm('${h.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="delete-btn" onclick="deleteItem('homework', '${h.id}', 'Delete this homework?', renderHomeworkTable)" title="Delete"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`;
                    });
                }
                html += `</tbody>`;
                table.innerHTML = html;
            }

            function showHomeworkForm(id = null) {
                const homework = id ? findById('homework', id) : {};
                const title = id ? 'Edit Homework' : 'Add New Homework';

                const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}" ${homework.className === c ? 'selected' : ''}>${c}</option>`).join('');

                const formContent = `<form id="homework-form">
                    <input type="hidden" id="homework-id" value="${homework.id || ''}">
                    <div class="form-group">
                        <label for="homework-class">Course</label>
                        <select id="homework-class" required>${courseOptionsHTML}</select>
                    </div>
                    <div class="form-group">
                        <label for="homework-subject">Subject</label>
                        <input type="text" id="homework-subject" value="${homework.subject || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="homework-title">Title</label>
                        <input type="text" id="homework-title" value="${homework.title || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="homework-description">Description</label>
                        <textarea id="homework-description" rows="4" required>${homework.description || ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="homework-due-date">Due Date</label>
                        <input type="date" id="homework-due-date" value="${homework.dueDate || new Date().toISOString().slice(0, 10)}" required>
                    </div>
                    <button type="submit" class="action-button">${id ? 'Save Changes' : 'Add Homework'}</button>
                </form>`;
                showModal(title, formContent);
                getEl('homework-form').onsubmit = (e) => {
                    e.preventDefault();
                    const homeworkData = {
                        id: getEl('homework-id').value || Date.now().toString(),
                        className: getEl('homework-class').value,
                        subject: getEl('homework-subject').value,
                        title: getEl('homework-title').value,
                        description: getEl('homework-description').value,
                        dueDate: getEl('homework-due-date').value,
                    };
                    updateOrAddItem('homework', homeworkData);
                    showToast(`Homework ${id ? 'updated' : 'added'}!`, 'success');
                    closeModal();
                    renderHomeworkTable();
                };
            }
            
            function renderStudentHomeworkView() {
                const user = state.loggedInUser;
                const student = user.role === 'parent' ? findById('students', user.studentId) : user;
                if (!student) return;

                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('My Homework');

                const homeworkList = (state.data.homework || [])
                    .filter(h => h.className === student.className)
                    .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

                let homeworkHtml = '';
                if (homeworkList.length === 0) {
                    homeworkHtml = '<div class="card"><p>No homework assigned for your course yet.</p></div>';
                } else {
                    homeworkHtml = homeworkList.map(h => `
                        <div class="card">
                            <div class="card-header">
                                <h3>${h.title}</h3>
                                <span style="color: var(--text-muted);">Due: ${new Date(h.dueDate).toLocaleDateString()}</span>
                            </div>
                            <p><strong>Subject:</strong> ${h.subject}</p>
                            <p style="margin-top: 10px; white-space: pre-wrap;">${h.description}</p>
                        </div>
                    `).join('');
                }

                mainContent.innerHTML += `<div class="page active">${homeworkHtml}</div>`;
            }

            function renderPublicProfileSearchPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Find Profile');

                mainContent.innerHTML += `<div class="page active"><div class="card">
                        <div class="card-header"><h3>Find Member Profile</h3></div>
                        <p>Enter the ID and Date of Birth to view the profile of a student, teacher, or staff member.</p>
                        <form id="find-public-profile-form" style="margin-top:20px;">
                             <div class="form-group">
                                <label for="profile-type">Select Member Type</label>
                                <select id="profile-type" required>
                                    <option value="student">Student</option>
                                    <option value="teacher">Teacher</option>
                                    <option value="staff">Staff</option>
                                </select>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="profile-id-number">Roll No / Employee ID</label>
                                    <input type="text" id="profile-id-number" placeholder="Enter ID" required>
                                </div>
                                <div class="form-group">
                                    <label for="profile-dob">Date of Birth</label>
                                    <input type="text" id="profile-dob" placeholder="YYYY-MM-DD" required>
                                </div>
                            </div>
                            <button type="submit" class="action-button inline">Find Profile</button>
                        </form>
                        <div id="public-profile-display-area" style="margin-top:30px;"></div>
                    </div></div>`;

                getEl('find-public-profile-form').onsubmit = (e) => {
                    e.preventDefault();
                    handleFindPublicProfile();
                };
            }
            
            function handleFindPublicProfile() {
                const memberType = getEl('profile-type').value;
                const idNumber = getEl('profile-id-number').value.trim().toLowerCase();
                const dob = getEl('profile-dob').value;
                const resultArea = getEl('public-profile-display-area');
                resultArea.innerHTML = '';

                let member = null;
                if (memberType === 'student') {
                    member = (state.data.students || []).find(s => s.rollNumber && s.rollNumber.toLowerCase() === idNumber && s.dob === dob);
                } else if (memberType === 'teacher') {
                    member = (state.data.teachers || []).find(t => t.employeeId && t.employeeId.toLowerCase() === idNumber && t.dob === dob);
                } else if (memberType === 'staff') {
                    member = (state.data.staff || []).find(s => s.employeeId && s.employeeId.toLowerCase() === idNumber && s.dob === dob);
                }

                if (member) {
                    resultArea.innerHTML = getPublicProfileHtml(member, memberType);
                } else {
                    resultArea.innerHTML = `<p class="form-feedback error">No member found with these details. Please check the ID and Date of Birth.</p>`;
                }
            }

            function getPublicProfileHtml(member, type) {
                const signatureDoc = (member.documents || []).find(doc => doc.name && doc.name.toLowerCase().includes('signature'));
                let detailsHtml = '';

                if (type === 'student') {
                    detailsHtml = `
                        <li><i class="fas fa-id-card"></i> Adm No: ${member.admissionNumber || 'N/A'}</li>
                        <li><i class="fas fa-hashtag"></i> Roll No: ${member.rollNumber || 'N/A'}</li>
                        <li><i class="fas fa-school"></i> ${member.className}</li>
                        <li><i class="fas fa-user-tie"></i> Father: ${member.fatherName || 'N/A'}</li>
                    `;
                } else {
                    detailsHtml = `
                        <li><i class="fas fa-id-card"></i> Employee ID: ${member.employeeId || 'N/A'}</li>
                        <li><i class="fas fa-briefcase"></i> Role: ${member.role || 'N/A'}</li>
                        <li><i class="fas fa-phone"></i> Contact: ${member.contact || 'N/A'}</li>
                    `;
                }

                return `
                    <div class="card profile-card" style="max-width: 500px; margin: auto;">
                        <img class="profile-photo" src="${member.photo || `https://i.pravatar.cc/150?u=${member.id}`}" alt="Photo">
                        ${signatureDoc ? `<img src="${signatureDoc.data}" alt="Signature" style="display:block; margin: -10px auto 15px; height: 40px; max-width: 150px; object-fit: contain;">` : ''}
                        <h2 style="text-align: center;">${member.name}</h2>
                        <ul class="profile-details">${detailsHtml}</ul>
                    </div>`;
            }

            function renderSchoolInfoSettingsPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('College Information');
                const schoolInfo = state.data.siteContent;

                mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="card-header"><h3>College Information (Fixed)</h3></div>
                        <p>This information is fixed and cannot be edited from this panel.</p>
                         <div class="detail-list" style="margin-top:20px;">
                            <li><span>College Name</span><strong>${schoolInfo.schoolName}</strong></li>
                            <li><span>Address</span><strong>${schoolInfo.schoolAddress}</strong></li>
                            <li><span>Contact</span><strong>${schoolInfo.schoolContact}</strong></li>
                            <li><span>Email</span><strong>${schoolInfo.schoolEmail}</strong></li>
                            <li><span>Founded</span><strong>${schoolInfo.schoolFounded}</strong></li>
                        </div>
                    </div>
                     <div class="card">
                        <div class="card-header"><h3>Update Other Information</h3></div>
                        <form id="school-info-form" style="margin-top:20px;">
                            <div class="form-group">
                                <label for="school-upi">UPI ID (for Fee Payment QR)</label>
                                <input type="text" id="school-upi" value="${schoolInfo.schoolUpiId || ''}" placeholder="your-upi-id@okhdfcbank">
                            </div>
                            <button type="submit" class="action-button inline">Save Changes</button>
                        </form>
                    </div>
                </div>`;

                getEl('school-info-form').onsubmit = e => {
                    e.preventDefault();
                    state.data.siteContent.schoolUpiId = getEl('school-upi').value;
                    saveData();
                    showToast("Other information updated successfully!", "success");
                    renderUI(); 
                };
            }
            
            function renderManageLinksPage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showLinkForm()"><i class="fas fa-plus"></i> Add Link</button>`;
                mainContent.innerHTML = renderHeader('Manage External Links', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div id="links-list"></div></div></div>`;
                renderLinksList();
            }

            function renderLinksList() {
                const container = getEl('links-list');
                if(!container) return;
                const links = state.data.externalLinks || [];
                if(links.length === 0) {
                    container.innerHTML = '<p>No external links added yet.</p>';
                    return;
                }
                let html = '<ul class="detail-list">';
                links.forEach(link => {
                    html += `<li><span><strong>${link.title}</strong><br><small>${link.url}</small></span>
                    <div class="action-buttons"><button class="edit-btn" onclick="showLinkForm('${link.id}')"><i class="fas fa-edit"></i></button><button class="delete-btn" onclick="deleteItem('externalLinks', '${link.id}', 'Delete this link?', renderLinksList)"><i class="fas fa-trash"></i></button></div>
                    </li>`;
                });
                html += '</ul>';
                container.innerHTML = html;
            }

            function showLinkForm(id=null){
                 const link = id ? findById('externalLinks', id) : {};
                 const title = id ? 'Edit Link' : 'Add New Link';
                 const formContent = `<form id="link-form">
                    <input type="hidden" id="link-id" value="${link.id || ''}">
                    <div class="form-group"><label for="link-title">Link Title</label><input type="text" id="link-title" value="${link.title || ''}" required></div>
                    <div class="form-group"><label for="link-url">URL</label><input type="url" id="link-url" value="${link.url || ''}" required></div>
                    <button type="submit" class="action-button">${id ? 'Save Changes' : 'Add Link'}</button>
                 </form>`;
                 showModal(title, formContent);
                 getEl('link-form').onsubmit = e => {
                    e.preventDefault();
                    const linkData = {
                        id: getEl('link-id').value || Date.now().toString(),
                        title: getEl('link-title').value,
                        url: getEl('link-url').value
                    };
                    updateOrAddItem('externalLinks', linkData);
                    showToast('Link saved!', 'success');
                    closeModal();
                    renderLinksList();
                    renderSidebar();
                 };
            }

            function renderSchoolPhotosSettingsPage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showSchoolPhotoForm()"><i class="fas fa-plus"></i> Add Photo</button>`;
                mainContent.innerHTML = renderHeader('Manage College Photos', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div id="school-photos-list" class="school-photos-container"></div></div></div>`;
                renderSchoolPhotosList();
            }

            function renderSchoolPhotosList() {
                const container = getEl('school-photos-list');
                if (!container) return;
                const photos = state.data.schoolPhotos || [];
                if (photos.length === 0) {
                    container.innerHTML = `<p style="text-align:center; color: var(--text-muted);">No college photos uploaded yet. Click 'Add Photo' to start.</p>`;
                    return;
                }
                container.innerHTML = photos.map(photo => `
                    <div class="school-photo-item card">
                        <img src="${photo.image}" alt="${photo.title}">
                        <div class="gallery-item-footer">
                            <span>${photo.title}</span>
                            <button class="delete-btn" onclick="deleteItem('schoolPhotos', '${photo.id}', 'Delete this photo?', renderSchoolPhotosList)" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');
            }

            function showSchoolPhotoForm() {
                const title = 'Add College Photo';
                const formContent = `<form id="school-photo-form">
                        <div class="form-group"><label for="school-photo-title">Photo Title</label><input type="text" id="school-photo-title" required></div>
                        <div class="form-group"><label for="school-photo-image">Select Image</label><input type="file" id="school-photo-image" accept="image/*" required></div>
                        <button type="submit" class="action-button">Upload Photo</button>
                    </form>`;
                showModal(title, formContent);
                getEl('school-photo-form').onsubmit = async e => {
                    e.preventDefault();
                    const imageFile = getEl('school-photo-image').files[0];
                    if (!imageFile) return;
                    const photoData = {
                        id: Date.now().toString(),
                        title: getEl('school-photo-title').value,
                        image: await fileToBase64(imageFile)
                    };
                    updateOrAddItem('schoolPhotos', photoData);
                    showToast('College photo added!', 'success');
                    closeModal();
                    renderSchoolPhotosList();
                };
            }

            function renderPlacementSettingsPage() {
                const mainContent = getEl('main-content');
                const actionsHtml = `<button class="action-button inline" onclick="showPlacementForm()"><i class="fas fa-plus"></i> Add Company</button>`;
                mainContent.innerHTML = renderHeader('Manage Placement Logos', actionsHtml);
                mainContent.innerHTML += `<div class="page active"><div class="card"><div id="placements-list" class="placements-grid"></div></div></div>`;
                renderPlacementsList();
            }
            
            function renderPlacementsList() {
                const container = getEl('placements-list');
                if (!container) return;
                const placements = state.data.placements || [];
                if (placements.length === 0) {
                    container.innerHTML = `<p style="text-align:center; color: var(--text-muted);">No placement logos added yet.</p>`;
                    return;
                }
                container.innerHTML = placements.map(item => `
                    <div class="placement-item card">
                        <img src="${item.logo}" alt="${item.name}">
                        <div class="item-footer">
                            <span>${item.name}</span>
                            <button class="delete-btn" onclick="deleteItem('placements', '${item.id}', 'Delete this company logo?', renderPlacementsList)" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');
            }

            function showPlacementForm() {
                const title = 'Add Placement Company';
                const formContent = `<form id="placement-form">
                        <div class="form-group"><label for="placement-name">Company Name</label><input type="text" id="placement-name" required></div>
                        <div class="form-group"><label for="placement-logo">Select Logo</label><input type="file" id="placement-logo" accept="image/*" required></div>
                        <button type="submit" class="action-button">Upload Logo</button>
                    </form>`;
                showModal(title, formContent);
                getEl('placement-form').onsubmit = async e => {
                    e.preventDefault();
                    const logoFile = getEl('placement-logo').files[0];
                    if (!logoFile) return;
                    const placementData = {
                        id: "pl" + Date.now().toString(),
                        name: getEl('placement-name').value,
                        logo: await fileToBase64(logoFile)
                    };
                    updateOrAddItem('placements', placementData);
                    showToast('Placement logo added!', 'success');
                    closeModal();
                    renderPlacementsList();
                };
            }


            function renderUploadResultPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Upload Student Result');
                
                const courseOptionsHTML = courseOptionsList.map(c => `<option value="${c}">${c}</option>`).join('');

                mainContent.innerHTML += `<div class="page active">
                    <div class="card">
                        <div class="card-header"><h3>Select Course to Upload Results</h3></div>
                        <div class="form-group">
                            <label for="upload-result-class-select">Select Course</label>
                            <select id="upload-result-class-select">
                                <option value="">-- Select a Course --</option>
                                ${courseOptionsHTML}
                            </select>
                        </div>
                    </div>
                    <div id="result-upload-form-container"></div>
                </div>`;
                
                getEl('upload-result-class-select').onchange = (e) => showResultUploadFormForClass(e.target.value);
            }
            
            function showResultUploadFormForClass(courseName) {
                const container = getEl('result-upload-form-container');
                if(!courseName) {
                    container.innerHTML = '';
                    return;
                }
                
                const examOptions = (state.data.examMasters || []).sort((a,b) => b.id - a.id).map(ex => `<option value="${ex.id}">${ex.name}</option>`).join('');
                
                container.innerHTML = `<div class="card">
                     <form id="result-upload-form">
                        <h4>Uploading Results for: <strong>${courseName}</strong></h4>
                        <div class="form-group" style="margin-top: 20px;">
                            <label for="result-upload-exam">Select Exam</label>
                            <select id="result-upload-exam" required><option value="">--Select an Exam--</option>${examOptions}</select>
                        </div>
                        <div id="result-upload-subjects-container"></div>
                        <button type="submit" class="action-button" style="margin-top:20px; display: none;">Save All Grades</button>
                    </form>
                </div>`;
                
                getEl('result-upload-exam').onchange = () => {
                    renderResultSubjectsForClass(courseName);
                };
                
                getEl('result-upload-form').onsubmit = (e) => {
                    e.preventDefault();
                    handleSaveUploadedResultForClass(courseName);
                };
            }
            
            function renderResultSubjectsForClass(courseName) {
                const container = getEl('result-upload-subjects-container');
                const examMasterId = getEl('result-upload-exam').value;
                 if (!examMasterId) {
                    container.innerHTML = '';
                    getEl('result-upload-form').querySelector('button[type="submit"]').style.display = 'none';
                    return;
                }
                
                const studentsInCourse = (state.data.students || []).filter(s => s.className === courseName);
                const subjectsForCourse = (state.data.examSchedules || []).filter(sch => sch.examMasterId === examMasterId && sch.className === courseName);

                if(studentsInCourse.length === 0) {
                    container.innerHTML = '<p class="form-feedback error">No students found in this course.</p>';
                    getEl('result-upload-form').querySelector('button[type="submit"]').style.display = 'none';
                    return;
                }
                 if(subjectsForCourse.length === 0) {
                    container.innerHTML = '<p class="form-feedback error">No subjects are scheduled for this course in the selected exam. Please add subjects in the Exams section first.</p>';
                    getEl('result-upload-form').querySelector('button[type="submit"]').style.display = 'none';
                    return;
                }
                
                getEl('result-upload-form').querySelector('button[type="submit"]').style.display = 'block';
                
                let tableHtml = `<div class="table-container" style="margin-top:20px;"><table id="result-upload-marks-table"><thead>
                                <tr>
                                    <th class="sticky-col">Student Name</th>`;
                subjectsForCourse.forEach(sub => {
                    tableHtml += `<th>${sub.subject}<br><small>(${sub.paperCode})</small></th>`;
                });
                tableHtml += `<th>Co-Curricular Grade</th>`;
                tableHtml += `</tr></thead><tbody>`;

                const marksForExam = state.data.marks[examMasterId] || {};
                const coCurricularDataForExam = state.data.coCurricular || [];

                studentsInCourse.sort((a,b) => a.rollNumber.localeCompare(b.rollNumber)).forEach(student => {
                    const studentMarks = marksForExam[student.id] || [];
                    const coCurricularMark = coCurricularDataForExam.find(c => c.studentId === student.id && c.examMasterId === examMasterId) || {};
                    tableHtml += `<tr><td class="sticky-col">${student.name}<br><small>Roll: ${student.rollNumber}</small></td>`;
                    subjectsForCourse.forEach(subject => {
                        const mark = studentMarks.find(m => m.paperCode === subject.paperCode) || {};
                        tableHtml += `
                            <td>
                                <select class="mark-input" data-student-id="${student.id}" data-paper-code="${subject.paperCode}">
                                    <option value="" ${!mark.grade ? 'selected' : ''}>-</option>
                                    ${['O', 'A+', 'A', 'B+', 'B', 'C', 'P', 'F', 'Ab'].map(g => `<option value="${g}" ${mark.grade === g ? 'selected' : ''}>${g}</option>`).join('')}
                                </select>
                            </td>`;
                    });
                     tableHtml += `<td><input type="text" class="co-curricular-input" data-student-id="${student.id}" value="${coCurricularMark.grade || ''}" placeholder="e.g., B" /></td>`;
                    tableHtml += `</tr>`;
                });
                
                tableHtml += `</tbody></table></div>`;
                container.innerHTML = tableHtml;
            }

            function handleSaveUploadedResultForClass(courseName) {
                const examMasterId = getEl('result-upload-exam').value;
                if (!examMasterId) return showToast('Please select an exam.', 'error');

                if (!state.data.marks[examMasterId]) {
                    state.data.marks[examMasterId] = {};
                }

                const allMarkInputs = document.querySelectorAll('.mark-input');
                const allCoCurricularInputs = document.querySelectorAll('.co-curricular-input');
                const marksByStudent = {};
                const subjectsForCourse = (state.data.examSchedules || []).filter(sch => sch.examMasterId === examMasterId && sch.className === courseName);

                allMarkInputs.forEach(input => {
                    const { studentId, paperCode } = input.dataset;
                    const grade = input.value;
                    const subjectInfo = subjectsForCourse.find(s => s.paperCode === paperCode);

                    if (grade && subjectInfo) {
                        if (!marksByStudent[studentId]) marksByStudent[studentId] = [];
                        
                        marksByStudent[studentId].push({
                            paperCode: paperCode,
                            subject: subjectInfo.subject,
                            credits: subjectInfo.credits,
                            grade: grade
                        });
                    }
                });

                 allCoCurricularInputs.forEach(input => {
                    const studentId = input.dataset.studentId;
                    const grade = input.value.trim();
                    const existingIndex = state.data.coCurricular.findIndex(cc => cc.studentId === studentId && cc.examMasterId === examMasterId);
                    
                    if (grade) {
                        const coCurricularEntry = {
                            studentId,
                            examMasterId,
                            paperCode: 'CC-2',
                            subject: 'FIRST AID AND HEALTH',
                            grade,
                        };
                        if (existingIndex > -1) {
                            state.data.coCurricular[existingIndex] = coCurricularEntry;
                        } else {
                            state.data.coCurricular.push(coCurricularEntry);
                        }
                    } else if (existingIndex > -1) {
                        state.data.coCurricular.splice(existingIndex, 1);
                    }
                });


                let updatedCount = 0;
                for (const studentId in marksByStudent) {
                    if(marksByStudent[studentId].length > 0) {
                       state.data.marks[examMasterId][studentId] = marksByStudent[studentId];
                       updatedCount++;
                    }
                }
                
                if(updatedCount > 0){
                   saveData();
                   showToast(`Results for ${updatedCount} student(s) saved successfully!`, 'success');
                } else {
                   showToast('No grades were entered to save.', 'info');
                }
            }


            function renderFeePaymentPortalPage() {
                const mainContent = getEl('main-content');
                mainContent.innerHTML = renderHeader('Fee Payment');
                 const userRole = state.loggedInUser?.role;
                let student = null;
                if (userRole === 'student') student = state.loggedInUser;
                if (userRole === 'parent') student = findById('students', state.loggedInUser.studentId);

                if (student) {
                    showStudentFeePaymentView(student);
                } else {
                     mainContent.innerHTML += `<div class="page active"><div class="card">
                        <div class="card-header"><h3>Find Your Details to Pay Fee</h3></div>
                        <p>Enter your Roll Number and Date of Birth (or Password) to proceed.</p>
                        <form id="find-fee-student-form" style="margin-top:20px;">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="fee-roll-number">Roll Number</label>
                                    <input type="text" id="fee-roll-number" placeholder="Enter Roll Number" required>
                                </div>
                                <div class="form-group">
                                    <label for="fee-dob">Date of Birth</label>
                                    <input type="text" id="fee-dob" placeholder="YYYY-MM-DD">
                                </div>
                            </div>
                             <p style="text-align:center; margin-bottom: 15px;">OR</p>
                             <div class="form-group">
                                <label for="fee-password">Password</label>
                                <input type="password" id="fee-password" placeholder="Enter Password">
                            </div>
                            <button type="submit" class="action-button inline">Find Details</button>
                        </form>
                        <div id="fee-payment-display-area" style="margin-top:30px;"></div>
                    </div></div>`;

                    getEl('find-fee-student-form').onsubmit = e => {
                        e.preventDefault();
                        const rollNumber = getEl('fee-roll-number').value.trim().toLowerCase();
                        const dob = getEl('fee-dob').value;
                        const password = getEl('fee-password').value;
                        const resultArea = getEl('fee-payment-display-area');
                        
                        if (!rollNumber || (!dob && !password)) {
                            resultArea.innerHTML = `<p class="form-feedback error">Please enter a roll number and either a date of birth or a password.</p>`;
                            return;
                        }

                        const foundStudent = (state.data.students || []).find(s => {
                            if (s.rollNumber && s.rollNumber.toLowerCase() === rollNumber) {
                                if (dob && s.dob === dob) return true;
                                if (password && s.password && btoa(password) === s.password) return true;
                            }
                            return false;
                        });

                        if (foundStudent) {
                            showStudentFeePaymentView(foundStudent);
                        } else {
                             getEl('fee-payment-display-area').innerHTML = `<p class="form-feedback error">No student found with these details.</p>`;
                        }
                    };
                }
            }

            function showStudentFeePaymentView(student) {
                const mainContent = getEl('main-content');
                const schoolInfo = state.data.siteContent;
                const studentTransactions = (state.data.transactions || []).filter(t => t.studentId === student.id);
                const paidFee = studentTransactions.reduce((sum, t) => sum + Number(t.amount), 0);

                let paymentGatewayHtml = `<p class="form-feedback info">The college has not set up online payments yet. Please contact the office.</p>`;
                if (schoolInfo.schoolUpiId) {
                     paymentGatewayHtml = `
                     <div class="payment-gateway-card">
                        <h3>Pay Using UPI</h3>
                        <p>You can scan the QR code using any UPI app like Google Pay, PhonePe, Paytm, etc.</p>
                        <div class="form-group" style="max-width:200px; margin: 20px auto;">
                           <label for="payment-amount">Enter Amount (₹)</label>
                           <input type="number" id="payment-amount" value="5000" oninput="generatePaymentQr('${student.rollNumber}')">
                        </div>
                        <div style="margin: 20px 0;">
                            <div id="upi-qr-code" style="padding:15px; background:white; display:inline-block; border-radius:8px;"></div>
                        </div>
                        <div class="upi-info">
                           <p>Or pay directly to the UPI ID:</p>
                           <p class="upi-id">${schoolInfo.schoolUpiId}</p>
                           <button class="action-button secondary inline" onclick="navigator.clipboard.writeText('${schoolInfo.schoolUpiId}')">Copy UPI ID</button>
                        </div>
                        <div class="upi-buttons">
                           <a href="#" id="gpay-link" class="upi-button" target="_blank"><img src="https://www.vectorlogo.zone/logos/googlepay/googlepay-icon.svg">Pay with GPay</a>
                           <a href="#" id="phonepe-link" class="upi-button" target="_blank"><img src="https://www.vectorlogo.zone/logos/phonepe/phonepe-icon.svg">Pay with PhonePe</a>
                           <a href="#" id="paytm-link" class="upi-button" target="_blank"><img src="https://www.vectorlogo.zone/logos/paytm/paytm-icon.svg">Pay with Paytm</a>
                        </div>
                        <div id="payment-confirmation-section" style="margin-top:30px;">
                            <button class="action-button" onclick="startPaymentConfirmation('${student.id}')">I have Paid</button>
                        </div>
                        <div id="payment-timer-section" style="display:none; margin-top:20px;">
                            <p>Please click the button below within the time limit after completing your payment.</p>
                            <h3 id="payment-timer" style="font-size: 2rem; color: var(--warning-color); margin:10px 0;">05:00</h3>
                            <button id="confirm-payment-btn" class="action-button success" onclick="confirmPayment('${student.id}')">Confirm Payment & Get Receipt</button>
                        </div>
                        <div class="card" style="margin-top:20px; border-color: var(--warning-color);">
                            <h4 style="color:var(--warning-color);">Important Notice</h4>
                            <p style="margin-top:10px;">After making the payment, please click the "Confirm Payment" button to record it. Your payment will be manually verified by the college administration, and then the receipt will be permanently available in your profile.</p>
                        </div>
                     </div>
                     `;
                }

                const displayArea = getEl('fee-payment-display-area') || mainContent;
                displayArea.innerHTML = `
                    <div class="page active">
                        <div class="card">
                            <div class="card-header"><h3>Fee Payment for ${student.name}</h3></div>
                            <p><strong>Roll No:</strong> ${student.rollNumber}</p>
                            <p><strong>Course:</strong> ${student.className}</p>
                            <p><strong>Total Fee Paid:</strong> ₹${paidFee.toLocaleString()}</p>
                        </div>
                         <div class="card">
                            <div class="card-header"><h3>Online Payment</h3></div>
                            ${paymentGatewayHtml}
                        </div>
                        <div class="card">
                            <div class="card-header"><h3>Payment History</h3></div>
                             <ul class="detail-list">
                                ${studentTransactions.length ? studentTransactions.sort((a,b) => new Date(b.date) - new Date(a.date)).map(t => `<li><span>${new Date(t.date).toLocaleDateString()} - ${t.type}</span><div style="display:flex; align-items:center; gap: 10px;"><span>₹${Number(t.amount).toLocaleString()}</span><button class="action-button no-print secondary" onclick="showFeeReceipt('${student.id}', '${t.id}')" style="padding: 5px 10px;" title="Print Receipt"><i class="fas fa-print"></i></button></div></li>`).join('') : '<li>No payments made.</li>'}
                            </ul>
                        </div>
                    </div>
                `;
                
                if (schoolInfo.schoolUpiId) {
                    generatePaymentQr(student.rollNumber);
                }
            }
            
            window.startPaymentConfirmation = (studentId) => {
                getEl('payment-confirmation-section').style.display = 'none';
                getEl('payment-timer-section').style.display = 'block';
                let timeLeft = 300;
                const timerEl = getEl('payment-timer');
                feePaymentTimer = setInterval(() => {
                    if (timeLeft <= 0) {
                        clearInterval(feePaymentTimer);
                        showToast('Time is up. Please try again.', 'error');
                        getEl('payment-confirmation-section').style.display = 'block';
                        getEl('payment-timer-section').style.display = 'none';
                    } else {
                        timeLeft--;
                        const minutes = Math.floor(timeLeft / 60);
                        const seconds = timeLeft % 60;
                        timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    }
                }, 1000);
            };

            window.confirmPayment = (studentId) => {
                clearInterval(feePaymentTimer);
                const amount = getEl('payment-amount').value;
                const transaction = { 
                    id: Date.now().toString(), 
                    studentId: studentId, 
                    amount: amount, 
                    date: new Date().toISOString().slice(0,10), 
                    type: "Online Fee Payment" 
                };
                updateOrAddItem('transactions', transaction);
                showToast("Payment confirmed! Generating receipt...", 'success');
                getEl('payment-timer-section').innerHTML = `<p class="form-feedback success">Payment recorded. Please save your receipt.</p>`;
                showFeeReceipt(studentId, transaction.id, true);
            };

            window.generatePaymentQr = (rollNumber) => {
                const schoolInfo = state.data.siteContent;
                const amount = getEl('payment-amount').value || 5000;
                const qrContainer = getEl('upi-qr-code');
                const upiString = `upi://pay?pa=${schoolInfo.schoolUpiId}&pn=${encodeURIComponent(schoolInfo.schoolName)}&am=${amount}&cu=INR&tn=FeeFor-${rollNumber}`;
                
                if (qrContainer) {
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, { text: upiString, width: 200, height: 200 });
                }
                
                if(getEl('gpay-link')) getEl('gpay-link').href = upiString;
                if(getEl('phonepe-link')) getEl('phonepe-link').href = upiString;
                if(getEl('paytm-link')) getEl('paytm-link').href = upiString;
            };

            // UTILITY AND EVENT LISTENERS
            window.findById = (key, id) => (state.data[key] || []).find(item => item.id == id);
            window.updateOrAddItem = (key, item) => { const items = state.data[key] || []; const index = items.findIndex(i => i.id == item.id); if (index > -1) items[index] = item; else items.push(item); state.data[key] = items; saveData(); };
            window.deleteItem = (key, id, message, callback) => { if (confirm(message || 'Are you sure?')) { state.data[key] = (state.data[key] || []).filter(item => item.id != id); saveData(); showToast('Item deleted.', 'success'); if (callback) callback(); } };
            window.closeModal = () => { if(html5QrCode && html5QrCode.isScanning) { html5QrCode.stop().catch(err => {}); } if(feePaymentTimer) clearInterval(feePaymentTimer); getEl('modal-container').innerHTML = ''; };
            window.showToast = (message, type = 'success') => { const toastContainer = getEl('toast-container'); const toast = document.createElement('div'); toast.className = `toast ${type}`; const iconClass = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'; toast.innerHTML = `<i class="fas ${iconClass}" style="margin-right:10px;"></i> ${message}`; toastContainer.appendChild(toast); setTimeout(() => toast.remove(), 5000); };
            window.fileToBase64 = (file) => new Promise((resolve, reject) => { if(!file) resolve(null); const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result); reader.onerror = error => reject(error); });
            
            const convertQrCanvasToImage = (container) => {
                const canvas = container.querySelector('canvas');
                if (canvas) {
                    if(container.querySelector('img')) {
                        container.querySelector('img').remove();
                    }
                    const img = new Image();
                    img.src = canvas.toDataURL("image/png");
                    img.style.width = canvas.style.width;
                    img.style.height = canvas.style.height;
                    canvas.style.display = 'none'; 
                    container.appendChild(img);
                }
            };

            window.printContent = (selector) => {
                const printableElement = document.querySelector(selector);
                if (!printableElement) {
                    console.error("Printable element not found:", selector);
                    return;
                }

                const printContainer = getEl('printable-content-area');
                printContainer.innerHTML = '';

                const wasLightTheme = document.body.classList.contains('light-theme');
                document.body.classList.add('light-theme');

                setTimeout(() => {
                    const contentToPrint = printableElement.cloneNode(true);
                    
                    if (contentToPrint.classList.contains('attendance-report')) {
                        contentToPrint.querySelectorAll('select.attendance-select').forEach(select => {
                            const td = select.parentElement;
                            let text = '-';
                            if (select.value === 'present') text = 'P';
                            else if (select.value === 'absent') text = 'A';
                            td.innerHTML = text;
                        });
                    }
                    
                    printContainer.appendChild(contentToPrint);
                    document.body.classList.add('printing');
                    
                    setTimeout(() => {
                        window.print();
                        document.body.classList.remove('printing');
                        if (!wasLightTheme) {
                            document.body.classList.remove('light-theme');
                        }
                    }, 250);
                }, 100); 
            };
            
            window.downloadAsPdf = async (selector, filename) => {
                const element = document.querySelector(selector);
                if (!element) return;
                
                showToast("Generating PDF, please wait...", "info");

                const wasLightTheme = document.body.classList.contains('light-theme');
                document.body.classList.add('light-theme');
                
                const clone = element.cloneNode(true);
                clone.style.position = 'absolute';
                clone.style.left = '-9999px';
                document.body.appendChild(clone);

                await new Promise(resolve => setTimeout(resolve, 200)); 

                html2canvas(clone, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });

                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const canvasWidth = canvas.width;
                    const canvasHeight = canvas.height;
                    const ratio = canvasWidth / canvasHeight;
                    
                    let imgWidth = pdfWidth;
                    let imgHeight = imgWidth / ratio;
                    
                    if(imgHeight > pdfHeight) {
                        imgHeight = pdfHeight;
                        imgWidth = imgHeight * ratio;
                    }

                    const x = (pdfWidth - imgWidth) / 2;
                    const y = (pdfHeight - imgHeight) / 2;
                    
                    pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
                    pdf.save(filename);

                    if (!wasLightTheme) {
                        document.body.classList.remove('light-theme');
                    }
                    document.body.removeChild(clone); 
                    showToast("PDF Downloaded!", "success");

                }).catch(err => {
                    console.error("PDF generation failed:", err);
                    showToast("Failed to generate PDF.", "error");
                    if (!wasLightTheme) {
                        document.body.classList.remove('light-theme');
                    }
                    document.body.removeChild(clone);
                });
            };


            const toggleSidebar = () => { if (window.innerWidth <= 768) { document.body.classList.toggle('sidebar-open'); } else { const appContainer = getEl('app-container'); appContainer.classList.toggle('sidebar-collapsed'); localStorage.setItem('sidebarCollapsed', appContainer.classList.contains('sidebar-collapsed')); } };
            const initSidebarState = () => { if (window.innerWidth > 768 && localStorage.getItem('sidebarCollapsed') === 'true') getEl('app-container').classList.add('sidebar-collapsed'); };
            document.addEventListener('click', (event) => { if (window.innerWidth <= 768 && document.body.classList.contains('sidebar-open')) { const sidebar = getEl('sidebar'); const menuToggle = document.querySelector('.menu-toggle'); if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) { document.body.classList.remove('sidebar-open'); } } });
            const changeTheme = (theme) => { document.body.classList.remove('light-theme'); if(theme === 'light') document.body.classList.add('light-theme'); localStorage.setItem('theme', theme); renderUI(); };
            const initTheme = () => { const savedTheme = localStorage.getItem('theme') || 'dark'; document.body.classList.remove('light-theme'); if(savedTheme === 'light') document.body.classList.add('light-theme'); };
            const toggleThemeMode = () => { const newTheme = document.body.classList.contains('light-theme') ? 'dark' : 'light'; changeTheme(newTheme);};
            const changeFontWeight = (e) => { const weight = e.target.value; document.body.classList.remove('font-weight-light', 'font-weight-normal', 'font-weight-bold'); document.body.classList.add(`font-weight-${weight}`); localStorage.setItem('fontWeight', weight); };
            const initFontWeight = () => { const savedWeight = localStorage.getItem('fontWeight') || 'normal'; document.body.classList.add(`font-weight-${savedWeight}`); };
            const hexToRgb = (hex) => { let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : null; };
            const changeAccentColor = (colorName) => { const colors = config.accentColors[colorName]; if (!colors) return; const root = document.documentElement; root.style.setProperty('--primary-color', colors.primary); root.style.setProperty('--primary-light', colors.light); root.style.setProperty('--primary-gradient', `linear-gradient(45deg, ${colors.primary}, ${colors.light})`); const rgb = hexToRgb(colors.light); if (rgb) { root.style.setProperty('--glow-color', `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.4)`); root.style.setProperty('--glow-color-hover', `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.6)`); } };
            const cycleAccentColor = () => { const colorKeys = Object.keys(config.accentColors); let currentIndex = parseInt(localStorage.getItem('themeAccentIndex') || '0'); currentIndex = (currentIndex + 1) % colorKeys.length; const newColorName = colorKeys[currentIndex]; changeAccentColor(newColorName); localStorage.setItem('themeAccentIndex', currentIndex.toString()); renderUI(); };
            const initAccentColor = () => { const colorKeys = Object.keys(config.accentColors); const savedIndex = parseInt(localStorage.getItem('themeAccentIndex') || '0'); const validIndex = (savedIndex >= 0 && savedIndex < colorKeys.length) ? savedIndex : 0; const savedColorName = colorKeys[validIndex]; changeAccentColor(savedColorName); };
            const getMonthlyFinancialData = () => { const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; const incomeByMonth = {}; const expenseByMonth = {}; (state.data.transactions || []).forEach(t => { const month = new Date(t.date).getMonth(); incomeByMonth[month] = (incomeByMonth[month] || 0) + Number(t.amount); }); (state.data.expenses || []).forEach(e => { const month = new Date(e.date).getMonth(); expenseByMonth[month] = (expenseByMonth[month] || 0) + Number(e.amount); }); const labels = [], income = [], expense = []; const currentMonth = new Date().getMonth(); for (let i = 0; i < 12; i++) { labels.push(monthNames[i]); income.push(incomeByMonth[i] || 0); expense.push(expenseByMonth[i] || 0); } let currentMonthIncome = (incomeByMonth[currentMonth] || 0).toLocaleString(); return { labels, income, expense, currentMonthIncome }; };
             const startClock = () => {
                const clockEl = getEl('real-time-clock');
                if(!clockEl) return;
                function updateClock() {
                    const clockEl = getEl('real-time-clock');
                    if (clockEl) {
                        const now = new Date();
                        clockEl.textContent = now.toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit', second: '2-digit'});
                    }
                }
                updateClock();
                setInterval(updateClock, 1000);
            };
           
            window.navigate = navigate;
            window.renderStudentTable = renderStudentTable;
            window.showStudentForm = showStudentForm;
            window.showNoteForm = showNoteForm;
            window.showPaymentForm = showPaymentForm;
            window.showFeeReceipt = showFeeReceipt;
            window.showDocumentUploadForm = showDocumentUploadForm;
            window.deleteDocument = deleteDocument;
            window.showRegisterModal = showRegisterModal;
            window.showLoginModal = showLoginModal;
            window.cycleAccentColor = cycleAccentColor;
            window.toggleThemeMode = toggleThemeMode;
            window.showGalleryForm = showGalleryForm;
            window.renderGalleryGrid = renderGalleryGrid;
            window.renderAttendanceSheet = renderAttendanceSheet;
            window.saveAttendance = saveAttendance;
            window.showInquiryForm = showInquiryForm;
            window.renderInquiriesTable = renderInquiriesTable;
            window.showExpenseForm = showExpenseForm;
            window.renderExpensesPage = renderExpensesPage;
            window.showNoticeForm = showNoticeForm;
            window.renderNoticesTable = renderNoticesTable;
            window.showTeacherForm = showTeacherForm;
            window.renderTeacherTable = renderTeacherTable;
            window.showStaffForm = showStaffForm;
            window.renderStaffTable = renderStaffTable;
            window.showAdmissionForm = showAdmissionForm;
            window.handleAdmissionSubmit = handleAdmissionSubmit;
            window.showIdCard = showIdCard;
            window.renderVideosPage = renderVideosPage;
            window.renderVideosGrid = renderVideosGrid;
            window.showVideoForm = showVideoForm;
            window.renderCertificateStudentList = renderCertificateStudentList;
            window.showCertificateGenerationModal = showCertificateGenerationModal;
            window.renderTeacherAttendancePage = renderTeacherAttendancePage;
            window.renderStaffAttendancePage = renderStaffAttendancePage;
            window.showTimetableForm = showTimetableForm;
            window.renderTimetableGrid = renderTimetableGrid;
            window.showExamMasterForm = showExamMasterForm;
            window.renderExamMastersTable = renderExamMastersTable;
            window.showExamScheduleForm = showExamScheduleForm;
            window.renderExamScheduleTable = renderExamScheduleTable;
            window.deleteExamMaster = deleteExamMaster;
            window.renderExamScheduleView = renderExamScheduleView;
            window.showTeacherIdCard = showTeacherIdCard;
            window.showStaffIdCard = showStaffIdCard;
            window.displayMonthlyAttendanceReport = displayMonthlyAttendanceReport;
            window.renderPromotionStudentList = renderPromotionStudentList;
            window.handleStudentPromotion = handleStudentPromotion;
            window.showUnifiedScanner = showUnifiedScanner;
            window.lookupStudent = lookupStudent;
            window.showForgotPasswordModal = showForgotPasswordModal;
            window.showAdmitCard = showAdmitCard;
            window.renderAdmitCardPortalPage = renderAdmitCardPortalPage;
            window.renderMarksheetManagerPage = renderMarksheetManagerPage;
            window.renderMarksEntryTable = renderMarksEntryTable;
            window.handleSaveMarks = handleSaveMarks;
            window.showMarksheet = showMarksheet;
            window.handleFindResult = handleFindResult;
            window.renderHomeworkTable = renderHomeworkTable;
            window.showHomeworkForm = showHomeworkForm;
            window.renderEventsTable = renderEventsTable;
            window.showEventForm = showEventForm;
            window.renderBookTable = renderBookTable;
            window.showBookForm = showBookForm;
            window.renderIssuedBooksTable = renderIssuedBooksTable;
            window.handleIssueBook = handleIssueBook;
            window.handleReturnBook = handleReturnBook;
            window.renderPublicProfileSearchPage = renderPublicProfileSearchPage;
            window.lookupTopperStudent = lookupTopperStudent;
            window.addManualTopper = addManualTopper;
            window.removeManualTopper = removeManualTopper;
            window.showSchoolPhotoForm = showSchoolPhotoForm;
            window.renderSchoolPhotosList = renderSchoolPhotosList;
            window.showResultUploadFormForClass = showResultUploadFormForClass;
            window.renderResultSubjectsForClass = renderResultSubjectsForClass;
            window.handleSaveUploadedResultForClass = handleSaveUploadedResultForClass;
            window.showLinkForm = showLinkForm;
            window.renderLinksList = renderLinksList;
            window.renderPlacementsList = renderPlacementsList;
            window.showPlacementForm = showPlacementForm;
            window.downloadAsPdf = downloadAsPdf;
            
            checkAuth();
        });
           
    </script>
</body>
</html>